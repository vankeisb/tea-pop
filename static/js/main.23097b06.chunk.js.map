{"version":3,"sources":["../../src/index.ts","../../src/Dim.ts","../../src/Pos.ts","../../src/Msg.ts","../../src/Menu.ts","../../src/Box.ts","../../src/Model.ts","../../src/StopEvent.ts","../../src/Popover.ts","../../src/WindowUtils.ts","../../src/TeaPop.ts","../../src/ViewMenu.tsx","../../src/ItemRenderer.tsx","../../src/DropDown.tsx","Msg.ts","routes.ts","menu-page/MenuPageMsg.ts","menu-page/ViewMenuPage.tsx","menu-page/MenuPage.ts","menu-page/Update.ts","dropdown-page/DropDownPageMsg.ts","dropdown-page/Update.ts","placement-page/PlacementPageMsg.ts","placement-page/Update.ts","DemoApp.tsx","Model.ts","dropdown-page/ViewDropDownPage.tsx","placement-page/ViewPlacementPage.tsx","index.tsx"],"names":["open","update","subscriptions","ViewDropDown","Dim","w","h","dim","zero","Pos","x","y","p","this","pos","origin","tag","d","uuid","r","key","m","item","subMenuCounter","selectFirst","Menu","elements","selectIndex","select","e","ListWithSelection","fromArray","toArray","selected","getSelected","type","value","just","nothing","isSelected","start","elems","i","length","down","getSelectedIndex","map","selectedIndex","findNextItemIndex","findPreviousItemIndex","nextIndex","withDefault","withDefaultSupply","indexOf","menuId","btoa","menuItemId","itemIndex","byId","id","Task","fromLambda","document","getElementById","Error","items","userData","subMenu","maybeOf","separator","Box","rect","height","width","box","right","bottom","left","top","isPointInside","topLeft","bottomRight","menuStatePlacing","refBox","menu","windowSize","state","error","child","navigatedWithKeyboard","model","stopEvent","preventDefault","stopPropagation","place1DEnd","viewportW","refX","refW","elemW","offset","len","place1DStart","viewport","elem","pX","pY","elemEnd","spaceBefore","spaceAfter","placeComboY","window","innerWidth","innerHeight","initialModel","selectFirstItem","deselectAll","Cmd","batch","perform","getWindowDimensions","gotWindowDimensions","u","gotUuid","postOpen","noCmd","attempt","menuTask","fromDomRect","getBoundingClientRect","gotMenuBox","withOut","mac","outMsg","outItemSelected","data","openSubMenu","isNothing","Tuple","t2n","menuItemTask","gotItemBox","msg","match","menuBox","place","err","collapseLastSubMenu","keyboardNavigated","mapLastMenu","lastModel","moveSelection","selectedItem","indexOfItem","expandLastSubMenu","toggleOrSelectItem","newModel","selectItem","isJust","itemBox","newModel2","childMsg","mco","windowEvents","WindowEvents","documentEvents","DocumentEvents","Sub","on","evt","button","noop","t","target","classList","contains","parentElement","docMouseDown","gotKeyDown","none","succeedLazy","f","fromNative","mapFirst","c","mapSecond","cmd","toNative","ViewMenuItem","props","renderer","dispatch","onMouseMove","onMouseLeave","onClick","active","hasSubMenu","ViewMenu","renderItems","element","index","className","style","position","overflow","onContextMenu","visibility","contentRenderer","input","activeClass","gotRenderedBox","gotInitData","requestClose","handleError","console","getRefBox","windowDimensions","getInitData","andThen","placed","placedBox","initData","getRenderedBox","renderedBox","placeCombo","menuPageMsg","dropDownPageMsg","placementPageMsg","router","Router","route0","route1","str","routeToUrl","route","menuMsg","MyRenderer","defaultItemRenderer","s","mySubMenu2","mySubMenu1","myMenu","updateMenu","page","mm","menuModel","mc","closeMenu","menuPage","lastClicked","ddMsg","init","l","parseLocation","initHome","mousePos","viewportDim","indexAndModel","dropDownPageInit","pp","mode","placementPageInit","link","text","href","navigate","view","onMouseDown","viewMenuPage","xStep","Math","floor","yStep","buttons","btnIndex","padding","curBtnIndex","backgroundColor","iam","a","filter","push","border","b","ddModel","viewDropDownPage","vd","placeFct","elemDim","refDim","viewDim","viewPos","viewPlacementPage","log","menuUpdate","newMenuPage","out","mac2","menuOpen","menuPageUpdate","ddPage","ddMac","dropDownOpen","succeed","newPage","dropDownUpdate","dropDownPageUpdate","placementPageUpdate","newUrl","menuSub","menuSubscriptions","mouseMove","pageX","pageY","keyDown","menuPageSubs","dropDownSubscriptions","placementPageSubs","onUrlChange","DemoApp","devTools","DevTools","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.23097b06.chunk.js","sourcesContent":["/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nexport {\n  Model as DropDownModel,\n  Msg as DropDownMsg,\n  open as dropDownOpen,\n  update as dropDownUpdate,\n  subscriptions as dropDownSubscriptions,\n  ViewDropDown,\n  RequestClose as DropDownRequestClose,\n} from './DropDown';\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nexport class Dim {\n  constructor(readonly w: number, readonly h: number) {}\n\n  static zero: Dim = dim(0);\n}\n\nexport function dim(w: number, h?: number): Dim {\n  return new Dim(w, h ?? w);\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nexport class Pos {\n  constructor(readonly x: number, readonly y: number) {}\n\n  add(p: Pos): Pos {\n    return new Pos(this.x + p.x, this.y + p.y);\n  }\n\n  static origin: Pos = pos(0, 0);\n}\n\nexport function pos(x: number, y: number): Pos {\n  return new Pos(x, y);\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { Dim, Box } from 'tea-pop-core';\nimport { Result } from 'react-tea-cup';\nimport { MenuItem } from './Menu';\n\nexport type Msg<T> =\n  | { tag: 'got-window-dimensions'; d: Dim }\n  | { tag: 'got-uuid'; uuid: string }\n  | { tag: 'got-menu-box'; r: Result<Error, Box> }\n  | { tag: 'key-down'; key: string }\n  | { tag: 'mouse-move'; item: MenuItem<T>; itemIndex: number }\n  | { tag: 'mouse-leave'; item: MenuItem<T>; itemIndex: number }\n  | {\n      tag: 'got-item-box';\n      item: MenuItem<T>;\n      r: Result<Error, Box>;\n      selectFirst: boolean;\n      subMenuCounter: number;\n    }\n  | { tag: 'item-clicked'; item: MenuItem<T> }\n  | { tag: 'child-msg'; m: Msg<T> }\n  | { tag: 'doc-mouse-down' }\n  | { tag: 'noop' };\n\nexport function noop<T>(): Msg<T> {\n  return { tag: 'noop' };\n}\n\nexport function gotWindowDimensions<T>(d: Dim): Msg<T> {\n  return {\n    tag: 'got-window-dimensions',\n    d,\n  };\n}\n\nexport function gotUuid<T>(uuid: string): Msg<T> {\n  return {\n    tag: 'got-uuid',\n    uuid,\n  };\n}\n\nexport function gotMenuBox<T>(r: Result<Error, Box>): Msg<T> {\n  return {\n    tag: 'got-menu-box',\n    r,\n  };\n}\n\nexport function gotKeyDown<T>(key: string): Msg<T> {\n  return {\n    tag: 'key-down',\n    key,\n  };\n}\n\nexport function childMsg<T>(m: Msg<T>): Msg<T> {\n  return {\n    tag: 'child-msg',\n    m,\n  };\n}\n\nexport function gotItemBox<T>(\n  item: MenuItem<T>,\n  r: Result<Error, Box>,\n  subMenuCounter: number,\n  selectFirst: boolean,\n): Msg<T> {\n  return {\n    tag: 'got-item-box',\n    item,\n    selectFirst,\n    r,\n    subMenuCounter,\n  };\n}\n\nexport function docMouseDown<T>(): Msg<T> {\n  return {\n    tag: 'doc-mouse-down',\n  };\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport {\n  just,\n  ListWithSelection,\n  Maybe,\n  maybeOf,\n  nothing,\n  Task,\n} from 'react-tea-cup';\n\nexport class Menu<T> {\n  constructor(private readonly elements: ListWithSelection<MenuElement<T>>) {}\n\n  selectFirstItem(): Menu<T> {\n    return new Menu(this.elements.selectIndex(0));\n  }\n\n  selectItem(item: MenuItem<T>): Menu<T> {\n    return new Menu(this.elements.select((e) => e === item));\n  }\n\n  deselectAll(): Menu<T> {\n    return new Menu(ListWithSelection.fromArray(this.elements.toArray()));\n  }\n\n  get elems(): ReadonlyArray<MenuElement<T>> {\n    return this.elements.toArray();\n  }\n\n  get selectedItem(): Maybe<MenuItem<T>> {\n    const selected = this.elements.getSelected();\n    if (selected.type === 'Just' && selected.value.tag === 'item') {\n      return just(selected.value);\n    }\n    return nothing;\n  }\n\n  isSelected(item: MenuItem<T>): boolean {\n    return this.elements.isSelected(item);\n  }\n\n  private findNextItemIndex(start: number): Maybe<number> {\n    const elems = this.elems;\n    const s = start === elems.length - 1 ? 0 : start + 1;\n    for (let i = s; i < elems.length; i++) {\n      if (elems[i].tag === 'item') {\n        return just(i);\n      }\n    }\n    return nothing;\n  }\n\n  private findPreviousItemIndex(start: number): Maybe<number> {\n    const elems = this.elems;\n    const s = start === 0 ? elems.length - 1 : start - 1;\n    for (let i = s; i >= 0; i--) {\n      if (elems[i].tag === 'item') {\n        return just(i);\n      }\n    }\n    return nothing;\n  }\n\n  moveSelection(down: boolean): Menu<T> {\n    return this.elements\n      .getSelectedIndex()\n      .map((selectedIndex) => {\n        const mbNextIndex = down\n          ? this.findNextItemIndex(selectedIndex)\n          : this.findPreviousItemIndex(selectedIndex);\n        return mbNextIndex\n          .map((nextIndex) => new Menu(this.elements.selectIndex(nextIndex)))\n          .withDefault(this);\n      })\n      .withDefaultSupply(() => {\n        return new Menu(\n          this.elements.selectIndex(down ? 0 : this.elements.length() - 1),\n        );\n      });\n  }\n\n  indexOfItem(item: MenuItem<T>): Maybe<number> {\n    const i = this.elements.toArray().indexOf(item);\n    if (i === -1) {\n      return nothing;\n    }\n    return just(i);\n  }\n}\n\nexport type MenuElement<T> = MenuItem<T> | MenuSeparator;\n\nexport interface MenuItem<T> {\n  tag: 'item';\n  readonly userData: T;\n  readonly subMenu: Maybe<Menu<T>>;\n}\n\nexport interface MenuSeparator {\n  tag: 'separator';\n}\n\nexport function menu<T>(items: ReadonlyArray<MenuElement<T>>): Menu<T> {\n  return new Menu(ListWithSelection.fromArray(items));\n}\n\nexport function item<T>(userData: T, subMenu?: Menu<T>): MenuItem<T> {\n  return {\n    tag: 'item',\n    userData,\n    subMenu: maybeOf(subMenu),\n  };\n}\n\nexport const separator: MenuSeparator = {\n  tag: 'separator',\n};\n\nexport function menuId(uuid: string): string {\n  return `tm-${btoa(uuid)}`;\n}\n\nexport function menuItemId(menuId: string, itemIndex: number): string {\n  return `tm-item-${menuId}-${itemIndex}`;\n}\n\nexport function menuTask(uuid: string): Task<Error, HTMLElement> {\n  return byId(menuId(uuid));\n}\n\nexport function menuItemTask(\n  menuId: string,\n  itemIndex: number,\n): Task<Error, HTMLElement> {\n  return byId(menuItemId(menuId, itemIndex));\n}\n\nfunction byId(id: string): Task<Error, HTMLElement> {\n  return Task.fromLambda(() => {\n    const e = document.getElementById(id);\n    if (e === null) {\n      throw new Error('element not found with id:' + id);\n    }\n    return e;\n  });\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { pos, Pos } from './Pos';\nimport { dim, Dim } from './Dim';\n\nexport class Box {\n  constructor(readonly p: Pos, readonly d: Dim) {}\n\n  static fromDomRect(rect: DOMRect): Box {\n    const { x, y, height, width } = rect;\n    return box(pos(x, y), dim(width, height));\n  }\n\n  get topLeft(): Pos {\n    return this.p;\n  }\n\n  get bottomRight(): Pos {\n    return pos(this.right, this.bottom);\n  }\n\n  get left(): number {\n    return this.p.x;\n  }\n\n  get right() {\n    return this.left + this.d.w;\n  }\n\n  get top() {\n    return this.p.y;\n  }\n\n  get bottom() {\n    return this.top + this.d.h;\n  }\n\n  isPointInside(pos: Pos): boolean {\n    return !(\n      pos.x < this.left ||\n      pos.x > this.right ||\n      pos.y < this.top ||\n      pos.y > this.bottom\n    );\n  }\n\n  isBoxInside(box: Box): boolean {\n    return this.isPointInside(box.topLeft) && this.isPointInside(box.bottomRight);\n  }\n}\n\nexport function box(p: Pos, d: Dim): Box {\n  return new Box(p, d);\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { Menu } from './Menu';\nimport { Maybe, nothing } from 'react-tea-cup';\nimport { Box, Dim } from 'tea-pop-core';\n\nexport interface Model<T> {\n  readonly uuid: Maybe<string>;\n  readonly windowSize: Maybe<Dim>;\n  readonly menu: Menu<T>;\n  readonly state: MenuState;\n  readonly error: Maybe<Error>;\n  readonly child: Maybe<Model<T>>;\n  readonly navigatedWithKeyboard: boolean;\n  readonly subMenuCounter: number;\n}\n\nexport function initialModel<T>(menu: Menu<T>, refBox: Box): Model<T> {\n  return {\n    uuid: nothing,\n    windowSize: nothing,\n    menu,\n    state: menuStatePlacing(refBox),\n    error: nothing,\n    child: nothing,\n    navigatedWithKeyboard: false,\n    subMenuCounter: 0,\n  };\n}\n\nexport type MenuState =\n  | { tag: 'placing'; refBox: Box }\n  | { tag: 'open'; box: Box };\n\nexport function menuStatePlacing(refBox: Box): MenuState {\n  return {\n    tag: 'placing',\n    refBox,\n  };\n}\n\nexport function keyboardNavigated<T>(\n  model: Model<T>,\n  navigatedWithKeyboard = true,\n): Model<T> {\n  return { ...model, navigatedWithKeyboard };\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\ninterface Evt {\n  preventDefault(): void;\n  stopPropagation(): void;\n}\n\ntype EventHandler = (e: Evt) => void;\n\nexport const stopEvent: EventHandler = (e) => {\n  e.preventDefault();\n  e.stopPropagation();\n};\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { box, Box } from './Box';\nimport { dim, Dim } from './Dim';\nimport { pos } from './Pos';\n\nexport function place(viewport: Dim, refBox: Box, elem: Dim): Box {\n  const pX = place1DEnd(viewport.w, refBox.p.x, refBox.d.w, elem.w);\n  const pY = place1DStart(viewport.h, refBox.p.y, refBox.d.h, elem.h);\n  return box(pos(pX.offset, pY.offset), dim(pX.len, pY.len));\n}\n\nexport function placeCombo(viewport: Dim, refBox: Box, elem: Dim): Box {\n  const pX = place1DStart(viewport.w, refBox.p.x, refBox.d.w, elem.w);\n  const pY = placeComboY(viewport.h, refBox.p.y, refBox.d.h, elem.h);\n  return box(pos(pX.offset, pY.offset), dim(pX.len, pY.len));\n}\n\ninterface Placed1D {\n  readonly offset: number;\n  readonly len: number;\n}\n\nexport function place1DEnd(\n  viewportW: number,\n  refX: number,\n  refW: number,\n  elemW: number,\n): Placed1D {\n  if (refX + refW + elemW > viewportW) {\n    // not enough space after, try before\n    if (elemW < refX) {\n      // ok, prepend\n      return { offset: refX - elemW, len: elemW };\n    } else {\n      // not enough space before or after, we have to translate and/or expand !\n      if (elemW < viewportW) {\n        // can't append or prepend, but no need to shrink... translate only\n        const delta = refX + refW + elemW - viewportW;\n        return { offset: refX + refW - delta, len: elemW };\n      }\n      return { offset: 0, len: viewportW };\n    }\n  } else {\n    // enough space to append\n    return { offset: refX + refW, len: elemW };\n  }\n}\n\nexport function place1DStart(\n  viewportW: number,\n  refX: number,\n  refW: number,\n  elemW: number,\n): Placed1D {\n  if (elemW > viewportW) {\n    return { offset: 0, len: viewportW };\n  }\n  if (refX + elemW > viewportW) {\n    // not enough space after, try before\n    if (elemW < refX + refW) {\n      // ok, prepend\n      return { offset: refX + refW - elemW, len: elemW };\n    } else {\n      // not enough space before or after, we have to translate and/or expand !\n      if (elemW < viewportW) {\n        // can't append or prepend, but no need to shrink... translate only\n        const delta = refX + refW + elemW - viewportW;\n        return { offset: refX + refW - delta, len: elemW };\n      }\n      return { offset: 0, len: 10 };\n    }\n  } else {\n    // enough space to append\n    return { offset: refX, len: elemW };\n  }\n}\n\nfunction placeComboY(\n  viewportW: number,\n  refX: number,\n  refW: number,\n  elemW: number,\n): Placed1D {\n  const elemEnd = refX + refW;\n  const spaceBefore = refX;\n  const spaceAfter = viewportW - elemEnd;\n  if (elemW < spaceAfter) {\n    // enough space after, append\n    return { offset: elemEnd, len: elemW };\n  } else if (elemW < spaceBefore) {\n    // enough space before, append\n    return { offset: refX - elemW, len: elemW };\n  } else {\n    // not enough space, need to shrink\n    // use the most space\n    if (spaceBefore > spaceAfter) {\n      // place before\n      return { offset: 0, len: spaceBefore };\n    } else {\n      return { offset: elemEnd, len: spaceAfter };\n    }\n  }\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALIxNGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { dim, Dim } from './Dim';\n\nexport function windowDimensions(): Dim {\n  return dim(window.innerWidth, window.innerHeight);\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport {\n  childMsg,\n  docMouseDown,\n  gotItemBox,\n  gotKeyDown,\n  gotMenuBox,\n  gotUuid,\n  gotWindowDimensions,\n  Msg,\n  noop,\n} from './Msg';\nimport {\n  Cmd,\n  DocumentEvents,\n  just,\n  Maybe,\n  noCmd,\n  nothing,\n  Sub,\n  Task,\n  Tuple,\n  uuid,\n  WindowEvents,\n} from 'react-tea-cup';\nimport { initialModel, keyboardNavigated, Model } from './Model';\nimport { Menu, MenuItem, menuItemTask, menuTask } from './Menu';\nimport { dim, Dim, Box, place } from 'tea-pop-core';\nimport { OutMsg } from './OutMsg';\n\nexport function open<T>(\n  menu: Menu<T>,\n  refBox: Box,\n  selectFirst = false,\n): [Model<T>, Cmd<Msg<T>>] {\n  return [\n    initialModel(\n      selectFirst ? menu.selectFirstItem() : menu.deselectAll(),\n      refBox,\n    ),\n    Cmd.batch([\n      Task.perform(getWindowDimensions, (d) => gotWindowDimensions(d)),\n      Task.perform(uuid(), (u) => gotUuid(u)),\n    ]),\n  ];\n}\n\nfunction postOpen<T>(model: Model<T>): [Model<T>, Cmd<Msg<T>>] {\n  if (model.uuid.type === 'Nothing') {\n    return noCmd(model);\n  }\n  if (model.windowSize.type === 'Nothing') {\n    return noCmd(model);\n  }\n  const cmd: Cmd<Msg<T>> = Task.attempt(\n    menuTask(model.uuid.value).map((e) => {\n      return Box.fromDomRect(e.getBoundingClientRect());\n    }),\n    (x) => gotMenuBox(x),\n  );\n  return [model, cmd];\n}\n\nfunction withOut<T>(\n  mac: [Model<T>, Cmd<Msg<T>>],\n  outMsg: Maybe<OutMsg<T>> = nothing,\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  return [mac[0], mac[1], outMsg];\n}\n\nexport function update<T>(\n  msg: Msg<T>,\n  model: Model<T>,\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  switch (msg.tag) {\n    case 'got-window-dimensions': {\n      return withOut(\n        postOpen({\n          ...model,\n          windowSize: just(msg.d),\n        }),\n      );\n    }\n    case 'got-uuid': {\n      return withOut(\n        postOpen({\n          ...model,\n          uuid: just(msg.uuid),\n        }),\n      );\n    }\n    case 'got-menu-box': {\n      if (model.state.tag === 'placing') {\n        const state = model.state;\n        return withOut(\n          noCmd(\n            model.windowSize\n              .map((windowSize) => {\n                const newModel: Model<T> = msg.r.match(\n                  (menuBox) =>\n                    ({\n                      ...model,\n                      state: {\n                        tag: 'open',\n                        box: place(windowSize, state.refBox, menuBox.d),\n                      },\n                    } as Model<T>),\n                  (err) => ({\n                    ...model,\n                    error: just(err),\n                  }),\n                );\n                return newModel;\n              })\n              .withDefault(model),\n          ),\n        );\n      }\n      return withOut(noCmd(model));\n    }\n\n    case 'key-down': {\n      switch (msg.key) {\n        case 'Escape': {\n          return withOut(\n            collapseLastSubMenu(keyboardNavigated(model)),\n            model.child.isNothing() ? just({ tag: 'request-close' }) : nothing,\n          );\n        }\n        case 'ArrowDown':\n        case 'ArrowUp': {\n          return mapLastMenu(keyboardNavigated(model), (lastModel) => {\n            return withOut(\n              noCmd({\n                ...lastModel,\n                menu: lastModel.menu.moveSelection(msg.key === 'ArrowDown'),\n              }),\n            );\n          });\n        }\n        case 'ArrowLeft':\n          return withOut(collapseLastSubMenu(keyboardNavigated(model)));\n        case 'ArrowRight':\n          return expandLastSubMenu(keyboardNavigated(model));\n        case 'Enter':\n        case ' ': {\n          return toggleOrSelectItem(model);\n        }\n        default:\n          return withOut(noCmd(model));\n      }\n    }\n    case 'mouse-move': {\n      if (model.menu.isSelected(msg.item)) {\n        return withOut(noCmd(model));\n      }\n      const newModel = { ...model, subMenuCounter: model.subMenuCounter + 1 };\n      if (model.navigatedWithKeyboard) {\n        return withOut(noCmd(keyboardNavigated(newModel, false)));\n      }\n      if (model.uuid.type === 'Nothing') {\n        return withOut(noCmd(newModel));\n      }\n      const menu = model.menu.selectItem(msg.item);\n      const uuid = model.uuid.value;\n      return withOut(\n        openSubMenu(\n          { ...newModel, menu, child: nothing },\n          uuid,\n          msg.item,\n          msg.itemIndex,\n          false,\n        ),\n      );\n    }\n    case 'mouse-leave': {\n      return withOut(\n        noCmd(\n          model.child.isJust()\n            ? model\n            : { ...model, menu: model.menu.deselectAll() },\n        ),\n      );\n    }\n    case 'got-item-box': {\n      if (msg.subMenuCounter !== model.subMenuCounter) {\n        return withOut(noCmd(model));\n      }\n      return withOut(\n        msg.r.match(\n          (itemBox) => {\n            const newModel: Model<T> = {\n              ...model,\n              menu: model.menu.selectItem(msg.item),\n            };\n            return msg.item.subMenu\n              .map((subMenu) => {\n                // we have a sub menu so we need\n                // to open a new Menu !\n                const mac = open(subMenu, itemBox, msg.selectFirst);\n                const newModel2: Model<T> = {\n                  ...newModel,\n                  child: just(mac[0]),\n                };\n                return Tuple.t2n(newModel2, mac[1].map(childMsg));\n              })\n              .withDefaultSupply(() => {\n                // close any existing child !\n                return newModel.child\n                  .map(() =>\n                    noCmd<Model<T>, Msg<T>>({ ...model, child: nothing }),\n                  )\n                  .withDefaultSupply(() => noCmd(model));\n              });\n          },\n          (err) => noCmd({ ...model, error: just(err) }),\n        ),\n      );\n    }\n    case 'child-msg': {\n      return model.child\n        .map((child) => {\n          const mco = update(msg.m, child);\n          const newModel: Model<T> = {\n            ...model,\n            child: just(mco[0]),\n          };\n          return withOut(Tuple.t2n(newModel, mco[1].map(childMsg)), mco[2]);\n        })\n        .withDefaultSupply(() => withOut(noCmd(model)));\n    }\n    case 'item-clicked': {\n      return withOut(noCmd(model), outItemSelected(msg.item));\n    }\n    case 'doc-mouse-down': {\n      return withOut(noCmd(model), just({ tag: 'request-close' }));\n    }\n    case 'noop': {\n      return withOut(noCmd(model));\n    }\n  }\n}\n\nfunction outItemSelected<T>(item: MenuItem<T>): Maybe<OutMsg<T>> {\n  return just({ tag: 'item-selected', data: item.userData });\n}\n\nfunction openSubMenu<T>(\n  model: Model<T>,\n  menuId: string,\n  item: MenuItem<T>,\n  itemIndex: number,\n  selectFirst: boolean,\n): [Model<T>, Cmd<Msg<T>>] {\n  if (item.subMenu.isNothing()) {\n    return noCmd(model);\n  }\n  const subMenuCounter = model.subMenuCounter + 1;\n  return Tuple.t2n(\n    { ...model, subMenuCounter },\n    Task.attempt(\n      menuItemTask(menuId, itemIndex).map((e) => {\n        return Box.fromDomRect(e.getBoundingClientRect());\n      }),\n      (r) => gotItemBox(item, r, subMenuCounter, selectFirst),\n    ),\n  );\n}\n\nconst windowEvents = new WindowEvents();\nconst documentEvents = new DocumentEvents();\n\nexport function subscriptions<T>(model: Model<T>): Sub<Msg<T>> {\n  return Sub.batch([\n    windowEvents.on('resize', () =>\n      gotWindowDimensions(dim(window.innerWidth, window.innerHeight)),\n    ),\n    documentEvents.on('mousedown', (evt) => {\n      if (evt.button === 2) {\n        return noop();\n      }\n      let t: HTMLElement | null = evt.target as HTMLElement;\n      while (t) {\n        // move up and try to find if we are inside a tea-pop Menu !\n        if (t.classList.contains('tm')) {\n          return noop();\n        }\n        t = t.parentElement;\n      }\n      return docMouseDown();\n    }),\n    model.state.tag === 'open'\n      ? documentEvents.on('keydown', (e) => gotKeyDown(e.key))\n      : Sub.none(),\n  ]);\n}\n\nconst getWindowDimensions: Task<never, Dim> = Task.succeedLazy(() =>\n  dim(window.innerWidth, window.innerHeight),\n);\n\nfunction mapLastMenu<T>(\n  model: Model<T>,\n  f: (m: Model<T>) => [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>],\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  switch (model.child.type) {\n    case 'Nothing': {\n      // I'm the last model !\n      return f(model);\n    }\n    case 'Just': {\n      const mac = mapLastMenu(model.child.value, f);\n      return [{ ...model, child: just(mac[0]) }, mac[1].map(childMsg), mac[2]];\n    }\n  }\n}\n\nfunction collapseLastSubMenu<T>(model: Model<T>): [Model<T>, Cmd<Msg<T>>] {\n  switch (model.child.type) {\n    case 'Nothing':\n      return noCmd(model);\n    case 'Just': {\n      // I have a child : close it if he has no child !\n      const child = model.child.value;\n      if (child.child.isJust()) {\n        return Tuple.fromNative(collapseLastSubMenu(child))\n          .mapFirst((c) => ({ ...model, child: just(c) }))\n          .mapSecond((cmd) => cmd.map(childMsg))\n          .toNative();\n      } else {\n        return noCmd({\n          ...model,\n          child: nothing,\n        });\n      }\n    }\n  }\n}\n\nfunction expandLastSubMenu<T>(\n  model: Model<T>,\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  return mapLastMenu(model, (lastModel) => {\n    return lastModel.menu.selectedItem\n      .map((selectedItem) => {\n        return selectedItem.subMenu\n          .map(() => {\n            if (lastModel.uuid.type === 'Nothing') {\n              return withOut(noCmd<Model<T>, Msg<T>>(lastModel));\n            }\n            const uuid = lastModel.uuid.value;\n            const mac: [Model<T>, Cmd<Msg<T>>] = lastModel.menu\n              .indexOfItem(selectedItem)\n              .map((itemIndex) => {\n                return openSubMenu(\n                  lastModel,\n                  uuid,\n                  selectedItem,\n                  itemIndex,\n                  true,\n                );\n              })\n              .withDefaultSupply(() => noCmd(lastModel));\n            return withOut(mac);\n          })\n          .withDefaultSupply(() => {\n            return withOut(noCmd(lastModel));\n          });\n      })\n      .withDefaultSupply(() => {\n        return withOut(noCmd(lastModel));\n      });\n  });\n}\n\nfunction toggleOrSelectItem<T>(\n  model: Model<T>,\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  return mapLastMenu(model, (lastModel) => {\n    return lastModel.menu.selectedItem\n      .map((selectedItem) => {\n        if (lastModel.uuid.type === 'Nothing') {\n          return withOut(noCmd<Model<T>, Msg<T>>(lastModel));\n        }\n        const uuid = lastModel.uuid.value;\n        // do we have a sub-menu ?\n        return selectedItem.subMenu\n          .map(() => {\n            // we have a sub-menu, expand it\n            const mac: [Model<T>, Cmd<Msg<T>>] = lastModel.menu\n              .indexOfItem(selectedItem)\n              .map((itemIndex) =>\n                openSubMenu(lastModel, uuid, selectedItem, itemIndex, true),\n              )\n              .withDefaultSupply(() => noCmd(lastModel));\n            return withOut(mac);\n          })\n          .withDefaultSupply(() => {\n            // no sub-menu, select the item\n            return withOut(noCmd(lastModel), outItemSelected(selectedItem));\n          });\n      })\n      .withDefaultSupply(() => withOut(noCmd(lastModel)));\n  });\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport * as React from 'react';\nimport { Menu, menuId, MenuItem, menuItemId } from './Menu';\nimport { childMsg, Msg } from './Msg';\nimport { Dispatcher, map } from 'react-tea-cup';\nimport { ItemRenderer } from './ItemRenderer';\nimport { Model } from './Model';\nimport { stopEvent } from 'tea-pop-core';\n\nexport interface ViewMenuProps<T> {\n  model: Model<T>;\n  dispatch: Dispatcher<Msg<T>>;\n  renderer: ItemRenderer<T>;\n}\n\nexport function ViewMenu<T>(props: ViewMenuProps<T>): React.ReactElement {\n  const { model, dispatch, renderer } = props;\n  const { menu, state, uuid, windowSize } = model;\n  if (uuid.type === 'Nothing') {\n    return <></>;\n  }\n  if (windowSize.type === 'Nothing') {\n    return <></>;\n  }\n\n  const renderItems = () =>\n    menu.elems.map((element, index) => {\n      switch (element.tag) {\n        case 'item': {\n          return (\n            <ViewMenuItem\n              key={`item-${index}`}\n              uuid={uuid.value}\n              itemIndex={index}\n              menu={menu}\n              item={element}\n              {...props}\n            />\n          );\n        }\n        case 'separator': {\n          return <div key={`sep-${index}`} className=\"tm-separator\" />;\n        }\n      }\n    });\n\n  switch (state.tag) {\n    case 'placing': {\n      const { refBox } = state;\n      return (\n        <div\n          className=\"tm-placer\"\n          style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            bottom: 0,\n            right: 0,\n            overflow: 'hidden',\n          }}\n          onContextMenu={stopEvent}\n        >\n          <div\n            className=\"tm\"\n            id={menuId(uuid.value)}\n            style={{\n              position: 'absolute',\n              top: refBox.p.y,\n              left: refBox.p.x,\n              visibility: 'hidden',\n            }}\n            onContextMenu={stopEvent}\n          >\n            {renderItems()}\n          </div>\n        </div>\n      );\n    }\n    case 'open': {\n      const { box } = state;\n      const { p, d } = box;\n      return (\n        <>\n          <div\n            className=\"tm\"\n            id={menuId(uuid.value)}\n            style={{\n              position: 'absolute',\n              top: p.y,\n              left: p.x,\n              width: d.w,\n              height: d.h,\n            }}\n            onContextMenu={stopEvent}\n          >\n            {renderItems()}\n          </div>\n          {model.child\n            .map((child) => (\n              <ViewMenu\n                model={child}\n                dispatch={map(dispatch, childMsg)}\n                renderer={renderer}\n              />\n            ))\n            .withDefaultSupply(() => (\n              <></>\n            ))}\n        </>\n      );\n    }\n  }\n}\n\nexport interface ViewMenuItemProps<T> {\n  uuid: string;\n  itemIndex: number;\n  menu: Menu<T>;\n  item: MenuItem<T>;\n  dispatch: Dispatcher<Msg<T>>;\n  renderer: ItemRenderer<T>;\n}\n\nexport function ViewMenuItem<T>(\n  props: ViewMenuItemProps<T>,\n): React.ReactElement {\n  const { menu, item, renderer, dispatch, uuid, itemIndex } = props;\n  const selected = menu.isSelected(item);\n  return (\n    <div\n      id={menuItemId(uuid, itemIndex)}\n      onMouseMove={() => dispatch({ tag: 'mouse-move', item, itemIndex })}\n      onMouseLeave={() => dispatch({ tag: 'mouse-leave', item, itemIndex })}\n      onClick={() => {\n        dispatch({ tag: 'item-clicked', item });\n      }}\n    >\n      {renderer({\n        data: item.userData,\n        active: selected,\n        hasSubMenu: item.subMenu.isJust(),\n      })}\n    </div>\n  );\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport * as React from 'react';\n\nexport interface RendererInput<T> {\n  readonly data: T;\n  readonly active: boolean;\n  readonly hasSubMenu: boolean;\n}\n\nexport type ItemRenderer<T> = (input: RendererInput<T>) => React.ReactNode;\n\nexport function defaultItemRenderer<T>(\n  contentRenderer: (t: T) => React.ReactNode,\n): ItemRenderer<T> {\n  return (input) => {\n    const { data, active, hasSubMenu } = input;\n    const activeClass = active ? ' tm-active' : '';\n    return (\n      <div className={`tm-item${activeClass}`}>\n        <div className=\"tm-item__content\">{contentRenderer(data)}</div>\n        {hasSubMenu ? <div className=\"tm-item__submenu\">›</div> : <></>}\n      </div>\n    );\n  };\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport * as React from 'react';\nimport { Box, Dim, placeCombo, windowDimensions } from 'tea-pop-core';\nimport {\n  Cmd,\n  DocumentEvents,\n  just,\n  Maybe,\n  noCmd,\n  nothing,\n  Result,\n  Sub,\n  Task,\n  uuid,\n} from 'react-tea-cup';\n\nexport type Model =\n  | { tag: 'fresh' }\n  | {\n      tag: 'ready';\n      initData: InitData;\n      placed: Maybe<Box>;\n    }\n  | { tag: 'error'; e: Error };\n\nfunction errorModel(e: Error): Model {\n  return {\n    tag: 'error',\n    e,\n  };\n}\n\ninterface InitData {\n  readonly refBox: Box;\n  readonly windowDimensions: Dim;\n  readonly uuid: string;\n}\n\nexport type Msg =\n  | { tag: 'got-init-data'; r: Result<Error, InitData> }\n  | { tag: 'got-rendered-box'; r: Result<Error, Box> }\n  | { tag: 'request-close' }\n  | { tag: 'noop' };\n\nfunction gotRenderedBox(r: Result<Error, Box>): Msg {\n  return {\n    tag: 'got-rendered-box',\n    r,\n  };\n}\n\nfunction gotInitData(r: Result<Error, InitData>): Msg {\n  return {\n    tag: 'got-init-data',\n    r,\n  };\n}\n\nconst noop: Msg = {\n  tag: 'noop',\n};\n\nconst requestClose: Msg = {\n  tag: 'request-close',\n};\n\nexport type Renderer = () => React.ReactNode;\n\nexport function open(getRefBox: Task<Error, Box>): [Model, Cmd<Msg>] {\n  const model: Model = {\n    tag: 'fresh',\n  };\n  const getWindowDimensions: Task<never, Dim> = Task.succeedLazy(() =>\n    windowDimensions(),\n  );\n  const getInitData: Task<Error, InitData> = getRefBox.andThen((refBox) =>\n    getWindowDimensions.andThen((windowDimensions) =>\n      uuid().map((uuid) => ({ refBox, windowDimensions, uuid })),\n    ),\n  );\n\n  const cmd: Cmd<Msg> = Task.attempt(getInitData, gotInitData);\n  return [model, cmd];\n}\n\nexport interface ViewDropDownProps {\n  readonly renderer: Renderer;\n  readonly model: Model;\n}\n\nexport function ViewDropDown(props: ViewDropDownProps): React.ReactElement {\n  const { renderer, model } = props;\n  switch (model.tag) {\n    case 'fresh': {\n      return (\n        <div\n          className=\"tm-drop-down tm-placing\"\n          style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            visibility: 'hidden',\n          }}\n        >\n          {renderer()}\n        </div>\n      );\n    }\n    case 'error': {\n      return <></>; // TODO ?\n    }\n    case 'ready': {\n      return model.placed\n        .map((placedBox) => {\n          const { p, d } = placedBox;\n          return (\n            <div\n              id={model.initData.uuid}\n              className=\"tm-drop-down tm-placed\"\n              style={{\n                position: 'absolute',\n                top: p.y,\n                left: p.x,\n                width: d.w,\n                height: d.h,\n              }}\n            >\n              {renderer()}\n            </div>\n          );\n        })\n        .withDefaultSupply(() => {\n          return (\n            <div\n              id={model.initData.uuid}\n              className=\"tm-drop-down tm-placing\"\n              style={{\n                position: 'absolute',\n                top: 0,\n                left: 0,\n                visibility: 'hidden',\n              }}\n            >\n              {renderer()}\n            </div>\n          );\n        });\n    }\n  }\n}\n\nfunction handleError(error: Error): [Model, Cmd<Msg>, RequestClose] {\n  console.error(error);\n  return withOut(noCmd(errorModel(error)));\n}\n\nexport type RequestClose = boolean;\n\nfunction withOut(\n  mac: [Model, Cmd<Msg>],\n  requestClose: RequestClose = false,\n): [Model, Cmd<Msg>, RequestClose] {\n  return [mac[0], mac[1], requestClose];\n}\n\nexport function update(\n  msg: Msg,\n  model: Model,\n): [Model, Cmd<Msg>, RequestClose] {\n  switch (msg.tag) {\n    case 'got-init-data': {\n      if (model.tag !== 'fresh') {\n        return withOut(noCmd(model));\n      }\n      return msg.r.match((initData) => {\n        const newModel: Model = {\n          tag: 'ready',\n          initData,\n          placed: nothing,\n        };\n        const cmd: Cmd<Msg> = Task.attempt(\n          getRenderedBox(initData.uuid),\n          gotRenderedBox,\n        );\n        return [newModel, cmd, false];\n      }, handleError);\n    }\n    case 'got-rendered-box': {\n      return msg.r.match((renderedBox) => {\n        if (model.tag !== 'ready') {\n          return withOut(noCmd(model));\n        }\n        const { initData } = model;\n        const { windowDimensions, refBox } = initData;\n        const placedBox = placeCombo(windowDimensions, refBox, renderedBox.d);\n        return withOut(\n          noCmd({\n            ...model,\n            placed: just(placedBox),\n          }),\n        );\n      }, handleError);\n    }\n    case 'request-close': {\n      return withOut([model, Cmd.none()], true);\n    }\n    case 'noop': {\n      return withOut(noCmd(model));\n    }\n  }\n}\n\nfunction getRenderedBox(uuid: string): Task<Error, Box> {\n  return byId(uuid).map((elem) =>\n    Box.fromDomRect(elem.getBoundingClientRect()),\n  );\n}\n\nfunction byId(id: string): Task<Error, HTMLElement> {\n  return Task.fromLambda(() => {\n    const e = document.getElementById(id);\n    if (!e) {\n      throw new Error('element not found ' + id);\n    }\n    return e;\n  });\n}\n\nconst documentEvents = new DocumentEvents();\n\nexport function subscriptions(): Sub<Msg> {\n  return Sub.batch([\n    documentEvents.on('keydown', (e) =>\n      e.key === 'Escape' ? requestClose : noop,\n    ),\n    documentEvents.on('mousedown', (evt) => {\n      let t: HTMLElement | null = evt.target as HTMLElement;\n      while (t) {\n        // move up and try to find if we are inside a tea-pop DD !\n        if (t.classList.contains('tm-drop-down')) {\n          return noop;\n        }\n        t = t.parentElement;\n      }\n      return requestClose;\n    }),\n  ]);\n}\n","import {MenuPageMsg} from \"./menu-page/MenuPageMsg\";\nimport {DropDownPageMsg} from \"./dropdown-page/DropDownPageMsg\";\nimport {PlacementPageMsg} from \"./placement-page/PlacementPageMsg\";\nimport {Route} from \"./routes\";\n\nexport type Msg =\n    | { tag: 'url-change'; l: Location }\n    | { tag: 'menu-page-msg'; msg: MenuPageMsg }\n    | { tag: 'dd-page-msg', msg: DropDownPageMsg }\n    | { tag: 'placement-page-msg', msg: PlacementPageMsg }\n    | { tag: 'navigate', route: Route }\n    | { tag: 'noop' }\n\nexport const noop: Msg = { tag: \"noop\" }\n\n\nexport function navigate(route: Route): Msg {\n  return {\n    tag: \"navigate\",\n    route\n  }\n}\n\nexport function menuPageMsg(msg: MenuPageMsg): Msg {\n  return {\n    tag: 'menu-page-msg',\n    msg\n  }\n}\n\nexport function dropDownPageMsg(msg: DropDownPageMsg): Msg {\n  return {\n    tag: \"dd-page-msg\",\n    msg\n  }\n}\n\nexport function placementPageMsg(msg: PlacementPageMsg): Msg {\n  return {\n    tag: \"placement-page-msg\",\n    msg\n  }\n}\n","import {Cmd, newUrl, route0, route1, Router, str, Task} from \"react-tea-cup\";\nimport {Msg, noop} from \"./Msg\";\n\nexport type Route = 'home' | 'menu' | 'dropdown' | 'placement'\n\nexport const router: Router<Route> = new Router<Route>(\n    route0.map(() => 'home'),\n    route1(str(\"menu\")).map(() => 'menu'),\n    route1(str(\"dropdown\")).map(() => 'dropdown'),\n    route1(str(\"placement\")).map(() => 'placement'),\n)\n\nexport function routeToUrl(route: Route): string {\n  switch (route) {\n    case \"home\": {\n      return \"/\";\n    }\n    default:\n      return \"/\" + route;\n  }\n}\n\nexport function navigateTo(route: Route): Cmd<Msg> {\n  return Task.perform(\n    newUrl(routeToUrl(route)),\n      () => noop\n  );\n}\n","import {Msg as MenuMsg} from \"tea-pop-menu\";\nimport {Pos} from \"tea-pop-core\";\n\nexport type MyMenuMsg = MenuMsg<string>\n\nexport type MenuPageMsg =\n    | { tag: 'menu-msg', msg: MyMenuMsg }\n    | { tag: 'mouse-move', pos: Pos }\n    | { tag: 'mouse-down', button: number }\n    | { tag: 'key-down', key: string }\n\nexport function menuMsg(msg: MyMenuMsg): MenuPageMsg {\n  return {\n    tag: \"menu-msg\",\n    msg\n  }\n}\n\nexport function onMouseMove(pos: Pos): MenuPageMsg {\n  return {\n    tag: \"mouse-move\", pos\n  }\n}\n\nexport function onKeyDown(key: string): MenuPageMsg {\n  return {\n    tag: \"key-down\", key\n  }\n}\n","import * as React from 'react';\nimport {Dispatcher, map} from \"react-tea-cup\";\nimport {MenuPage} from \"./MenuPage\";\nimport {stopEvent} from \"tea-pop-core\";\nimport {defaultItemRenderer, ViewMenu} from \"tea-pop-menu\";\nimport {menuMsg, MenuPageMsg} from \"./MenuPageMsg\";\n\nconst MyRenderer = defaultItemRenderer((s: string) => <span>{s}</span>);\n\nexport function viewMenuPage(dispatch: Dispatcher<MenuPageMsg>, page: MenuPage) {\n  return (\n      <>\n        <div\n            className=\"demo\"\n            onContextMenu={stopEvent}\n            onMouseDown={e => dispatch({tag: 'mouse-down', button: e.button})}\n        >\n          {page.menuModel\n              .map(() => <span>Menu is open</span>)\n              .withDefaultSupply(() =>\n                  page.lastClicked\n                      .map(lastClicked => <span>You selected <em>{lastClicked}</em></span>)\n                      .withDefaultSupply(() =>\n                          <>\n                            <div>Right-click anywhere, or use the <code>≣</code> key.</div>\n                          </>\n                      )\n              )\n          }\n        </div>\n        {page.menuModel\n            .map(menuModel =>\n                <ViewMenu\n                    model={menuModel}\n                    dispatch={map(dispatch, menuMsg)}\n                    renderer={MyRenderer}\n                />\n            )\n            .withDefault(<></>)\n        }\n      </>\n  )\n}\n","// just to avoid too much typing\nimport {item, menu, Menu, Model as MenuModel, separator} from \"tea-pop-menu\";\nimport {Maybe} from \"react-tea-cup\";\nimport {Pos} from \"tea-pop-core\";\n\nexport type MyMenuModel = MenuModel<string>\n\nexport interface MenuPage {\n  tag: 'menu';\n  readonly mousePos: Pos;\n  // ref to the tea-pop model\n  readonly menuModel: Maybe<MyMenuModel>;\n  // keep last clicked item\n  readonly lastClicked: Maybe<string>;\n}\n\nexport const mySubMenu2: Menu<string> = menu([\n  item(\"Try\"),\n  item(\"Finally\")\n])\n\nexport const mySubMenu1: Menu<string> = menu([\n  item(\"Do this\"),\n  item(\"Do that\"),\n  separator,\n  item(\"Another sub menu...\", mySubMenu2)\n])\n\nexport const myMenu: Menu<string> = menu([\n  item(\"Yalla\", mySubMenu1),\n  separator,\n  item(\"Copy\"),\n  item(\"Cut\"),\n  item(\"Paste\"),\n  separator,\n  item(\"I am a bit longer\")\n]);\n","import {MenuPage, myMenu, MyMenuModel} from \"./MenuPage\";\nimport {menuMsg, MenuPageMsg, MyMenuMsg, onKeyDown, onMouseMove} from \"./MenuPageMsg\";\nimport {Cmd, DocumentEvents, just, Maybe, noCmd, nothing, Sub, Tuple} from \"react-tea-cup\";\nimport {\n  open as menuOpen,\n  OutMsg as MenuOutMsg,\n  subscriptions as menuSubscriptions,\n  update as menuUpdate\n} from \"tea-pop-menu\";\nimport {box, Dim, pos, Pos} from \"tea-pop-core\";\n\n\nexport function menuPageInit(): [MenuPage, Cmd<MenuPageMsg>] {\n  return noCmd({\n    tag: \"menu\",\n    mousePos: Pos.origin,\n    lastClicked: nothing,\n    menuModel: nothing,\n  })\n}\n\nexport function menuPageUpdate(msg: MenuPageMsg, menuPage: MenuPage): [MenuPage, Cmd<MenuPageMsg>] {\n  switch (msg.tag) {\n    case \"menu-msg\": {\n      console.log(\"menu-msg\", msg.msg);\n      return menuPage.menuModel\n          .map(menuModel => {\n            const mco = menuUpdate(msg.msg, menuModel);\n            const newMenuPage: MenuPage = {\n              ...menuPage,\n              menuModel: just(mco[0])\n            };\n            const cmd: Cmd<MenuPageMsg> = mco[1].map(menuMsg);\n            const outMsg: Maybe<MenuOutMsg<string>> = mco[2];\n            return outMsg\n                // eslint-disable-next-line array-callback-return\n                .map(out => {\n                  switch (out.tag) {\n                    case \"request-close\": {\n                      const mac2 = closeMenu(newMenuPage);\n                      return Tuple.fromNative(mac2).mapSecond(c => Cmd.batch([cmd, c])).toNative();\n                    }\n                    case \"item-selected\": {\n                      const mac2 = closeMenu(newMenuPage, just(out.data));\n                      return Tuple.fromNative(mac2).mapSecond(c => Cmd.batch([cmd, c])).toNative();\n                    }\n                  }\n                })\n                .withDefaultSupply(() => Tuple.t2n(newMenuPage, cmd));\n          })\n          .withDefaultSupply(() => noCmd(menuPage));\n    }\n    case \"mouse-down\": {\n      console.log(\"down\", menuPage.mousePos);\n      // open menu on right click\n      if (msg.button === 2) {\n        return updateMenu(menuPage, menuOpen(myMenu, box(menuPage.mousePos, Dim.zero)));\n      }\n      return noCmd(menuPage);\n    }\n    case \"mouse-move\": {\n      console.log(\"move\", msg.pos);\n      return noCmd({...menuPage, mousePos: msg.pos });\n    }\n    case \"key-down\": {\n      // open menu on context menu key\n      if (msg.key === 'ContextMenu') {\n        return updateMenu(menuPage, menuOpen(myMenu, box(menuPage.mousePos, Dim.zero)));\n      }\n      return noCmd(menuPage);\n    }\n  }\n}\n\nconst documentEvents = new DocumentEvents();\n\nexport function menuPageSubs(page: MenuPage): Sub<MenuPageMsg> {\n  // the menu's subs\n  const menuSub: Sub<MenuPageMsg> = page.menuModel\n      .map(mm => menuSubscriptions(mm).map(menuMsg))\n      .withDefaultSupply(() => Sub.none());\n  // mouse & key subs\n  const mouseMove: Sub<MenuPageMsg> = documentEvents.on('mousemove', e => onMouseMove(pos(e.pageX, e.pageY)));\n  const keyDown: Sub<MenuPageMsg> = documentEvents.on('keydown', e => onKeyDown(e.key));\n\n  return Sub.batch([menuSub, mouseMove, keyDown]);\n}\n\nfunction updateMenu(page: MenuPage, mac: [MyMenuModel, Cmd<MyMenuMsg>]): [MenuPage, Cmd<MenuPageMsg>] {\n  return Tuple.fromNative(mac)\n      .mapFirst(mm => {\n        const newPage: MenuPage = {\n          ...page,\n          menuModel: just(mm)\n        }\n        return newPage;\n        // } ({...model, page: left({ ...mainPage, menuModel: just(mm)}})))\n      })\n      .mapSecond(mc => mc.map(menuMsg))\n      .toNative();\n}\n\nfunction closeMenu(menuPage: MenuPage, lastClicked: Maybe<string> = nothing): [MenuPage, Cmd<MenuPageMsg>] {\n  return noCmd({\n    ...menuPage,\n    menuModel: nothing,\n    lastClicked\n  })\n}\n\n","import {Box, Dim} from \"tea-pop-core\";\nimport {DropDownMsg} from \"tea-pop-dropdown\";\n\nexport type DropDownPageMsg =\n    | { tag: \"button-clicked\", index: number; b: Box }\n    | { tag: \"dd-msg\", msg: DropDownMsg }\n    | { tag: 'got-window-dimensions', d: Dim }\n\nexport function ddMsg(msg: DropDownMsg): DropDownPageMsg {\n  return {\n    tag: \"dd-msg\",\n    msg,\n  }\n}\n\nexport function gotWindowDimensions(d: Dim): DropDownPageMsg {\n  return {\n    tag: \"got-window-dimensions\",\n    d\n  }\n}\n\n","import {DropDownPage} from \"./DropDownPage\";\nimport {ddMsg, DropDownPageMsg, gotWindowDimensions} from \"./DropDownPageMsg\";\nimport {Cmd, just, noCmd, nothing, Sub, Task, Tuple, WindowEvents} from \"react-tea-cup\";\nimport {\n  DropDownModel,\n  DropDownMsg,\n  dropDownOpen,\n  DropDownRequestClose,\n  dropDownSubscriptions,\n  dropDownUpdate\n} from \"tea-pop-dropdown\";\nimport {Dim, dim, windowDimensions} from \"tea-pop-core\";\n\nexport function dropDownPageInit(): [DropDownPage, Cmd<DropDownPageMsg>] {\n  const getWindowDimensions: Task<never, Dim> = Task.succeedLazy(() =>\n      windowDimensions(),\n  );\n  const page: DropDownPage = {\n    tag: \"drop-down-page\",\n    viewportDim: nothing,\n    indexAndModel: nothing,\n  }\n  return Tuple.t2n(page, Task.perform(getWindowDimensions, gotWindowDimensions));\n}\n\nexport function dropDownPageUpdate(msg: DropDownPageMsg, ddPage: DropDownPage): [DropDownPage, Cmd<DropDownPageMsg>] {\n  switch (msg.tag) {\n    case \"button-clicked\": {\n      const ddMac: [DropDownModel, Cmd<DropDownMsg>] = dropDownOpen(Task.succeed(msg.b));\n      const newPage: DropDownPage = {\n        ...ddPage,\n        indexAndModel: just(new Tuple(msg.index, ddMac[0]))\n      };\n      return Tuple.t2n(\n          newPage,\n          ddMac[1].map(ddMsg)\n      );\n    }\n    case \"dd-msg\": {\n      return ddPage.indexAndModel\n          .map(iam => {\n            const ddMac: [DropDownModel, Cmd<DropDownMsg>, DropDownRequestClose] = dropDownUpdate(msg.msg, iam.b);\n            if (ddMac[2]) {\n              // close requested\n              const newPage: DropDownPage = {\n                ...ddPage,\n                  indexAndModel: nothing,\n              };\n              return noCmd<DropDownPage, DropDownPageMsg>(newPage);\n            }\n            const res: [DropDownPage, Cmd<DropDownPageMsg>] = Tuple.fromNative([ddMac[0], ddMac[1]])\n                .mapFirst(ddModel => ({\n                    ...ddPage,\n                    indexAndModel: ddPage.indexAndModel.map(t => new Tuple(t.a, ddModel))\n                  }))\n                .mapSecond(c => c.map(ddMsg))\n                .toNative();\n            return res;\n          })\n          .withDefaultSupply(() => noCmd(ddPage));\n    }\n    case \"got-window-dimensions\": {\n      return noCmd({\n        ...ddPage,\n        viewportDim: just(msg.d)\n      });\n    }\n  }\n}\n\nconst windowEvents = new WindowEvents();\n\nexport function dropDownPageSubs(): Sub<DropDownPageMsg> {\n  return Sub.batch([\n    dropDownSubscriptions().map(ddMsg),\n    windowEvents.on('resize', () => gotWindowDimensions(dim(window.innerWidth, window.innerHeight)))\n  ]);\n}\n\n","import {Dim, Pos} from \"tea-pop-core\";\n\nexport type PlacementPageMsg =\n    | { tag: 'got-window-dimensions', d: Dim }\n    | { tag: 'mouse-move', pos: Pos }\n    | { tag: 'key-down', key: string }\n\nexport function gotWindowDimensions(d: Dim): PlacementPageMsg {\n  return {\n    tag: \"got-window-dimensions\",\n    d\n  }\n}\n\nexport function onMouseMove(pos: Pos): PlacementPageMsg {\n  return {\n    tag: \"mouse-move\", pos\n  }\n}\n\nexport function onKeyDown(key: string): PlacementPageMsg {\n  return {\n    tag: \"key-down\", key\n  }\n}\n","import {PlacementPage} from \"./PlacementPage\";\nimport {gotWindowDimensions, onKeyDown, onMouseMove, PlacementPageMsg} from \"./PlacementPageMsg\";\nimport {Cmd, DocumentEvents, just, noCmd, nothing, Sub, Task, Tuple, WindowEvents} from \"react-tea-cup\";\nimport {dim, Pos, pos} from \"tea-pop-core\";\n\nexport function placementPageInit(): [PlacementPage, Cmd<PlacementPageMsg>] {\n  const pp: PlacementPage = {\n    tag: \"placement-page\",\n    viewportDim: nothing,\n    mode: \"menu\",\n    mousePos: Pos.origin\n  }\n  const cmd: Cmd<PlacementPageMsg> = Task.perform(\n      Task.succeedLazy(() => dim(window.innerWidth, window.innerHeight)),\n      gotWindowDimensions\n  );\n  return Tuple.t2n(pp, cmd);\n}\n\nexport function placementPageUpdate(msg: PlacementPageMsg, page: PlacementPage): [PlacementPage, Cmd<PlacementPageMsg>] {\n  switch (msg.tag) {\n    case \"got-window-dimensions\": {\n      return noCmd({\n        ...page,\n        viewportDim: just(msg.d)\n      });\n    }\n    case \"key-down\": {\n      return noCmd(\n          msg.key === \"m\"\n            ? { ...page, mode: page.mode === \"menu\" ? \"drop-down\" : \"menu\" }\n            : page\n      );\n    }\n    case \"mouse-move\": {\n      return noCmd({...page, mousePos: msg.pos})\n    }\n  }\n}\n\nconst documentEvents = new DocumentEvents();\nconst windowEvents = new WindowEvents();\n\nexport function placementPageSubs(): Sub<PlacementPageMsg> {\n  const mouseMove: Sub<PlacementPageMsg> = documentEvents.on('mousemove', e => onMouseMove(pos(e.pageX, e.pageY)));\n  const keyDown: Sub<PlacementPageMsg> = documentEvents.on('keydown', e => onKeyDown(e.key));\n  return Sub.batch([\n    mouseMove,\n    keyDown,\n    windowEvents.on('resize', e => gotWindowDimensions(dim(window.innerWidth, window.innerHeight)))\n  ])\n}\n","import * as React from \"react\";\nimport {Cmd, DevTools, Dispatcher, map, newUrl, noCmd, ProgramWithNav, Sub, Task, Tuple} from \"react-tea-cup\";\nimport {homeModel, Model} from \"./Model\";\nimport {dropDownPageMsg, menuPageMsg, Msg, navigate, noop, placementPageMsg} from \"./Msg\";\nimport {Route, router, routeToUrl} from \"./routes\";\nimport {viewMenuPage} from \"./menu-page/ViewMenuPage\";\nimport {menuPageInit, menuPageSubs, menuPageUpdate} from \"./menu-page/Update\";\n\nimport './App.scss';\nimport {viewDropDownPage} from \"./dropdown-page/ViewDropDownPage\";\nimport {dropDownPageInit, dropDownPageSubs, dropDownPageUpdate} from \"./dropdown-page/Update\";\nimport {placementPageInit, placementPageSubs, placementPageUpdate} from \"./placement-page/Update\";\nimport {viewPlacementPage} from \"./placement-page/ViewPlacementPage\";\n\nfunction init(l: Location): [Model, Cmd<Msg>] {\n  return router.parseLocation(l)\n      // eslint-disable-next-line array-callback-return\n      .map(route => {\n        switch (route) {\n          case \"home\": {\n            return initHome();\n          }\n          case \"menu\": {\n            return Tuple.fromNative(menuPageInit())\n                .mapFirst(page => ({\n                  page\n                }))\n                .mapSecond(c => c.map(menuPageMsg))\n                .toNative();\n          }\n          case \"dropdown\": {\n            return Tuple.fromNative(dropDownPageInit())\n                .mapFirst(page => ({\n                  page\n                }))\n                .mapSecond(c => c.map(dropDownPageMsg))\n                .toNative();\n          }\n          case \"placement\": {\n            return Tuple.fromNative(placementPageInit())\n                .mapFirst(page => ({\n                  page\n                }))\n                .mapSecond(c => c.map(placementPageMsg))\n                .toNative();\n          }\n        }\n      })\n      .withDefaultSupply(() => initHome())\n}\n\nfunction initHome(): [Model, Cmd<Msg>] {\n  return noCmd(homeModel());\n}\n\nfunction link(dispatch: Dispatcher<Msg>, route: Route, text: string) {\n  // eslint-disable-next-line jsx-a11y/anchor-is-valid\n  return <a href={'#'} onClick={e => {\n    e.preventDefault();\n    dispatch(navigate(route));\n  }}>\n    {text}\n  </a>\n}\n\nfunction view(dispatch: Dispatcher<Msg>, model: Model): React.ReactNode {\n  const { page } = model;\n  switch (page.tag) {\n    case \"home\": {\n      return (\n          <>\n            <h1>tea-pop demo app</h1>\n            <ul>\n              <li>\n                {link(dispatch, 'menu', \"Context menu\")}\n              </li>\n              <li>\n                {link(dispatch, 'dropdown', \"Drop-down\")}\n              </li>\n              <li>\n                {link(dispatch, 'placement', \"Live placement\")}\n              </li>\n            </ul>\n          </>\n      )\n    }\n    case \"menu\": {\n      return viewMenuPage(map(dispatch, menuPageMsg), page);\n    }\n    case \"drop-down-page\": {\n      return viewDropDownPage(map(dispatch, dropDownPageMsg), page);\n    }\n    case \"placement-page\": {\n      return viewPlacementPage(map(dispatch, placementPageMsg), page);\n    }\n\n  }\n}\n\nfunction update(msg: Msg, model: Model): [Model, Cmd<Msg>] {\n  switch (msg.tag) {\n    case \"url-change\": {\n      return init(msg.l);\n    }\n    case \"menu-page-msg\": {\n      const { page } = model;\n      if (page.tag !== \"menu\") {\n        return noCmd(model);\n      }\n      return Tuple.fromNative(menuPageUpdate(msg.msg, page))\n          .mapFirst(page => ({\n            page\n          }))\n          .mapSecond(c => c.map(menuPageMsg))\n          .toNative();\n    }\n    case \"dd-page-msg\": {\n      const { page } = model;\n      if (page.tag !== \"drop-down-page\") {\n        return noCmd(model);\n      }\n      return Tuple.fromNative(dropDownPageUpdate(msg.msg, page))\n          .mapFirst(page => ({\n            page\n          }))\n          .mapSecond(c => c.map(dropDownPageMsg))\n          .toNative();\n    }\n    case \"placement-page-msg\": {\n      const { page } = model;\n      if (page.tag !== \"placement-page\") {\n        return noCmd(model);\n      }\n      return Tuple.fromNative(placementPageUpdate(msg.msg, page))\n          .mapFirst(page => ({\n            page\n          }))\n          .mapSecond(c => c.map(placementPageMsg))\n          .toNative();\n    }\n    case \"navigate\": {\n      return Tuple.t2n(model, Task.perform(newUrl(routeToUrl(msg.route)), () => noop));\n    }\n    case \"noop\": {\n      return noCmd(model);\n    }\n  }\n}\n\nfunction subscriptions(model: Model): Sub<Msg> {\n  const { page } = model;\n  switch (page.tag) {\n    case \"menu\": {\n      return menuPageSubs(page).map(menuPageMsg);\n    }\n    case \"drop-down-page\": {\n      return dropDownPageSubs().map(dropDownPageMsg);\n    }\n    case \"placement-page\": {\n      return placementPageSubs().map(placementPageMsg);\n    }\n  }\n  return Sub.none();\n}\n\nexport function onUrlChange(l: Location): Msg {\n  return {\n    tag: \"url-change\",\n    l\n  }\n}\n\nexport const DemoApp = () => (\n    <ProgramWithNav\n        onUrlChange={onUrlChange}\n        init={init}\n        view={view}\n        update={update}\n        subscriptions={subscriptions}\n        devTools={DevTools.init<Model, Msg>(window)}\n    />\n)\n","import {MenuPage} from \"./menu-page/MenuPage\";\nimport {DropDownPage} from \"./dropdown-page/DropDownPage\";\nimport {PlacementPage} from \"./placement-page/PlacementPage\";\n\nexport type Page =\n  | { tag: \"home\" }\n  | MenuPage\n  | DropDownPage\n  | PlacementPage\n\nexport interface Model {\n  readonly page: Page;\n}\n\nexport function homeModel(): Model {\n  return {\n    page: { tag: \"home\" }\n  }\n}\n","import * as React from 'react';\nimport {Dispatcher} from \"react-tea-cup\";\nimport {DropDownPageMsg} from \"./DropDownPageMsg\";\nimport {DropDownPage} from \"./DropDownPage\";\nimport {Box} from \"tea-pop-core\";\nimport {ViewDropDown} from \"tea-pop-dropdown\";\n\nexport function viewDropDownPage(dispatch: Dispatcher<DropDownPageMsg>, page: DropDownPage) {\n  const steps = 10;\n  const padding = 4;\n  return page.viewportDim\n      .map(viewportDim => {\n        const xStep = Math.floor(viewportDim.w / steps);\n        const yStep = Math.floor(viewportDim.h / steps);\n        const buttons = [];\n        let btnIndex = 1;\n        const height = yStep - (padding * 2);\n        const width = xStep - (padding * 2);\n        for (let x = 0; (x + padding + width) < viewportDim.w; x += xStep) {\n          for (let y = 0; (y + padding + height) < viewportDim.h; y += yStep) {\n            const curBtnIndex = btnIndex;\n            const top = y + padding;\n            const left = x + padding;\n            const backgroundColor = page.indexAndModel\n                .map(iam => iam.a)\n                .filter(i => i === curBtnIndex).map(() => \"lightblue\").withDefault(\"lightgray\");\n            buttons.push(\n                <button\n                    key={\"btn\" + btnIndex}\n                    style={{\n                      position: \"absolute\",\n                      top,\n                      left,\n                      height,\n                      width,\n                      border: \"none\",\n                      backgroundColor,\n                    }}\n                    onClick={(evt) => dispatch({\n                      tag: \"button-clicked\",\n                      index: curBtnIndex,\n                      b: Box.fromDomRect((evt.target as HTMLElement).getBoundingClientRect())\n                    })}\n                >\n                  {btnIndex}\n                </button>\n            )\n            btnIndex++;\n          }\n        }\n        return (\n            <>\n              <div className=\"drop-down-page\">\n                {buttons}\n              </div>\n              {page.indexAndModel\n                  .map(ddModel =>\n                      <ViewDropDown renderer={() => <div className=\"my-drop-down\">HELLO</div>} model={ddModel.b}/>\n                  )\n                  .withDefaultSupply(() => <></>)\n              }\n            </>\n        )\n      })\n      .withDefaultSupply(() => <></>)\n}\n","import * as React from 'react';\nimport {Dispatcher} from \"react-tea-cup\";\nimport {PlacementPageMsg} from \"./PlacementPageMsg\";\nimport {PlacementPage} from \"./PlacementPage\";\nimport {box, Box, Dim, dim, place, placeCombo, Pos, pos} from \"tea-pop-core\";\n\nexport function viewPlacementPage(dispatch: Dispatcher<PlacementPageMsg>, page: PlacementPage) {\n  const {viewportDim} = page;\n  return viewportDim.map(vd => {\n    let placeFct = page.mode === \"menu\" ? place : placeCombo\n    const {mousePos} = page;\n    const elemDim = dim(600, 400);\n    const refDim = dim(100, 50);\n    const placedBox: Box = placeFct(vd, box(pos(mousePos.x, mousePos.y), refDim), elemDim);\n    const viewDim = (d: Dim) => <span>{d.w}*{d.h}</span>\n    const viewPos = (p: Pos) => <span>{p.x}:{p.y}</span>\n    return (\n        <div className=\"demo\">\n          <div className=\"dimensions\">\n            <ul>\n              <li>mode: {page.mode} (toggle with <code>M</code>)</li>\n              <li>elem: {viewDim(elemDim)}</li>\n              <li>viewport: {viewDim(vd)}</li>\n              <li>ref: {viewDim(refDim)}</li>\n              <li>mousePos: {viewPos(mousePos)}</li>\n              <li>placed: {viewPos(placedBox.p)}, {viewDim(placedBox.d)}</li>\n            </ul>\n          </div>\n          <div className=\"ref-elem\" style={{\n            height: refDim.h,\n            width: refDim.w,\n            left: page.mousePos.x,\n            top: page.mousePos.y,\n          }}>\n          </div>\n          <div className=\"menu-elem\" style={{\n            height: placedBox.d.h,\n            width: placedBox.d.w,\n            left: placedBox.p.x,\n            top: placedBox.p.y,\n          }}>\n          </div>\n        </div>\n    )\n  }).withDefaultSupply(() => <></>);\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport {DemoApp} from \"./DemoApp\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <DemoApp />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}