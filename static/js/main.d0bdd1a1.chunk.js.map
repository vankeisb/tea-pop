{"version":3,"sources":["../../src/index.ts","../../../src/common/index.ts","../../../src/common/Dim.ts","../../../src/common/Pos.ts","../../../src/menu/Msg.ts","../../../src/menu/Menu.ts","../../../src/common/Box.ts","../../../src/menu/Model.ts","../../../src/common/StopEvent.ts","../../../src/common/Popover.ts","../../../src/common/WindowUtils.ts","../../../src/menu/index.ts","../../../src/menu/TeaPop.ts","../../../src/menu/ViewMenu.tsx","../../../src/menu/ItemRenderer.tsx","../../../src/dropdown/DropDown.tsx","Demo.tsx","App.tsx","index.tsx"],"names":["update","ViewMenu","defaultItemRenderer","separator","item","Menu","menu","subscriptions","open","ViewDropDown","Dim","w","h","dim","zero","Pos","x","y","p","this","pos","origin","tag","d","uuid","r","key","m","subMenuCounter","selectFirst","elements","selectIndex","select","e","ListWithSelection","fromArray","toArray","isSelected","start","elems","i","length","just","nothing","down","getSelectedIndex","map","selectedIndex","findNextItemIndex","findPreviousItemIndex","nextIndex","withDefault","withDefaultSupply","indexOf","selected","getSelected","type","value","menuId","btoa","menuItemId","itemIndex","byId","id","Task","fromLambda","document","getElementById","Error","items","userData","subMenu","maybeOf","Box","rect","height","width","box","menuStatePlacing","refBox","windowSize","state","error","child","navigatedWithKeyboard","model","stopEvent","preventDefault","stopPropagation","place1DEnd","viewportW","refX","refW","elemW","offset","len","place1DStart","viewport","elem","pX","pY","elemEnd","spaceBefore","spaceAfter","placeComboY","windowDimensions","window","innerWidth","innerHeight","getWindowDimensions","succeedLazy","initialModel","selectFirstItem","deselectAll","Cmd","batch","perform","gotWindowDimensions","u","gotUuid","postOpen","noCmd","attempt","menuTask","fromDomRect","getBoundingClientRect","gotMenuBox","withOut","mac","outMsg","outItemSelected","data","openSubMenu","isNothing","Tuple","t2n","menuItemTask","gotItemBox","msg","match","menuBox","place","err","collapseLastSubMenu","keyboardNavigated","mapLastMenu","lastModel","moveSelection","selectedItem","indexOfItem","expandLastSubMenu","toggleOrSelectItem","newModel","selectItem","isJust","itemBox","newModel2","childMsg","mco","windowEvents","WindowEvents","documentEvents","DocumentEvents","Sub","on","evt","button","noop","t","target","classList","contains","parentElement","docMouseDown","gotKeyDown","none","f","fromNative","mapFirst","c","mapSecond","cmd","toNative","ViewMenuItem","props","renderer","dispatch","onMouseEnter","onMouseLeave","onClick","active","hasSubMenu","renderItems","element","index","className","style","position","top","left","bottom","right","overflow","onContextMenu","visibility","contentRenderer","input","activeClass","gotRenderedBox","gotInitData","requestClose","handleError","console","getRefBox","getInitData","andThen","placed","placedBox","initData","getRenderedBox","renderedBox","placeCombo","initialMainPage","menuModel","lastClicked","dropDownPageMsg","mainPageMsg","menuMsg","switchPage","page","mySubMenu2","mySubMenu1","myMenu","MyRenderer","s","init","mousePos","view","onMouseDown","href","viewMainPage","viewportDim","vd","placeFct","mode","elemDim","refDim","viewDim","viewPos","viewPlacementPage","xStep","Math","floor","yStep","buttons","btnIndex","padding","curBtnIndex","backgroundColor","indexAndModel","iam","a","filter","push","border","b","ddModel","viewDropDownPage","mpMsg","mainPage","menuUpdate","newPage","out","mac2","closeMenu","updateMenu","menuOpen","placementPage","openMainPage","openDropDownPage","openPlacementPage","pageMsg","ddMac","dropDownOpen","succeed","dropDownUpdate","mouseMove","pageX","pageY","keyDown","menuSub","mm","menuSubscriptions","dropDownSubscriptions","mc","App","Demo","devTools","DevTools","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.d0bdd1a1.chunk.js","sourcesContent":["/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nexport * from './common';\n\nexport {\n  Model as MenuModel,\n  Msg as MenuMsg,\n  OutMsg as MenuOutMsg,\n  update as menuUpdate,\n  ViewMenu,\n  defaultItemRenderer,\n  ItemRenderer,\n  separator,\n  item,\n  Menu,\n  menu,\n  subscriptions as menuSubscriptions,\n  open as menuOpen,\n  MenuElement,\n  MenuItem,\n} from './menu';\n\nexport {\n  Model as DropDownModel,\n  Msg as DropDownMsg,\n  open as dropDownOpen,\n  update as dropDownUpdate,\n  subscriptions as dropDownSubscriptions,\n  ViewDropDown,\n  RequestClose as DropDownRequestClose,\n} from './dropdown/DropDown';\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nexport * from './StopEvent';\nexport * from './Pos';\nexport * from './Dim';\nexport * from './Box';\nexport * from './Popover';\nexport * from './WindowUtils';\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nexport class Dim {\n  constructor(readonly w: number, readonly h: number) {}\n\n  static zero: Dim = dim(0);\n}\n\nexport function dim(w: number, h?: number): Dim {\n  return new Dim(w, h ?? w);\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nexport class Pos {\n  constructor(readonly x: number, readonly y: number) {}\n\n  add(p: Pos): Pos {\n    return new Pos(this.x + p.x, this.y + p.y);\n  }\n\n  static origin: Pos = pos(0, 0);\n}\n\nexport function pos(x: number, y: number): Pos {\n  return new Pos(x, y);\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { Dim, Box } from '../common';\nimport { Result } from 'react-tea-cup';\nimport { MenuItem } from './Menu';\n\nexport type Msg<T> =\n  | { tag: 'got-window-dimensions'; d: Dim }\n  | { tag: 'got-uuid'; uuid: string }\n  | { tag: 'got-menu-box'; r: Result<Error, Box> }\n  | { tag: 'key-down'; key: string }\n  | { tag: 'mouse-enter'; item: MenuItem<T>; itemIndex: number }\n  | { tag: 'mouse-leave'; item: MenuItem<T>; itemIndex: number }\n  | {\n      tag: 'got-item-box';\n      item: MenuItem<T>;\n      r: Result<Error, Box>;\n      selectFirst: boolean;\n      subMenuCounter: number;\n    }\n  | { tag: 'item-clicked'; item: MenuItem<T> }\n  | { tag: 'child-msg'; m: Msg<T> }\n  | { tag: 'doc-mouse-down' }\n  | { tag: 'noop' };\n\nexport function noop<T>(): Msg<T> {\n  return { tag: 'noop' };\n}\n\nexport function gotWindowDimensions<T>(d: Dim): Msg<T> {\n  return {\n    tag: 'got-window-dimensions',\n    d,\n  };\n}\n\nexport function gotUuid<T>(uuid: string): Msg<T> {\n  return {\n    tag: 'got-uuid',\n    uuid,\n  };\n}\n\nexport function gotMenuBox<T>(r: Result<Error, Box>): Msg<T> {\n  return {\n    tag: 'got-menu-box',\n    r,\n  };\n}\n\nexport function gotKeyDown<T>(key: string): Msg<T> {\n  return {\n    tag: 'key-down',\n    key,\n  };\n}\n\nexport function childMsg<T>(m: Msg<T>): Msg<T> {\n  return {\n    tag: 'child-msg',\n    m,\n  };\n}\n\nexport function gotItemBox<T>(\n  item: MenuItem<T>,\n  r: Result<Error, Box>,\n  subMenuCounter: number,\n  selectFirst: boolean,\n): Msg<T> {\n  return {\n    tag: 'got-item-box',\n    item,\n    selectFirst,\n    r,\n    subMenuCounter,\n  };\n}\n\nexport function docMouseDown<T>(): Msg<T> {\n  return {\n    tag: 'doc-mouse-down',\n  };\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport {\n  just,\n  ListWithSelection,\n  Maybe,\n  maybeOf,\n  nothing,\n  Task,\n} from 'react-tea-cup';\n\nexport class Menu<T> {\n  constructor(private readonly elements: ListWithSelection<MenuElement<T>>) {}\n\n  selectFirstItem(): Menu<T> {\n    return new Menu(this.elements.selectIndex(0));\n  }\n\n  selectItem(item: MenuItem<T>): Menu<T> {\n    return new Menu(this.elements.select((e) => e === item));\n  }\n\n  deselectAll(): Menu<T> {\n    return new Menu(ListWithSelection.fromArray(this.elements.toArray()));\n  }\n\n  get elems(): ReadonlyArray<MenuElement<T>> {\n    return this.elements.toArray();\n  }\n\n  get selectedItem(): Maybe<MenuItem<T>> {\n    const selected = this.elements.getSelected();\n    if (selected.type === 'Just' && selected.value.tag === 'item') {\n      return just(selected.value);\n    }\n    return nothing;\n  }\n\n  isSelected(item: MenuItem<T>): boolean {\n    return this.elements.isSelected(item);\n  }\n\n  private findNextItemIndex(start: number): Maybe<number> {\n    const elems = this.elems;\n    const s = start === elems.length - 1 ? 0 : start + 1;\n    for (let i = s; i < elems.length; i++) {\n      if (elems[i].tag === 'item') {\n        return just(i);\n      }\n    }\n    return nothing;\n  }\n\n  private findPreviousItemIndex(start: number): Maybe<number> {\n    const elems = this.elems;\n    const s = start === 0 ? elems.length - 1 : start - 1;\n    for (let i = s; i >= 0; i--) {\n      if (elems[i].tag === 'item') {\n        return just(i);\n      }\n    }\n    return nothing;\n  }\n\n  moveSelection(down: boolean): Menu<T> {\n    return this.elements\n      .getSelectedIndex()\n      .map((selectedIndex) => {\n        const mbNextIndex = down\n          ? this.findNextItemIndex(selectedIndex)\n          : this.findPreviousItemIndex(selectedIndex);\n        return mbNextIndex\n          .map((nextIndex) => new Menu(this.elements.selectIndex(nextIndex)))\n          .withDefault(this);\n      })\n      .withDefaultSupply(() => {\n        return new Menu(\n          this.elements.selectIndex(down ? 0 : this.elements.length() - 1),\n        );\n      });\n  }\n\n  indexOfItem(item: MenuItem<T>): Maybe<number> {\n    const i = this.elements.toArray().indexOf(item);\n    if (i === -1) {\n      return nothing;\n    }\n    return just(i);\n  }\n}\n\nexport type MenuElement<T> = MenuItem<T> | MenuSeparator;\n\nexport interface MenuItem<T> {\n  tag: 'item';\n  readonly userData: T;\n  readonly subMenu: Maybe<Menu<T>>;\n}\n\nexport interface MenuSeparator {\n  tag: 'separator';\n}\n\nexport function menu<T>(items: ReadonlyArray<MenuElement<T>>): Menu<T> {\n  return new Menu(ListWithSelection.fromArray(items));\n}\n\nexport function item<T>(userData: T, subMenu?: Menu<T>): MenuItem<T> {\n  return {\n    tag: 'item',\n    userData,\n    subMenu: maybeOf(subMenu),\n  };\n}\n\nexport const separator: MenuSeparator = {\n  tag: 'separator',\n};\n\nexport function menuId(uuid: string): string {\n  return `tm-${btoa(uuid)}`;\n}\n\nexport function menuItemId(menuId: string, itemIndex: number): string {\n  return `tm-item-${menuId}-${itemIndex}`;\n}\n\nexport function menuTask(uuid: string): Task<Error, HTMLElement> {\n  return byId(menuId(uuid));\n}\n\nexport function menuItemTask(\n  menuId: string,\n  itemIndex: number,\n): Task<Error, HTMLElement> {\n  return byId(menuItemId(menuId, itemIndex));\n}\n\nfunction byId(id: string): Task<Error, HTMLElement> {\n  return Task.fromLambda(() => {\n    const e = document.getElementById(id);\n    if (e === null) {\n      throw new Error('element not found with id:' + id);\n    }\n    return e;\n  });\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { pos, Pos } from './Pos';\nimport { dim, Dim } from './Dim';\n\nexport class Box {\n  constructor(readonly p: Pos, readonly d: Dim) {}\n\n  static fromDomRect(rect: DOMRect): Box {\n    const { x, y, height, width } = rect;\n    return box(pos(x, y), dim(width, height));\n  }\n}\n\nexport function box(p: Pos, d: Dim): Box {\n  return new Box(p, d);\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { Menu } from './Menu';\nimport { Maybe, nothing } from 'react-tea-cup';\nimport { Box, Dim } from '../common';\n\nexport interface Model<T> {\n  readonly uuid: Maybe<string>;\n  readonly windowSize: Maybe<Dim>;\n  readonly menu: Menu<T>;\n  readonly state: MenuState;\n  readonly error: Maybe<Error>;\n  readonly child: Maybe<Model<T>>;\n  readonly navigatedWithKeyboard: boolean;\n  readonly subMenuCounter: number;\n}\n\nexport function initialModel<T>(menu: Menu<T>, refBox: Box): Model<T> {\n  return {\n    uuid: nothing,\n    windowSize: nothing,\n    menu,\n    state: menuStatePlacing(refBox),\n    error: nothing,\n    child: nothing,\n    navigatedWithKeyboard: false,\n    subMenuCounter: 0,\n  };\n}\n\nexport type MenuState =\n  | { tag: 'placing'; refBox: Box }\n  | { tag: 'open'; box: Box };\n\nexport function menuStatePlacing(refBox: Box): MenuState {\n  return {\n    tag: 'placing',\n    refBox,\n  };\n}\n\nexport function keyboardNavigated<T>(\n  model: Model<T>,\n  navigatedWithKeyboard = true,\n): Model<T> {\n  return { ...model, navigatedWithKeyboard };\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { EventHandler } from 'react';\n\nexport const stopEvent: EventHandler<any> = (e) => {\n  e.preventDefault();\n  e.stopPropagation();\n};\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { box, Box } from './Box';\nimport { dim, Dim } from './Dim';\nimport { pos } from './Pos';\n\nexport function place(viewport: Dim, refBox: Box, elem: Dim): Box {\n  const pX = place1DEnd(viewport.w, refBox.p.x, refBox.d.w, elem.w);\n  const pY = place1DStart(viewport.h, refBox.p.y, refBox.d.h, elem.h);\n  return box(pos(pX.offset, pY.offset), dim(pX.len, pY.len));\n}\n\nexport function placeCombo(viewport: Dim, refBox: Box, elem: Dim): Box {\n  const pX = place1DStart(viewport.w, refBox.p.x, refBox.d.w, elem.w);\n  const pY = placeComboY(viewport.h, refBox.p.y, refBox.d.h, elem.h);\n  return box(pos(pX.offset, pY.offset), dim(pX.len, pY.len));\n}\n\ninterface Placed1D {\n  readonly offset: number;\n  readonly len: number;\n}\n\nexport function place1DEnd(\n  viewportW: number,\n  refX: number,\n  refW: number,\n  elemW: number,\n): Placed1D {\n  if (refX + refW + elemW > viewportW) {\n    // not enough space after, try before\n    if (elemW < refX) {\n      // ok, prepend\n      return { offset: refX - elemW, len: elemW };\n    } else {\n      // not enough space before or after, we have to translate and/or expand !\n      if (elemW < viewportW) {\n        // can't append or prepend, but no need to shrink... translate only\n        const delta = refX + refW + elemW - viewportW;\n        return { offset: refX + refW - delta, len: elemW };\n      }\n      return { offset: 0, len: viewportW };\n    }\n  } else {\n    // enough space to append\n    return { offset: refX + refW, len: elemW };\n  }\n}\n\nexport function place1DStart(\n  viewportW: number,\n  refX: number,\n  refW: number,\n  elemW: number,\n): Placed1D {\n  if (elemW > viewportW) {\n    return { offset: 0, len: viewportW };\n  }\n  if (refX + elemW > viewportW) {\n    // not enough space after, try before\n    if (elemW < refX + refW) {\n      // ok, prepend\n      return { offset: refX + refW - elemW, len: elemW };\n    } else {\n      // not enough space before or after, we have to translate and/or expand !\n      if (elemW < viewportW) {\n        // can't append or prepend, but no need to shrink... translate only\n        const delta = refX + refW + elemW - viewportW;\n        return { offset: refX + refW - delta, len: elemW };\n      }\n      return { offset: 0, len: 10 };\n    }\n  } else {\n    // enough space to append\n    return { offset: refX, len: elemW };\n  }\n}\n\nfunction placeComboY(\n  viewportW: number,\n  refX: number,\n  refW: number,\n  elemW: number,\n): Placed1D {\n  const elemEnd = refX + refW;\n  const spaceBefore = refX;\n  const spaceAfter = viewportW - elemEnd;\n  if (elemW < spaceAfter) {\n    // enough space after, append\n    return { offset: elemEnd, len: elemW };\n  } else if (elemW < spaceBefore) {\n    // enough space before, append\n    return { offset: refX - elemW, len: elemW };\n  } else {\n    // not enough space, need to shrink\n    // use the most space\n    if (spaceBefore > spaceAfter) {\n      // place before\n      return { offset: 0, len: spaceBefore };\n    } else {\n      return { offset: elemEnd, len: spaceAfter };\n    }\n  }\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { dim, Dim } from './Dim';\nimport { Task } from 'react-tea-cup';\n\nexport function windowDimensions(): Dim {\n  return dim(window.innerWidth, window.innerHeight);\n}\n\nexport const getWindowDimensions: Task<never, Dim> = Task.succeedLazy(() =>\n  windowDimensions(),\n);\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nexport * from './Model';\nexport * from './Msg';\nexport * from './Menu';\nexport * from './TeaPop';\nexport * from './ViewMenu';\nexport * from './OutMsg';\nexport * from './ItemRenderer';\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport {\n  childMsg,\n  docMouseDown,\n  gotItemBox,\n  gotKeyDown,\n  gotMenuBox,\n  gotUuid,\n  gotWindowDimensions,\n  Msg,\n  noop,\n} from './Msg';\nimport {\n  Cmd,\n  DocumentEvents,\n  just,\n  Maybe,\n  noCmd,\n  nothing,\n  Sub,\n  Task,\n  Tuple,\n  uuid,\n  WindowEvents,\n} from 'react-tea-cup';\nimport { initialModel, keyboardNavigated, Model } from './Model';\nimport { Menu, MenuItem, menuItemTask, menuTask } from './Menu';\nimport { dim, Dim, Box, place } from '../common';\nimport { OutMsg } from './OutMsg';\n\nexport function open<T>(\n  menu: Menu<T>,\n  refBox: Box,\n  selectFirst = false,\n): [Model<T>, Cmd<Msg<T>>] {\n  return [\n    initialModel(\n      selectFirst ? menu.selectFirstItem() : menu.deselectAll(),\n      refBox,\n    ),\n    Cmd.batch([\n      Task.perform(getWindowDimensions, (d) => gotWindowDimensions(d)),\n      Task.perform(uuid(), (u) => gotUuid(u)),\n    ]),\n  ];\n}\n\nfunction postOpen<T>(model: Model<T>): [Model<T>, Cmd<Msg<T>>] {\n  if (model.uuid.type === 'Nothing') {\n    return noCmd(model);\n  }\n  if (model.windowSize.type === 'Nothing') {\n    return noCmd(model);\n  }\n  const cmd: Cmd<Msg<T>> = Task.attempt(\n    menuTask(model.uuid.value).map((e) =>\n      Box.fromDomRect(e.getBoundingClientRect()),\n    ),\n    (x) => gotMenuBox(x),\n  );\n  return [model, cmd];\n}\n\nfunction withOut<T>(\n  mac: [Model<T>, Cmd<Msg<T>>],\n  outMsg: Maybe<OutMsg<T>> = nothing,\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  return [mac[0], mac[1], outMsg];\n}\n\nexport function update<T>(\n  msg: Msg<T>,\n  model: Model<T>,\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  switch (msg.tag) {\n    case 'got-window-dimensions': {\n      return withOut(\n        postOpen({\n          ...model,\n          windowSize: just(msg.d),\n        }),\n      );\n    }\n    case 'got-uuid': {\n      return withOut(\n        postOpen({\n          ...model,\n          uuid: just(msg.uuid),\n        }),\n      );\n    }\n    case 'got-menu-box': {\n      if (model.state.tag === 'placing') {\n        const state = model.state;\n        return withOut(\n          noCmd(\n            model.windowSize\n              .map((windowSize) => {\n                const newModel: Model<T> = msg.r.match(\n                  (menuBox) =>\n                    ({\n                      ...model,\n                      state: {\n                        tag: 'open',\n                        box: place(windowSize, state.refBox, menuBox.d),\n                      },\n                    } as Model<T>),\n                  (err) => ({\n                    ...model,\n                    error: just(err),\n                  }),\n                );\n                return newModel;\n              })\n              .withDefault(model),\n          ),\n        );\n      }\n      return withOut(noCmd(model));\n    }\n\n    case 'key-down': {\n      switch (msg.key) {\n        case 'Escape': {\n          return withOut(\n            collapseLastSubMenu(keyboardNavigated(model)),\n            model.child.isNothing() ? just({ tag: 'request-close' }) : nothing,\n          );\n        }\n        case 'ArrowDown':\n        case 'ArrowUp': {\n          return mapLastMenu(keyboardNavigated(model), (lastModel) => {\n            return withOut(\n              noCmd({\n                ...lastModel,\n                menu: lastModel.menu.moveSelection(msg.key === 'ArrowDown'),\n              }),\n            );\n          });\n        }\n        case 'ArrowLeft':\n          return withOut(collapseLastSubMenu(keyboardNavigated(model)));\n        case 'ArrowRight':\n          return expandLastSubMenu(keyboardNavigated(model));\n        case 'Enter':\n        case ' ': {\n          return toggleOrSelectItem(model);\n        }\n        default:\n          return withOut(noCmd(model));\n      }\n    }\n    case 'mouse-enter': {\n      const newModel = { ...model, subMenuCounter: model.subMenuCounter + 1 };\n      if (model.navigatedWithKeyboard) {\n        return withOut(noCmd(keyboardNavigated(newModel, false)));\n      }\n      if (model.uuid.type === 'Nothing') {\n        return withOut(noCmd(newModel));\n      }\n      const menu = model.menu.selectItem(msg.item);\n      const uuid = model.uuid.value;\n      return withOut(\n        openSubMenu(\n          { ...newModel, menu, child: nothing },\n          uuid,\n          msg.item,\n          msg.itemIndex,\n          false,\n        ),\n      );\n    }\n    case 'mouse-leave': {\n      return withOut(\n        noCmd(\n          model.child.isJust()\n            ? model\n            : { ...model, menu: model.menu.deselectAll() },\n        ),\n      );\n    }\n    case 'got-item-box': {\n      if (msg.subMenuCounter !== model.subMenuCounter) {\n        return withOut(noCmd(model));\n      }\n      return withOut(\n        msg.r.match(\n          (itemBox) => {\n            const newModel: Model<T> = {\n              ...model,\n              menu: model.menu.selectItem(msg.item),\n            };\n            return msg.item.subMenu\n              .map((subMenu) => {\n                // we have a sub menu so we need\n                // to open a new Menu !\n                const mac = open(subMenu, itemBox, msg.selectFirst);\n                const newModel2: Model<T> = {\n                  ...newModel,\n                  child: just(mac[0]),\n                };\n                return Tuple.t2n(newModel2, mac[1].map(childMsg));\n              })\n              .withDefaultSupply(() => {\n                // close any existing child !\n                return newModel.child\n                  .map(() =>\n                    noCmd<Model<T>, Msg<T>>({ ...model, child: nothing }),\n                  )\n                  .withDefaultSupply(() => noCmd(model));\n              });\n          },\n          (err) => noCmd({ ...model, error: just(err) }),\n        ),\n      );\n    }\n    case 'child-msg': {\n      return model.child\n        .map((child) => {\n          const mco = update(msg.m, child);\n          const newModel: Model<T> = {\n            ...model,\n            child: just(mco[0]),\n          };\n          return withOut(Tuple.t2n(newModel, mco[1].map(childMsg)), mco[2]);\n        })\n        .withDefaultSupply(() => withOut(noCmd(model)));\n    }\n    case 'item-clicked': {\n      return withOut(noCmd(model), outItemSelected(msg.item));\n    }\n    case 'doc-mouse-down': {\n      return withOut(noCmd(model), just({ tag: 'request-close' }));\n    }\n    case 'noop': {\n      return withOut(noCmd(model));\n    }\n  }\n}\n\nfunction outItemSelected<T>(item: MenuItem<T>): Maybe<OutMsg<T>> {\n  return just({ tag: 'item-selected', data: item.userData });\n}\n\nfunction openSubMenu<T>(\n  model: Model<T>,\n  menuId: string,\n  item: MenuItem<T>,\n  itemIndex: number,\n  selectFirst: boolean,\n): [Model<T>, Cmd<Msg<T>>] {\n  if (item.subMenu.isNothing()) {\n    return noCmd(model);\n  }\n  const subMenuCounter = model.subMenuCounter + 1;\n  return Tuple.t2n(\n    { ...model, subMenuCounter },\n    Task.attempt(\n      menuItemTask(menuId, itemIndex).map((e) => {\n        return Box.fromDomRect(e.getBoundingClientRect());\n      }),\n      (r) => gotItemBox(item, r, subMenuCounter, selectFirst),\n    ),\n  );\n}\n\nconst windowEvents = new WindowEvents();\nconst documentEvents = new DocumentEvents();\n\nexport function subscriptions<T>(model: Model<T>): Sub<Msg<T>> {\n  return Sub.batch([\n    windowEvents.on('resize', () =>\n      gotWindowDimensions(dim(window.innerWidth, window.innerHeight)),\n    ),\n    documentEvents.on('mousedown', (evt) => {\n      if (evt.button === 2) {\n        return noop();\n      }\n      let t: HTMLElement | null = evt.target as HTMLElement;\n      while (t) {\n        // move up and try to find if we are inside a tea-pop Menu !\n        if (t.classList.contains('tm')) {\n          return noop();\n        }\n        t = t.parentElement;\n      }\n      return docMouseDown();\n    }),\n    model.state.tag === 'open'\n      ? documentEvents.on('keydown', (e) => gotKeyDown(e.key))\n      : Sub.none(),\n  ]);\n}\n\nconst getWindowDimensions: Task<never, Dim> = Task.succeedLazy(() =>\n  dim(window.innerWidth, window.innerHeight),\n);\n\nfunction mapLastMenu<T>(\n  model: Model<T>,\n  f: (m: Model<T>) => [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>],\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  switch (model.child.type) {\n    case 'Nothing': {\n      // I'm the last model !\n      return f(model);\n    }\n    case 'Just': {\n      const mac = mapLastMenu(model.child.value, f);\n      return [{ ...model, child: just(mac[0]) }, mac[1].map(childMsg), mac[2]];\n    }\n  }\n}\n\nfunction collapseLastSubMenu<T>(model: Model<T>): [Model<T>, Cmd<Msg<T>>] {\n  switch (model.child.type) {\n    case 'Nothing':\n      return noCmd(model);\n    case 'Just': {\n      // I have a child : close it if he has no child !\n      const child = model.child.value;\n      if (child.child.isJust()) {\n        return Tuple.fromNative(collapseLastSubMenu(child))\n          .mapFirst((c) => ({ ...model, child: just(c) }))\n          .mapSecond((cmd) => cmd.map(childMsg))\n          .toNative();\n      } else {\n        return noCmd({\n          ...model,\n          child: nothing,\n        });\n      }\n    }\n  }\n}\n\nfunction expandLastSubMenu<T>(\n  model: Model<T>,\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  return mapLastMenu(model, (lastModel) => {\n    return lastModel.menu.selectedItem\n      .map((selectedItem) => {\n        return selectedItem.subMenu\n          .map(() => {\n            if (lastModel.uuid.type === 'Nothing') {\n              return withOut(noCmd<Model<T>, Msg<T>>(lastModel));\n            }\n            const uuid = lastModel.uuid.value;\n            const mac: [Model<T>, Cmd<Msg<T>>] = lastModel.menu\n              .indexOfItem(selectedItem)\n              .map((itemIndex) => {\n                return openSubMenu(\n                  lastModel,\n                  uuid,\n                  selectedItem,\n                  itemIndex,\n                  true,\n                );\n              })\n              .withDefaultSupply(() => noCmd(lastModel));\n            return withOut(mac);\n          })\n          .withDefaultSupply(() => {\n            return withOut(noCmd(lastModel));\n          });\n      })\n      .withDefaultSupply(() => {\n        return withOut(noCmd(lastModel));\n      });\n  });\n}\n\nfunction toggleOrSelectItem<T>(\n  model: Model<T>,\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  return mapLastMenu(model, (lastModel) => {\n    return lastModel.menu.selectedItem\n      .map((selectedItem) => {\n        if (lastModel.uuid.type === 'Nothing') {\n          return withOut(noCmd<Model<T>, Msg<T>>(lastModel));\n        }\n        const uuid = lastModel.uuid.value;\n        // do we have a sub-menu ?\n        return selectedItem.subMenu\n          .map(() => {\n            // we have a sub-menu, expand it\n            const mac: [Model<T>, Cmd<Msg<T>>] = lastModel.menu\n              .indexOfItem(selectedItem)\n              .map((itemIndex) =>\n                openSubMenu(lastModel, uuid, selectedItem, itemIndex, true),\n              )\n              .withDefaultSupply(() => noCmd(lastModel));\n            return withOut(mac);\n          })\n          .withDefaultSupply(() => {\n            // no sub-menu, select the item\n            return withOut(noCmd(lastModel), outItemSelected(selectedItem));\n          });\n      })\n      .withDefaultSupply(() => withOut(noCmd(lastModel)));\n  });\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport * as React from 'react';\nimport { Menu, menuId, MenuItem, menuItemId } from './Menu';\nimport { childMsg, Msg } from './Msg';\nimport { Dispatcher, map } from 'react-tea-cup';\nimport { ItemRenderer } from './ItemRenderer';\nimport { Model } from './Model';\nimport { stopEvent } from '../common';\n\nexport interface ViewMenuProps<T> {\n  model: Model<T>;\n  dispatch: Dispatcher<Msg<T>>;\n  renderer: ItemRenderer<T>;\n}\n\nexport function ViewMenu<T>(props: ViewMenuProps<T>): React.ReactElement {\n  const { model, dispatch, renderer } = props;\n  const { menu, state, uuid, windowSize } = model;\n  if (uuid.type === 'Nothing') {\n    return <></>;\n  }\n  if (windowSize.type === 'Nothing') {\n    return <></>;\n  }\n\n  const renderItems = () =>\n    menu.elems.map((element, index) => {\n      switch (element.tag) {\n        case 'item': {\n          return (\n            <ViewMenuItem\n              key={`item-${index}`}\n              uuid={uuid.value}\n              itemIndex={index}\n              menu={menu}\n              item={element}\n              {...props}\n            />\n          );\n        }\n        case 'separator': {\n          return <div key={`sep-${index}`} className=\"tm-separator\" />;\n        }\n      }\n    });\n\n  switch (state.tag) {\n    case 'placing': {\n      const { refBox } = state;\n      return (\n        <div\n          className=\"tm-placer\"\n          style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            bottom: 0,\n            right: 0,\n            overflow: 'hidden',\n          }}\n          onContextMenu={stopEvent}\n        >\n          <div\n            className=\"tm\"\n            id={menuId(uuid.value)}\n            style={{\n              position: 'absolute',\n              top: refBox.p.y,\n              left: refBox.p.x,\n              visibility: 'hidden',\n            }}\n            onContextMenu={stopEvent}\n          >\n            {renderItems()}\n          </div>\n        </div>\n      );\n    }\n    case 'open': {\n      const { box } = state;\n      const { p, d } = box;\n      return (\n        <>\n          <div\n            className=\"tm\"\n            id={menuId(uuid.value)}\n            style={{\n              position: 'absolute',\n              top: p.y,\n              left: p.x,\n              width: d.w,\n              height: d.h,\n            }}\n            onContextMenu={stopEvent}\n          >\n            {renderItems()}\n          </div>\n          {model.child\n            .map((child) => (\n              <ViewMenu\n                model={child}\n                dispatch={map(dispatch, childMsg)}\n                renderer={renderer}\n              />\n            ))\n            .withDefaultSupply(() => (\n              <></>\n            ))}\n        </>\n      );\n    }\n  }\n}\n\nexport interface ViewMenuItemProps<T> {\n  uuid: string;\n  itemIndex: number;\n  menu: Menu<T>;\n  item: MenuItem<T>;\n  dispatch: Dispatcher<Msg<T>>;\n  renderer: ItemRenderer<T>;\n}\n\nexport function ViewMenuItem<T>(\n  props: ViewMenuItemProps<T>,\n): React.ReactElement {\n  const { menu, item, renderer, dispatch, uuid, itemIndex } = props;\n  const selected = menu.isSelected(item);\n  return (\n    <div\n      id={menuItemId(uuid, itemIndex)}\n      onMouseEnter={() => dispatch({ tag: 'mouse-enter', item, itemIndex })}\n      onMouseLeave={() => dispatch({ tag: 'mouse-leave', item, itemIndex })}\n      onClick={() => {\n        dispatch({ tag: 'item-clicked', item });\n      }}\n    >\n      {renderer({\n        data: item.userData,\n        active: selected,\n        hasSubMenu: item.subMenu.isJust(),\n      })}\n    </div>\n  );\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport * as React from 'react';\n\nexport interface RendererInput<T> {\n  readonly data: T;\n  readonly active: boolean;\n  readonly hasSubMenu: boolean;\n}\n\nexport type ItemRenderer<T> = (input: RendererInput<T>) => React.ReactNode;\n\nexport function defaultItemRenderer<T>(\n  contentRenderer: (t: T) => React.ReactNode,\n): ItemRenderer<T> {\n  return (input) => {\n    const { data, active, hasSubMenu } = input;\n    const activeClass = active ? ' tm-active' : '';\n    return (\n      <div className={`tm-item${activeClass}`}>\n        <div className=\"tm-item__content\">{contentRenderer(data)}</div>\n        {hasSubMenu ? <div className=\"tm-item__submenu\">›</div> : <></>}\n      </div>\n    );\n  };\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport * as React from 'react';\nimport { Box, Dim, getWindowDimensions, placeCombo } from '../common';\nimport {\n  Cmd,\n  DocumentEvents,\n  just,\n  Maybe,\n  noCmd,\n  nothing,\n  Result,\n  Sub,\n  Task,\n  uuid,\n} from 'react-tea-cup';\n\nexport type Model =\n  | { tag: 'fresh' }\n  | {\n      tag: 'ready';\n      initData: InitData;\n      placed: Maybe<Box>;\n    }\n  | { tag: 'error'; e: Error };\n\nfunction errorModel(e: Error): Model {\n  return {\n    tag: 'error',\n    e,\n  };\n}\n\ninterface InitData {\n  readonly refBox: Box;\n  readonly windowDimensions: Dim;\n  readonly uuid: string;\n}\n\nexport type Msg =\n  | { tag: 'got-init-data'; r: Result<Error, InitData> }\n  | { tag: 'got-rendered-box'; r: Result<Error, Box> }\n  | { tag: 'request-close' }\n  | { tag: 'noop' };\n\nfunction gotRenderedBox(r: Result<Error, Box>): Msg {\n  return {\n    tag: 'got-rendered-box',\n    r,\n  };\n}\n\nfunction gotInitData(r: Result<Error, InitData>): Msg {\n  return {\n    tag: 'got-init-data',\n    r,\n  };\n}\n\nconst noop: Msg = {\n  tag: 'noop',\n};\n\nconst requestClose: Msg = {\n  tag: 'request-close',\n};\n\nexport type Renderer = () => React.ReactNode;\n\nexport function open(getRefBox: Task<Error, Box>): [Model, Cmd<Msg>] {\n  const model: Model = {\n    tag: 'fresh',\n  };\n  const getInitData: Task<Error, InitData> = getRefBox.andThen((refBox) =>\n    getWindowDimensions.andThen((windowDimensions) =>\n      uuid().map((uuid) => ({ refBox, windowDimensions, uuid })),\n    ),\n  );\n\n  const cmd: Cmd<Msg> = Task.attempt(getInitData, gotInitData);\n  return [model, cmd];\n}\n\nexport interface ViewDropDownProps {\n  readonly renderer: Renderer;\n  readonly model: Model;\n}\n\nexport function ViewDropDown(props: ViewDropDownProps): React.ReactElement {\n  const { renderer, model } = props;\n  switch (model.tag) {\n    case 'fresh': {\n      return (\n        <div\n          className=\"tm-drop-down tm-placing\"\n          style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            visibility: 'hidden',\n          }}\n        >\n          {renderer()}\n        </div>\n      );\n    }\n    case 'error': {\n      return <></>; // TODO ?\n    }\n    case 'ready': {\n      return model.placed\n        .map((placedBox) => {\n          const { p, d } = placedBox;\n          return (\n            <div\n              id={model.initData.uuid}\n              className=\"tm-drop-down tm-placed\"\n              style={{\n                position: 'absolute',\n                top: p.y,\n                left: p.x,\n                width: d.w,\n                height: d.h,\n              }}\n            >\n              {renderer()}\n            </div>\n          );\n        })\n        .withDefaultSupply(() => {\n          return (\n            <div\n              id={model.initData.uuid}\n              className=\"tm-drop-down tm-placing\"\n              style={{\n                position: 'absolute',\n                top: 0,\n                left: 0,\n                visibility: 'hidden',\n              }}\n            >\n              {renderer()}\n            </div>\n          );\n        });\n    }\n  }\n}\n\nfunction handleError(error: Error): [Model, Cmd<Msg>, RequestClose] {\n  console.error(error);\n  return withOut(noCmd(errorModel(error)));\n}\n\nexport type RequestClose = boolean;\n\nfunction withOut(\n  mac: [Model, Cmd<Msg>],\n  requestClose: RequestClose = false,\n): [Model, Cmd<Msg>, RequestClose] {\n  return [mac[0], mac[1], requestClose];\n}\n\nexport function update(\n  msg: Msg,\n  model: Model,\n): [Model, Cmd<Msg>, RequestClose] {\n  switch (msg.tag) {\n    case 'got-init-data': {\n      if (model.tag !== 'fresh') {\n        return withOut(noCmd(model));\n      }\n      return msg.r.match((initData) => {\n        const newModel: Model = {\n          tag: 'ready',\n          initData,\n          placed: nothing,\n        };\n        const cmd: Cmd<Msg> = Task.attempt(\n          getRenderedBox(initData.uuid),\n          gotRenderedBox,\n        );\n        return [newModel, cmd, false];\n      }, handleError);\n    }\n    case 'got-rendered-box': {\n      return msg.r.match((renderedBox) => {\n        if (model.tag !== 'ready') {\n          return withOut(noCmd(model));\n        }\n        const { initData } = model;\n        const { windowDimensions, refBox } = initData;\n        const placedBox = placeCombo(windowDimensions, refBox, renderedBox.d);\n        return withOut(\n          noCmd({\n            ...model,\n            placed: just(placedBox),\n          }),\n        );\n      }, handleError);\n    }\n    case 'request-close': {\n      return withOut([model, Cmd.none()], true);\n    }\n    case 'noop': {\n      return withOut(noCmd(model));\n    }\n  }\n}\n\nfunction getRenderedBox(uuid: string): Task<Error, Box> {\n  return byId(uuid).map((elem) =>\n    Box.fromDomRect(elem.getBoundingClientRect()),\n  );\n}\n\nfunction byId(id: string): Task<Error, HTMLElement> {\n  return Task.fromLambda(() => {\n    const e = document.getElementById(id);\n    if (!e) {\n      throw new Error('element not found ' + id);\n    }\n    return e;\n  });\n}\n\nconst documentEvents = new DocumentEvents();\n\nexport function subscriptions(): Sub<Msg> {\n  return Sub.batch([\n    documentEvents.on('keydown', (e) =>\n      e.key === 'Escape' ? requestClose : noop,\n    ),\n    documentEvents.on('mousedown', (evt) => {\n      let t: HTMLElement | null = evt.target as HTMLElement;\n      while (t) {\n        // move up and try to find if we are inside a tea-pop DD !\n        if (t.classList.contains('tm-drop-down')) {\n          return noop;\n        }\n        t = t.parentElement;\n      }\n      return requestClose;\n    }),\n  ]);\n}\n","import {\n  Cmd,\n  Dispatcher,\n  DocumentEvents,\n  just,\n  map,\n  Maybe,\n  noCmd,\n  nothing,\n  Sub,\n  Task,\n  Tuple,\n  WindowEvents\n} from \"react-tea-cup\";\nimport * as React from 'react';\nimport {\n  box,\n  defaultItemRenderer,\n  dim,\n  Dim,\n  item,\n  Menu,\n  menu,\n  place,\n  placeCombo,\n  pos,\n  Pos,\n  separator,\n  ViewMenu,\n  Box,\n  MenuModel,\n  MenuMsg,\n  getWindowDimensions,\n  stopEvent,\n  menuUpdate,\n  MenuOutMsg,\n  menuSubscriptions,\n  menuOpen,\n  DropDownModel,\n  ViewDropDown,\n  dropDownOpen,\n  DropDownMsg,\n  dropDownUpdate, dropDownSubscriptions,\n  DropDownRequestClose,\n} from 'tea-pop';\n\nexport interface Model {\n  // keep track of mouse position\n  readonly mousePos: Pos;\n  // page to display\n  readonly page: Page;\n}\n\ntype Page = MainPage | PlacementPage | DropDownPage\n\ninterface MainPage {\n  readonly tag: 'main-page';\n  // ref to the tea-pop model\n  readonly menuModel: Maybe<MyMenuModel>;\n  // keep last clicked item\n  readonly lastClicked: Maybe<string>;\n}\n\nfunction initialMainPage(): MainPage {\n  return {\n    tag: \"main-page\",\n    menuModel: nothing,\n    lastClicked: nothing,\n  }\n}\n\nfunction openMainPage(model: Model): [Model, Cmd<Msg>] {\n  return noCmd({...model, page: initialMainPage()});\n}\n\ntype PlacementMode = \"menu\" | \"drop-down\";\n\ninterface PlacementPage {\n  readonly tag: 'placement-page';\n  readonly mode: PlacementMode;\n  readonly viewportDim: Maybe<Dim>;\n}\n\nfunction openPlacementPage(model: Model): [Model, Cmd<Msg>] {\n  return Tuple.t2n(\n      {\n        ...model,\n        page: {\n          tag: \"placement-page\",\n          viewportDim: nothing,\n          refDim: dim(100),\n          mode: \"menu\",\n        }\n      },\n      Task.perform(\n          Task.succeedLazy(() => dim(window.innerWidth, window.innerHeight)),\n          gotWindowDimensions\n      )\n  )\n}\n\ninterface DropDownPage {\n  readonly tag: \"drop-down-page\";\n  readonly viewportDim: Maybe<Dim>;\n  readonly indexAndModel: Maybe<Tuple<number,DropDownModel>>;\n}\n\nfunction openDropDownPage(model: Model): [Model, Cmd<Msg>] {\n  return Tuple.t2n({\n    ...model,\n    page: {\n      tag: \"drop-down-page\",\n      viewportDim: nothing,\n      indexAndModel: nothing,\n    }\n  }, Task.perform(getWindowDimensions, gotWindowDimensions))\n}\n\n// just to avoid too much typing\nexport type MyMenuModel = MenuModel<string>\nexport type MyMenuMsg = MenuMsg<string>\n\n/*\n * Msg\n */\n\ntype PageTag = \"main-page\" | \"placement-page\" | \"drop-down-page\";\n\nexport type Msg =\n    | { tag: 'switch-page', page: PageTag }\n    | { tag: 'got-window-dimensions', d: Dim }\n    | { tag: 'main-page-msg', m: MainPageMsg }\n    | { tag: 'dd-page-msg', m: DropDownPageMsg }\n    | { tag: 'mouse-move', pos: Pos }\n    | { tag: 'key-down', key: string }\n\ntype DropDownPageMsg =\n    | { tag: \"button-clicked\", index: number; b: Box }\n    | { tag: \"dd-msg\", m: DropDownMsg }\n\nfunction dropDownPageMsg(m: DropDownPageMsg): Msg {\n  return {\n    tag: \"dd-page-msg\",\n    m\n  }\n}\n\ntype MainPageMsg =\n    | { tag: 'menu-msg', msg: MyMenuMsg }\n    | { tag: 'mouse-down', button: number }\n\nfunction mainPageMsg(m: MainPageMsg): Msg {\n  return {\n    tag: \"main-page-msg\",\n    m\n  }\n}\n\nfunction gotWindowDimensions(d: Dim): Msg {\n  return {\n    tag: \"got-window-dimensions\",\n    d\n  }\n}\n\nfunction menuMsg(msg: MyMenuMsg): MainPageMsg {\n  return {\n    tag: \"menu-msg\",\n    msg\n  }\n}\n\nfunction onMouseDown(button: number): Msg {\n  return mainPageMsg({\n    tag: \"mouse-down\", button\n  })\n}\n\nfunction onMouseMove(pos: Pos): Msg {\n  return {\n    tag: \"mouse-move\", pos\n  }\n}\n\nfunction onKeyDown(key: string): Msg {\n  return {\n    tag: \"key-down\", key\n  }\n}\n\nfunction switchPage(p: PageTag): Msg {\n  return {\n    tag: \"switch-page\",\n    page: p,\n  }\n}\n\n/*\n * We keep our menus as constants. Those are, like everything, immutable.\n * They will serve as prototypes for when we open menus in reaction to clicks or\n * keystrokes...\n * We use strings for our data types, but it could hold a richer data type.\n */\n\nconst mySubMenu2: Menu<string> = menu([\n  item(\"Try\"),\n  item(\"Finally\")\n])\n\nconst mySubMenu1: Menu<string> = menu([\n  item(\"Do this\"),\n  item(\"Do that\"),\n  separator,\n  item(\"Another sub menu...\", mySubMenu2)\n])\n\nconst myMenu: Menu<string> = menu([\n  item(\"Copy\"),\n  item(\"Cut\"),\n  item(\"Paste\"),\n  separator,\n  item(\"Yalla\", mySubMenu1),\n  item(\"I am a bit longer\")\n]);\n\n/**\n * We use the default item renderer with our item data type (string).\n */\n\nconst MyRenderer = defaultItemRenderer((s: string) => <span>{s}</span>);\n\n/*\n * init, view, update, subs...\n */\n\nexport function init(): [Model, Cmd<Msg>] {\n  return noCmd({\n    mousePos: Pos.origin,\n    page: initialMainPage(),\n  });\n}\n\nexport function view(dispatch: Dispatcher<Msg>, model: Model) {\n  switch (model.page.tag) {\n    case \"main-page\": {\n      return viewMainPage(dispatch, model.page);\n    }\n    case \"placement-page\": {\n      return viewPlacementPage(dispatch, model, model.page);\n    }\n    case \"drop-down-page\": {\n      return viewDropDownPage(dispatch, model.page);\n    }\n  }\n}\n\n\nfunction viewPlacementPage(dispatch: Dispatcher<Msg>, model: Model, page: PlacementPage) {\n  const {viewportDim} = page;\n  return viewportDim.map(vd => {\n    let placeFct = page.mode === \"menu\" ? place : placeCombo\n    const {mousePos} = model;\n    const elemDim = dim(600, 400);\n    const refDim = dim(100, 50);\n    const placedBox: Box = placeFct(vd, box(pos(mousePos.x, mousePos.y), refDim), elemDim);\n    const viewDim = (d: Dim) => <span>{d.w}*{d.h}</span>\n    const viewPos = (p: Pos) => <span>{p.x}:{p.y}</span>\n    return (\n        <div className=\"demo\">\n          <div className=\"dimensions\">\n            <h1>Placement tests (<code>x</code> to close)</h1>\n            <ul>\n              <li>mode: {page.mode} (toggle with <code>M</code>)</li>\n              <li>elem: {viewDim(elemDim)}</li>\n              <li>viewport: {viewDim(vd)}</li>\n              <li>ref: {viewDim(refDim)}</li>\n              <li>mousePos: {viewPos(mousePos)}</li>\n              <li>placed: {viewPos(placedBox.p)}, {viewDim(placedBox.d)}</li>\n            </ul>\n          </div>\n          <div className=\"ref-elem\" style={{\n            height: refDim.h,\n            width: refDim.w,\n            left: model.mousePos.x,\n            top: model.mousePos.y,\n          }}>\n          </div>\n          <div className=\"menu-elem\" style={{\n            height: placedBox.d.h,\n            width: placedBox.d.w,\n            left: placedBox.p.x,\n            top: placedBox.p.y,\n          }}>\n          </div>\n        </div>\n    )\n  }).withDefaultSupply(() => <></>);\n}\n\nfunction viewMainPage(dispatch: Dispatcher<Msg>, page: MainPage) {\n  return (\n      <>\n        <div\n            className=\"demo\"\n            onContextMenu={stopEvent}\n            onMouseDown={e => dispatch(onMouseDown(e.button))}\n        >\n          <div className=\"page-switch\">\n            { /* eslint-disable-next-line */}\n            <a href=\"#\" onClick={() => dispatch(switchPage(\"drop-down-page\"))}>Drop-down</a>\n            {\" \"}|{\" \"}\n            { /* eslint-disable-next-line */}\n            <a href=\"#\" onClick={() => dispatch(switchPage(\"placement-page\"))}>Placement tests</a>\n          </div>\n          {page.menuModel\n              .map(() => <span>Menu is open</span>)\n              .withDefaultSupply(() =>\n                  page.lastClicked\n                      .map(lastClicked => <span>You selected <em>{lastClicked}</em></span>)\n                      .withDefaultSupply(() =>\n                          <>\n                            <div>Right-click anywhere, or use the <code>≣</code> key.</div>\n                          </>\n                      )\n              )\n          }\n        </div>\n        {page.menuModel\n            .map(menuModel =>\n                <ViewMenu model={menuModel} dispatch={map(dispatch, m => mainPageMsg(menuMsg(m)))}\n                          renderer={MyRenderer}/>\n            )\n            .withDefault(<></>)\n        }\n      </>\n  )\n}\n\nfunction viewDropDownPage(dispatch: Dispatcher<Msg>, page: DropDownPage) {\n  const steps = 10;\n  const padding = 4;\n  return page.viewportDim\n      .map(viewportDim => {\n        const xStep = Math.floor(viewportDim.w / steps);\n        const yStep = Math.floor(viewportDim.h / steps);\n        const buttons = [];\n        let btnIndex = 1;\n        const height = yStep - (padding * 2);\n        const width = xStep - (padding * 2);\n        for (let x = 0; (x + padding + width) < viewportDim.w; x += xStep) {\n          for (let y = 0; (y + padding + height) < viewportDim.h; y += yStep) {\n            const curBtnIndex = btnIndex;\n            const top = y + padding;\n            const left = x + padding;\n            const backgroundColor = page.indexAndModel\n                .map(iam => iam.a)\n                .filter(i => i === curBtnIndex).map(() => \"lightblue\").withDefault(\"lightgray\");\n            buttons.push(\n                <button\n                    key={\"btn\" + btnIndex}\n                    style={{\n                      position: \"absolute\",\n                      top,\n                      left,\n                      height,\n                      width,\n                      border: \"none\",\n                      backgroundColor,\n                    }}\n                    onClick={(evt) => dispatch(dropDownPageMsg({\n                      tag: \"button-clicked\",\n                      index: curBtnIndex,\n                      b: Box.fromDomRect((evt.target as HTMLElement).getBoundingClientRect())\n                    }))}\n                >\n                  {btnIndex}\n                </button>\n            )\n            btnIndex++;\n          }\n        }\n        return (\n            <>\n              <div className=\"drop-down-page\">\n                {buttons}\n              </div>\n              {page.indexAndModel\n                  .map(ddModel =>\n                      <ViewDropDown renderer={() => <div className=\"my-drop-down\">HELLO</div>} model={ddModel.b}/>\n                  )\n                  .withDefaultSupply(() => <></>)\n              }\n            </>\n        )\n      })\n      .withDefaultSupply(() => <></>)\n}\n\nexport function update(msg: Msg, model: Model): [Model, Cmd<Msg>] {\n  switch (msg.tag) {\n    case \"main-page-msg\": {\n      if (model.page.tag !== \"main-page\") {\n        return noCmd(model);\n      }\n      const mpMsg: MainPageMsg = msg.m;\n      const mainPage: MainPage = model.page;\n      switch (mpMsg.tag) {\n        case \"menu-msg\": {\n          // got child msg, update our child...\n          if (mainPage.menuModel.type === 'Nothing') {\n            return noCmd(model);\n          }\n          const menuModel = mainPage.menuModel.value;\n          const mco = menuUpdate(mpMsg.msg, menuModel);\n          const newPage: MainPage = {\n            ...mainPage,\n            menuModel: just(mco[0])\n          };\n          const newModel: Model = {\n            ...model, page: newPage\n          };\n          const cmd: Cmd<Msg> = mco[1].map(menuMsg).map(mainPageMsg);\n          const mac: [Model, Cmd<Msg>] = [newModel, cmd];\n          // and handle its out msg if needed\n          const outMsg: Maybe<MenuOutMsg<string>> = mco[2];\n          return outMsg\n              // eslint-disable-next-line array-callback-return\n              .map(out => {\n                switch (out.tag) {\n                  case \"request-close\": {\n                    const mac2 = closeMenu(newModel);\n                    return Tuple.fromNative(mac2).mapSecond(c => Cmd.batch([cmd, c])).toNative();\n                  }\n                  case \"item-selected\": {\n                    const mac2 = closeMenu(newModel, just(out.data));\n                    return Tuple.fromNative(mac2).mapSecond(c => Cmd.batch([cmd, c])).toNative();\n                  }\n                }\n              })\n              .withDefault(mac);\n        }\n        case \"mouse-down\": {\n          // open menu on right click\n          if (mpMsg.button === 2) {\n            return updateMenu(model, menuOpen(myMenu, box(model.mousePos, Dim.zero)));\n          }\n          return noCmd(model);\n        }\n      }\n      break;\n    }\n    case \"key-down\": {\n      switch (model.page.tag) {\n        case \"main-page\": {\n          // open menu on context menu key\n          if (msg.key === 'ContextMenu') {\n            return updateMenu(model, menuOpen(myMenu, box(model.mousePos, Dim.zero)));\n          }\n          return noCmd(model);\n        }\n        case \"placement-page\": {\n          const placementPage = model.page;\n          // close placement test on ESC\n          switch (msg.key) {\n            case 'x': {\n              return noCmd({\n                ...model,\n                page: initialMainPage()\n              })\n            }\n            case 'm': {\n              return noCmd({\n                ...model,\n                page: {\n                  ...placementPage,\n                  mode: placementPage.mode === \"menu\" ? \"drop-down\" : \"menu\"\n                }\n              })\n            }\n            default:\n              return noCmd(model);\n          }\n        }\n        case \"drop-down-page\": {\n          switch (msg.key) {\n            case 'x': {\n              return noCmd({\n                ...model,\n                page: initialMainPage()\n              })\n            }\n          }\n          return noCmd(model);\n        }\n      }\n      break;\n    }\n    case \"mouse-move\": {\n      // keep track of the mouse pos (needed for opening with keyboard)\n      return noCmd({...model, mousePos: msg.pos})\n    }\n    case \"switch-page\": {\n      switch (msg.page) {\n        case \"main-page\": {\n          return openMainPage(model);\n        }\n        case \"drop-down-page\": {\n          return openDropDownPage(model);\n        }\n        case \"placement-page\": {\n          return openPlacementPage(model);\n        }\n      }\n      break;\n    }\n    case \"got-window-dimensions\": {\n      if (model.page.tag === \"placement-page\" || model.page.tag === \"drop-down-page\") {\n        const page = model.page;\n        return noCmd({\n          ...model,\n          page: {...page, viewportDim: just(msg.d)}\n        })\n      }\n      return noCmd(model);\n    }\n    case \"dd-page-msg\": {\n      if (model.page.tag !== \"drop-down-page\") {\n        return noCmd(model);\n      }\n      const { page } = model;\n      const pageMsg = msg.m;\n      switch (pageMsg.tag) {\n        case \"button-clicked\": {\n          const ddMac: [DropDownModel, Cmd<DropDownMsg>] = dropDownOpen(Task.succeed(pageMsg.b));\n          return Tuple.fromNative(ddMac)\n              .mapFirst(ddModel => ({\n                ...model,\n                page: {\n                  ...page,\n                  indexAndModel: just(new Tuple(pageMsg.index, ddModel))\n                }\n              }))\n              .mapSecond(c => c.map(m => dropDownPageMsg({ tag: \"dd-msg\", m})))\n              .toNative();\n        }\n        case \"dd-msg\": {\n          return model.page.indexAndModel\n              .map(iam => {\n                const ddMac: [DropDownModel, Cmd<DropDownMsg>, DropDownRequestClose] = dropDownUpdate(pageMsg.m, iam.b);\n                if (ddMac[2]) {\n                  // close requested\n                  const newModel: Model = {\n                    ...model,\n                    page: {\n                      ...page,\n                      indexAndModel: nothing,\n                    }\n                  };\n                  return noCmd<Model, Msg>(newModel);\n                //   return noCmd({\n                //     ...model,\n                //     page: {\n                //       ...page,\n                //       indexAndModel: nothing,\n                //     }\n                //   });\n                }\n                const res: [Model, Cmd<Msg>] = Tuple.fromNative([ddMac[0], ddMac[1]])\n                    .mapFirst(ddModel => ({\n                      ...model,\n                      page: {\n                        ...page,\n                        indexAndModel: page.indexAndModel.map(t => new Tuple(t.a, ddModel))\n                      }\n                    }))\n                    .mapSecond(c => c.map(m => dropDownPageMsg({ tag: \"dd-msg\", m})))\n                    .toNative();\n                return res;\n              })\n              .withDefaultSupply(() => noCmd(model));\n        }\n      }\n    }\n  }\n}\n\nconst documentEvents = new DocumentEvents();\nconst windowEvents = new WindowEvents();\n\nexport function subscriptions(model: Model): Sub<Msg> {\n  const mouseMove: Sub<Msg> = documentEvents.on('mousemove', e => onMouseMove(pos(e.pageX, e.pageY)));\n  const keyDown: Sub<Msg> = documentEvents.on('keydown', e => onKeyDown(e.key));\n  switch (model.page.tag) {\n    case \"main-page\": {\n      const mainPage = model.page;\n      // the menu's subs\n      const menuSub: Sub<Msg> = mainPage.menuModel\n          .map(mm => menuSubscriptions(mm).map(menuMsg).map(mainPageMsg))\n          .withDefaultSupply(() => Sub.none());\n      // mouse & key subs\n      return Sub.batch([menuSub, mouseMove, keyDown]);\n    }\n    case \"placement-page\": {\n      return Sub.batch([\n        mouseMove,\n        keyDown,\n        windowEvents.on('resize', e => gotWindowDimensions(dim(window.innerWidth, window.innerHeight)))\n      ])\n    }\n    case \"drop-down-page\": {\n      return Sub.batch([\n        dropDownSubscriptions().map(m => dropDownPageMsg({ tag: \"dd-msg\", m })),\n        keyDown,\n        windowEvents.on('resize', e => gotWindowDimensions(dim(window.innerWidth, window.innerHeight)))\n      ]);\n    }\n  }\n}\n\n/*\n * Helper functions\n */\n\nfunction updateMenu(model: Model, mac: [MyMenuModel, Cmd<MyMenuMsg>]): [Model, Cmd<Msg>] {\n  if (model.page.tag !== \"main-page\") {\n    return noCmd(model);\n  }\n  const mainPage = model.page;\n  return Tuple.fromNative(mac)\n      .mapFirst(mm => {\n        const newModel: Model = {\n          ...model,\n          page: {\n            ...mainPage,\n            menuModel: just(mm)\n          }\n        }\n        return newModel;\n        // } ({...model, page: left({ ...mainPage, menuModel: just(mm)}})))\n      })\n      .mapSecond(mc => mc.map(menuMsg).map(mainPageMsg))\n      .toNative();\n}\n\nfunction closeMenu(model: Model, lastClicked: Maybe<string> = nothing): [Model, Cmd<Msg>] {\n  if (model.page.tag !== \"main-page\") {\n    return noCmd(model);\n  }\n  const mainPage = model.page;\n  const newModel: Model = {\n    ...model,\n    page: {\n      ...mainPage,\n      menuModel: nothing,\n      lastClicked\n    }\n  }\n  return noCmd(newModel)\n}\n\n","import React from 'react';\nimport './App.scss';\nimport {DevTools, Program} from \"react-tea-cup\";\nimport * as Demo from './Demo';\n\nfunction App() {\n  return (\n      <Program\n          init={Demo.init}\n          view={Demo.view}\n          update={Demo.update}\n          subscriptions={Demo.subscriptions}\n          devTools={DevTools.init<Demo.Model, Demo.Msg>(window)}\n      />\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}