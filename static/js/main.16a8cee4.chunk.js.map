{"version":3,"sources":["../../src/index.ts","../../src/Dim.ts","../../src/Pos.ts","../../src/Msg.ts","../../src/Menu.ts","../../src/Box.ts","../../src/Model.ts","../../src/StopEvent.ts","../../src/Popover.ts","../../src/WindowUtils.ts","../../src/TeaPop.ts","../../src/Logger.ts","../../src/ViewMenu.tsx","../../src/ItemRenderer.tsx","../../src/DropDown.tsx","../../src/ComboBox.ts","../../src/ViewComboBox.tsx","Msg.ts","routes.ts","menu-page/MenuPageMsg.ts","menu-page/ViewMenuPage.tsx","menu-page/MenuPage.ts","menu-page/Update.ts","dropdown-page/DropDownPageMsg.ts","dropdown-page/Update.ts","placement-page/PlacementPageMsg.ts","placement-page/Update.ts","combo-page/ComboPageMsg.ts","combo-page/Update.ts","combo-page/ViewComboPage.tsx","DemoApp.tsx","Model.ts","dropdown-page/ViewDropDownPage.tsx","placement-page/ViewPlacementPage.tsx","index.tsx"],"names":["init","update","subscriptions","Dim","w","h","dim","zero","Pos","x","y","p","this","pos","origin","Menu","elements","selectIndex","item","select","e","ListWithSelection","fromArray","toArray","selected","getSelected","type","value","tag","just","nothing","isSelected","start","elems","i","length","down","getSelectedIndex","map","selectedIndex","findNextItemIndex","findPreviousItemIndex","nextIndex","withDefault","withDefaultSupply","indexOf","menuId","uuid","btoa","menuItemId","itemIndex","byId","id","Task","fromLambda","document","getElementById","Error","items","userData","subMenu","maybeOf","separator","Box","d","rect","height","width","box","right","bottom","left","top","isPointInside","topLeft","bottomRight","ddModel","fetchCount","index","model","up","r","nbItems","curIndex","newIndex","fixed","stopEvent","preventDefault","stopPropagation","place1DEnd","viewportW","refX","refW","elemW","offset","len","place1DStart","viewport","refBox","elem","pX","pY","elemEnd","spaceBefore","spaceAfter","placeComboY","window","innerWidth","innerHeight","open","menu","selectFirst","log","initialModel","selectFirstItem","deselectAll","Cmd","batch","perform","getWindowDimensions","gotWindowDimensions","u","gotUuid","postOpen","noCmd","windowSize","attempt","menuTask","getBoundingClientRect","b","fromDomRect","gotMenuBox","withOut","mac","outMsg","outItemSelected","data","openSubMenu","isNothing","subMenuCounter","Tuple","t2n","menuItemTask","gotItemBox","msg","state","match","menuBox","placedBox","place","err","error","key","collapseLastSubMenu","keyboardNavigated","child","mapLastMenu","lastModel","moveSelection","selectedItem","indexOfItem","expandLastSubMenu","toggleOrSelectItem","newModel","navigatedWithKeyboard","selectItem","isJust","itemBox","newModel2","childMsg","mco","m","windowEvents","WindowEvents","documentEvents","DocumentEvents","Sub","on","gotwindowBlur","evt","button","noop","t","target","classList","contains","parentElement","docMouseDown","gotKeyDown","none","succeedLazy","f","fromNative","mapFirst","c","mapSecond","cmd","toNative","console","ViewMenuItem","props","renderer","dispatch","onMouseMove","onMouseLeave","onClick","active","hasSubMenu","ViewMenu","renderItems","element","className","style","position","overflow","onContextMenu","visibility","contentRenderer","input","activeClass","gotRenderedBox","gotInitData","requestClose","handleError","getRefBox","windowDimensions","getInitData","andThen","placed","initData","getRenderedBox","renderedBox","placeCombo","fetchFromProvider","provider","newFetchCount","fetchItems","res","gotItems","itemToString","updatePiped","closeCombo","focusInputCmd","triggerCombo","refBoxTask","comboHtmlId","ddMac","dropDownOpen","ddCmd","dropDownMsg","inputByUuid","focus","inputFocused","triggerClicked","handleArrowKey","isUp","scrollCmd","toMaybe","selIndex","scrollIntoViewTask","comboItemHtmlId","scrollIntoView","noOp","uuidCmd","dropDownUpdate","renderInput","onChange","onBlur","onKeyDown","onTriggerClick","ViewDropDown","renderItem","l","classes","concat","join","onMouseDown","renderNoMatches","message","renderLoading","menuPageMsg","dropDownPageMsg","placementPageMsg","comboPageMsg","router","Router","route0","route1","str","routeToUrl","route","menuMsg","MyRenderer","defaultItemRenderer","s","mySubMenu2","mySubMenu1","myMenu","menuPageUpdate","menuPage","menuModel","menuUpdate","newMenuPage","out","mac2","closeMenu","updateMenu","menuOpen","mousePos","page","mm","mc","lastClicked","ddMsg","dropDownPageUpdate","ddPage","succeed","newPage","indexAndModel","iam","a","viewportDim","placementPageUpdate","mode","comboBoxMsg","myItems","push","myProvider","filter","comboPageUpdate","maco","comboBoxUpdate","comboModel","forEach","MyComboRenderer","parseLocation","initHome","dropDownPageInit","pp","placementPageInit","comboBoxInit","comboPageInit","link","text","href","navigate","view","viewMenuPage","xStep","Math","floor","yStep","buttons","btnIndex","padding","curBtnIndex","backgroundColor","border","viewDropDownPage","vd","placeFct","elemDim","refDim","viewDim","viewPos","viewPlacementPage","viewComboPage","updatePage","updateF","liftF","newUrl","menuSub","menuSubscriptions","mouseMove","clientX","clientY","keyDown","menuPageSubs","dropDownSubscriptions","pageX","pageY","placementPageSubs","comboBoxSubscriptions","comboPageSubs","onUrlChange","DemoApp","devTools","DevTools","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.16a8cee4.chunk.js","sourcesContent":["/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nexport { Model as ComboBoxModel } from './Model';\nexport { Msg as ComboBoxMsg } from './Msg';\nexport { OutMsg as ComboBoxOutMsg } from './OutMsg';\nexport {\n  init as comboBoxInit,\n  update as comboBoxUpdate,\n  subscriptions as comboBoxSubscriptions,\n} from './ComboBox';\nexport * from './ViewComboBox';\nexport { Provider as ComboBoxProvider } from './Provider';\nexport {\n  Renderer as ComboBoxRenderer,\n  RenderItemProps as ComboBoxRenderItemProps,\n  RenderInputProps as ComboBoxRenderInputProps,\n} from './Renderer';\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nexport class Dim {\n  constructor(readonly w: number, readonly h: number) {}\n\n  static zero: Dim = dim(0);\n}\n\nexport function dim(w: number, h?: number): Dim {\n  return new Dim(w, h ?? w);\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nexport class Pos {\n  constructor(readonly x: number, readonly y: number) {}\n\n  add(p: Pos): Pos {\n    return new Pos(this.x + p.x, this.y + p.y);\n  }\n\n  static origin: Pos = pos(0, 0);\n}\n\nexport function pos(x: number, y: number): Pos {\n  return new Pos(x, y);\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { Result } from 'tea-cup-core';\nimport { DropDownMsg } from 'tea-pop-dropdown';\n\nexport type Msg<T> =\n  | { tag: 'input-value-changed'; value: string }\n  | { tag: 'trigger-clicked' }\n  | { tag: 'got-uuid'; uuid: string }\n  | { tag: 'dd-msg'; child: DropDownMsg }\n  | { tag: 'input-blurred' }\n  | { tag: 'input-focused'; res: Result<Error, HTMLElement> }\n  | { tag: 'input-key-down'; key: string }\n  | {\n      tag: 'got-items-from-provider';\n      res: Result<Error, ReadonlyArray<T>>;\n      fetchCount: number;\n    }\n  | { tag: 'item-clicked'; item: T }\n  | { tag: 'noop' };\n\nexport function dropDownMsg<T>(child: DropDownMsg): Msg<T> {\n  return {\n    tag: 'dd-msg',\n    child,\n  };\n}\n\nexport function inputFocused<T>(res: Result<Error, HTMLElement>): Msg<T> {\n  return {\n    tag: 'input-focused',\n    res,\n  };\n}\n\nexport function gotItems<T>(\n  res: Result<Error, ReadonlyArray<T>>,\n  fetchCount: number,\n): Msg<T> {\n  return {\n    tag: 'got-items-from-provider',\n    res,\n    fetchCount,\n  };\n}\n\nexport function noOp<T>(): Msg<T> {\n  return {\n    tag: 'noop',\n  };\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport {\n  just,\n  ListWithSelection,\n  Maybe,\n  maybeOf,\n  nothing,\n  Task,\n} from 'tea-cup-core';\n\nexport class Menu<T> {\n  constructor(private readonly elements: ListWithSelection<MenuElement<T>>) {}\n\n  selectFirstItem(): Menu<T> {\n    return new Menu(this.elements.selectIndex(0));\n  }\n\n  selectItem(item: MenuItem<T>): Menu<T> {\n    return new Menu(this.elements.select((e) => e === item));\n  }\n\n  deselectAll(): Menu<T> {\n    return new Menu(ListWithSelection.fromArray(this.elements.toArray()));\n  }\n\n  get elems(): ReadonlyArray<MenuElement<T>> {\n    return this.elements.toArray();\n  }\n\n  get selectedItem(): Maybe<MenuItem<T>> {\n    const selected = this.elements.getSelected();\n    if (selected.type === 'Just' && selected.value.tag === 'item') {\n      return just(selected.value);\n    }\n    return nothing;\n  }\n\n  isSelected(item: MenuItem<T>): boolean {\n    return this.elements.isSelected(item);\n  }\n\n  private findNextItemIndex(start: number): Maybe<number> {\n    const elems = this.elems;\n    const s = start === elems.length - 1 ? 0 : start + 1;\n    for (let i = s; i < elems.length; i++) {\n      if (elems[i].tag === 'item') {\n        return just(i);\n      }\n    }\n    return nothing;\n  }\n\n  private findPreviousItemIndex(start: number): Maybe<number> {\n    const elems = this.elems;\n    const s = start === 0 ? elems.length - 1 : start - 1;\n    for (let i = s; i >= 0; i--) {\n      if (elems[i].tag === 'item') {\n        return just(i);\n      }\n    }\n    return nothing;\n  }\n\n  moveSelection(down: boolean): Menu<T> {\n    return this.elements\n      .getSelectedIndex()\n      .map((selectedIndex) => {\n        const mbNextIndex = down\n          ? this.findNextItemIndex(selectedIndex)\n          : this.findPreviousItemIndex(selectedIndex);\n        return mbNextIndex\n          .map((nextIndex) => new Menu(this.elements.selectIndex(nextIndex)))\n          .withDefault(this);\n      })\n      .withDefaultSupply(() => {\n        return new Menu(\n          this.elements.selectIndex(down ? 0 : this.elements.length() - 1),\n        );\n      });\n  }\n\n  indexOfItem(item: MenuItem<T>): Maybe<number> {\n    const i = this.elements.toArray().indexOf(item);\n    if (i === -1) {\n      return nothing;\n    }\n    return just(i);\n  }\n}\n\nexport type MenuElement<T> = MenuItem<T> | MenuSeparator;\n\nexport interface MenuItem<T> {\n  tag: 'item';\n  readonly userData: T;\n  readonly subMenu: Maybe<Menu<T>>;\n}\n\nexport interface MenuSeparator {\n  tag: 'separator';\n}\n\nexport function menu<T>(items: ReadonlyArray<MenuElement<T>>): Menu<T> {\n  return new Menu(ListWithSelection.fromArray(items));\n}\n\nexport function item<T>(userData: T, subMenu?: Menu<T>): MenuItem<T> {\n  return {\n    tag: 'item',\n    userData,\n    subMenu: maybeOf(subMenu),\n  };\n}\n\nexport const separator: MenuSeparator = {\n  tag: 'separator',\n};\n\nexport function menuId(uuid: string): string {\n  return `tm-${btoa(uuid)}`;\n}\n\nexport function menuItemId(menuId: string, itemIndex: number): string {\n  return `tm-item-${menuId}-${itemIndex}`;\n}\n\nexport function menuTask(uuid: string): Task<Error, HTMLElement> {\n  return byId(menuId(uuid));\n}\n\nexport function menuItemTask(\n  menuId: string,\n  itemIndex: number,\n): Task<Error, HTMLElement> {\n  return byId(menuItemId(menuId, itemIndex));\n}\n\nfunction byId(id: string): Task<Error, HTMLElement> {\n  return Task.fromLambda(() => {\n    const e = document.getElementById(id);\n    if (e === null) {\n      throw new Error('element not found with id:' + id);\n    }\n    return e;\n  });\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { pos, Pos } from './Pos';\nimport { dim, Dim } from './Dim';\n\nexport class Box {\n  constructor(readonly p: Pos, readonly d: Dim) {}\n\n  static fromDomRect(rect: DOMRect): Box {\n    const { x, y, height, width } = rect;\n    return box(pos(x, y), dim(width, height));\n  }\n\n  get topLeft(): Pos {\n    return this.p;\n  }\n\n  get bottomRight(): Pos {\n    return pos(this.right, this.bottom);\n  }\n\n  get left(): number {\n    return this.p.x;\n  }\n\n  get right() {\n    return this.left + this.d.w;\n  }\n\n  get top() {\n    return this.p.y;\n  }\n\n  get bottom() {\n    return this.top + this.d.h;\n  }\n\n  isPointInside(pos: Pos): boolean {\n    return !(\n      pos.x < this.left ||\n      pos.x > this.right ||\n      pos.y < this.top ||\n      pos.y > this.bottom\n    );\n  }\n\n  isBoxInside(box: Box): boolean {\n    return this.isPointInside(box.topLeft) && this.isPointInside(box.bottomRight);\n  }\n}\n\nexport function box(p: Pos, d: Dim): Box {\n  return new Box(p, d);\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { ListWithSelection, Maybe, nothing, Result } from 'tea-cup-core';\nimport { DropDownModel } from 'tea-pop-dropdown';\n\nexport interface Model<T> {\n  readonly uuid: Maybe<string>;\n  readonly value: string;\n  readonly ddModel: Maybe<DropDownModel>;\n  readonly items: Maybe<Result<Error, ListWithSelection<T>>>;\n  readonly fetchCount: number;\n}\n\nexport function initialModel<T>(): Model<T> {\n  return {\n    uuid: nothing,\n    value: '',\n    ddModel: nothing,\n    items: nothing,\n    fetchCount: 0,\n  };\n}\n\nexport function comboHtmlId(uuid: string): string {\n  return 'tp-cb-' + uuid;\n}\n\nexport function comboItemHtmlId(uuid: string, index: number): string {\n  return 'tp-cb-item-' + uuid + '-' + index;\n}\n\nexport function moveSelection<T>(model: Model<T>, up: boolean): Model<T> {\n  return {\n    ...model,\n    items: model.items.map((r) =>\n      r.map((items) => {\n        const nbItems = items.length();\n        const curIndex = items.getSelectedIndex().withDefault(-1);\n        const newIndex = up ? curIndex - 1 : curIndex + 1;\n        const fixed =\n          newIndex < 0 ? nbItems - 1 : newIndex >= nbItems ? 0 : newIndex;\n\n        return items.selectIndex(fixed);\n      }),\n    ),\n  };\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\ninterface Evt {\n  preventDefault(): void;\n  stopPropagation(): void;\n}\n\ntype EventHandler = (e: Evt) => void;\n\nexport const stopEvent: EventHandler = (e) => {\n  e.preventDefault();\n  e.stopPropagation();\n};\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { box, Box } from './Box';\nimport { dim, Dim } from './Dim';\nimport { pos } from './Pos';\n\nexport function place(viewport: Dim, refBox: Box, elem: Dim): Box {\n  const pX = place1DEnd(viewport.w, refBox.p.x, refBox.d.w, elem.w);\n  const pY = place1DStart(viewport.h, refBox.p.y, refBox.d.h, elem.h);\n  return box(pos(pX.offset, pY.offset), dim(pX.len, pY.len));\n}\n\nexport function placeCombo(viewport: Dim, refBox: Box, elem: Dim): Box {\n  const pX = place1DStart(viewport.w, refBox.p.x, refBox.d.w, elem.w);\n  const pY = placeComboY(viewport.h, refBox.p.y, refBox.d.h, elem.h);\n  return box(pos(pX.offset, pY.offset), dim(pX.len, pY.len));\n}\n\ninterface Placed1D {\n  readonly offset: number;\n  readonly len: number;\n}\n\nexport function place1DEnd(\n  viewportW: number,\n  refX: number,\n  refW: number,\n  elemW: number,\n): Placed1D {\n  if (refX + refW + elemW > viewportW) {\n    // not enough space after, try before\n    if (elemW < refX) {\n      // ok, prepend\n      return { offset: refX - elemW, len: elemW };\n    } else {\n      // not enough space before or after, we have to translate and/or expand !\n      if (elemW < viewportW) {\n        // can't append or prepend, but no need to shrink... translate only\n        const delta = refX + refW + elemW - viewportW;\n        return { offset: refX + refW - delta, len: elemW };\n      }\n      return { offset: 0, len: viewportW };\n    }\n  } else {\n    // enough space to append\n    return { offset: refX + refW, len: elemW };\n  }\n}\n\nexport function place1DStart(\n  viewportW: number,\n  refX: number,\n  refW: number,\n  elemW: number,\n): Placed1D {\n  if (elemW > viewportW) {\n    return { offset: 0, len: viewportW };\n  }\n  if (refX + elemW > viewportW) {\n    // not enough space after, try before\n    if (elemW < refX + refW) {\n      // ok, prepend\n      return { offset: refX + refW - elemW, len: elemW };\n    } else {\n      // not enough space before or after, we have to translate and/or expand !\n      if (elemW < viewportW) {\n        // can't append or prepend, but no need to shrink... translate only\n        const delta = refX + refW + elemW - viewportW;\n        return { offset: refX + refW - delta, len: elemW };\n      }\n      return { offset: 0, len: 10 };\n    }\n  } else {\n    // enough space to append\n    return { offset: refX, len: elemW };\n  }\n}\n\nfunction placeComboY(\n  viewportW: number,\n  refX: number,\n  refW: number,\n  elemW: number,\n): Placed1D {\n  const elemEnd = refX + refW;\n  const spaceBefore = refX;\n  const spaceAfter = viewportW - elemEnd;\n  if (elemW < spaceAfter) {\n    // enough space after, append\n    return { offset: elemEnd, len: elemW };\n  } else if (elemW < spaceBefore) {\n    // enough space before, append\n    return { offset: refX - elemW, len: elemW };\n  } else {\n    // not enough space, need to shrink\n    // use the most space\n    if (spaceBefore > spaceAfter) {\n      // place before\n      return { offset: 0, len: spaceBefore };\n    } else {\n      return { offset: elemEnd, len: spaceAfter };\n    }\n  }\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALIxNGS IN THE\n * SOFTWARE.\n *\n */\n\nimport { dim, Dim } from './Dim';\n\nexport function windowDimensions(): Dim {\n  return dim(window.innerWidth, window.innerHeight);\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport {\n  childMsg,\n  docMouseDown,\n  gotItemBox,\n  gotKeyDown,\n  gotMenuBox,\n  gotUuid,\n  gotwindowBlur,\n  gotWindowDimensions,\n  Msg,\n  noop,\n} from './Msg';\nimport {\n  Cmd,\n  just,\n  Maybe,\n  noCmd,\n  nothing,\n  Sub,\n  Task,\n  Tuple,\n  uuid,\n} from 'tea-cup-core';\nimport { initialModel, keyboardNavigated, Model } from './Model';\nimport { Menu, MenuItem, menuItemTask, menuTask } from './Menu';\nimport { dim, Dim, Box, place } from 'tea-pop-core';\nimport { OutMsg } from './OutMsg';\nimport { DocumentEvents, WindowEvents } from 'react-tea-cup';\nimport { log } from './Logger';\n\nexport function open<T>(\n  menu: Menu<T>,\n  refBox: Box,\n  selectFirst = false,\n): [Model<T>, Cmd<Msg<T>>] {\n  log('teapop', 'open', 'refBox', refBox);\n  return [\n    initialModel(\n      selectFirst ? menu.selectFirstItem() : menu.deselectAll(),\n      refBox,\n    ),\n    Cmd.batch([\n      Task.perform(getWindowDimensions, (d) => gotWindowDimensions(d)),\n      Task.perform(uuid(), (u) => gotUuid(u)),\n    ]),\n  ];\n}\n\nfunction postOpen<T>(model: Model<T>): [Model<T>, Cmd<Msg<T>>] {\n  if (model.uuid.type === 'Nothing') {\n    return noCmd(model);\n  }\n  if (model.windowSize.type === 'Nothing') {\n    return noCmd(model);\n  }\n  const cmd: Cmd<Msg<T>> = Task.attempt(\n    menuTask(model.uuid.value).map((e) => {\n      const rect = e.getBoundingClientRect();\n      const b = Box.fromDomRect(rect);\n      log('teapop', 'postOpen', 'menu box', b);\n      return b;\n    }),\n    (x) => gotMenuBox(x),\n  );\n  return [model, cmd];\n}\n\nfunction withOut<T>(\n  mac: [Model<T>, Cmd<Msg<T>>],\n  outMsg: Maybe<OutMsg<T>> = nothing,\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  return [mac[0], mac[1], outMsg];\n}\n\nexport function update<T>(\n  msg: Msg<T>,\n  model: Model<T>,\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  switch (msg.tag) {\n    case 'got-window-dimensions': {\n      if (model.state.tag === 'open') {\n        return withOut(noCmd(model), just({ tag: 'request-close' }));\n      }\n      return withOut(\n        postOpen({\n          ...model,\n          windowSize: just(msg.d),\n        }),\n      );\n    }\n    case 'window-blur': {\n      return withOut(noCmd(model), just({ tag: 'request-close' }));\n    }\n    case 'got-uuid': {\n      return withOut(\n        postOpen({\n          ...model,\n          uuid: just(msg.uuid),\n        }),\n      );\n    }\n    case 'got-menu-box': {\n      if (model.state.tag === 'placing') {\n        const state = model.state;\n        return withOut(\n          noCmd(\n            model.windowSize\n              .map((windowSize) => {\n                const newModel: Model<T> = msg.r.match(\n                  (menuBox) => {\n                    log('teapop', 'got-menu-box', 'menuBox', menuBox);\n                    const placedBox = place(\n                      windowSize,\n                      state.refBox,\n                      menuBox.d,\n                    );\n                    log('teapop', 'got-menu-box', 'placedBox', placedBox);\n                    return {\n                      ...model,\n                      state: {\n                        tag: 'open',\n                        box: placedBox,\n                      },\n                    } as Model<T>;\n                  },\n                  (err) => ({\n                    ...model,\n                    error: just(err),\n                  }),\n                );\n                return newModel;\n              })\n              .withDefault(model),\n          ),\n        );\n      }\n      log('teapop', 'got-menu-box', 'not placing');\n      return withOut(noCmd(model));\n    }\n\n    case 'key-down': {\n      switch (msg.key) {\n        case 'Escape': {\n          return withOut(\n            collapseLastSubMenu(keyboardNavigated(model)),\n            model.child.isNothing() ? just({ tag: 'request-close' }) : nothing,\n          );\n        }\n        case 'ArrowDown':\n        case 'ArrowUp': {\n          return mapLastMenu(keyboardNavigated(model), (lastModel) => {\n            return withOut(\n              noCmd({\n                ...lastModel,\n                menu: lastModel.menu.moveSelection(msg.key === 'ArrowDown'),\n              }),\n            );\n          });\n        }\n        case 'ArrowLeft':\n          return withOut(collapseLastSubMenu(keyboardNavigated(model)));\n        case 'ArrowRight':\n          return expandLastSubMenu(keyboardNavigated(model));\n        case 'Enter':\n        case ' ': {\n          return toggleOrSelectItem(model);\n        }\n        default:\n          return withOut(noCmd(model));\n      }\n    }\n    case 'mouse-move': {\n      if (model.menu.isSelected(msg.item)) {\n        return withOut(noCmd(model));\n      }\n      const newModel = { ...model, subMenuCounter: model.subMenuCounter + 1 };\n      if (model.navigatedWithKeyboard) {\n        return withOut(noCmd(keyboardNavigated(newModel, false)));\n      }\n      if (model.uuid.type === 'Nothing') {\n        return withOut(noCmd(newModel));\n      }\n      const menu = model.menu.selectItem(msg.item);\n      const uuid = model.uuid.value;\n      return withOut(\n        openSubMenu(\n          { ...newModel, menu, child: nothing },\n          uuid,\n          msg.item,\n          msg.itemIndex,\n          false,\n        ),\n      );\n    }\n    case 'mouse-leave': {\n      return withOut(\n        noCmd(\n          model.child.isJust()\n            ? model\n            : { ...model, menu: model.menu.deselectAll() },\n        ),\n      );\n    }\n    case 'got-item-box': {\n      if (msg.subMenuCounter !== model.subMenuCounter) {\n        return withOut(noCmd(model));\n      }\n      return withOut(\n        msg.r.match(\n          (itemBox) => {\n            const newModel: Model<T> = {\n              ...model,\n              menu: model.menu.selectItem(msg.item),\n            };\n            return msg.item.subMenu\n              .map((subMenu) => {\n                // we have a sub menu so we need\n                // to open a new Menu !\n                const mac = open(subMenu, itemBox, msg.selectFirst);\n                const newModel2: Model<T> = {\n                  ...newModel,\n                  child: just(mac[0]),\n                };\n                return Tuple.t2n(newModel2, mac[1].map(childMsg));\n              })\n              .withDefaultSupply(() => {\n                // close any existing child !\n                return newModel.child\n                  .map(() =>\n                    noCmd<Model<T>, Msg<T>>({ ...model, child: nothing }),\n                  )\n                  .withDefaultSupply(() => noCmd(model));\n              });\n          },\n          (err) => noCmd({ ...model, error: just(err) }),\n        ),\n      );\n    }\n    case 'child-msg': {\n      return model.child\n        .map((child) => {\n          const mco = update(msg.m, child);\n          const newModel: Model<T> = {\n            ...model,\n            child: just(mco[0]),\n          };\n          return withOut(Tuple.t2n(newModel, mco[1].map(childMsg)), mco[2]);\n        })\n        .withDefaultSupply(() => withOut(noCmd(model)));\n    }\n    case 'item-clicked': {\n      return withOut(noCmd(model), outItemSelected(msg.item));\n    }\n    case 'doc-mouse-down': {\n      return withOut(noCmd(model), just({ tag: 'request-close' }));\n    }\n    case 'noop': {\n      return withOut(noCmd(model));\n    }\n  }\n}\n\nfunction outItemSelected<T>(item: MenuItem<T>): Maybe<OutMsg<T>> {\n  return just({ tag: 'item-selected', data: item.userData });\n}\n\nfunction openSubMenu<T>(\n  model: Model<T>,\n  menuId: string,\n  item: MenuItem<T>,\n  itemIndex: number,\n  selectFirst: boolean,\n): [Model<T>, Cmd<Msg<T>>] {\n  if (item.subMenu.isNothing()) {\n    return noCmd(model);\n  }\n  const subMenuCounter = model.subMenuCounter + 1;\n  return Tuple.t2n(\n    { ...model, subMenuCounter },\n    Task.attempt(\n      menuItemTask(menuId, itemIndex).map((e) => {\n        return Box.fromDomRect(e.getBoundingClientRect());\n      }),\n      (r) => gotItemBox(item, r, subMenuCounter, selectFirst),\n    ),\n  );\n}\n\nconst windowEvents = new WindowEvents();\nconst documentEvents = new DocumentEvents();\n\nexport function subscriptions<T>(model: Model<T>): Sub<Msg<T>> {\n  return Sub.batch([\n    windowEvents.on('resize', () =>\n      gotWindowDimensions(dim(window.innerWidth, window.innerHeight)),\n    ),\n    windowEvents.on('blur', () => gotwindowBlur()),\n    documentEvents.on(\n      'mousedown',\n      (evt) => {\n        if (evt.button === 2) {\n          return noop();\n        }\n        let t: HTMLElement | null = evt.target as HTMLElement;\n        while (t) {\n          // move up and try to find if we are inside a tea-pop Menu !\n          if (t.classList.contains('tm')) {\n            return noop();\n          }\n          t = t.parentElement;\n        }\n        return docMouseDown();\n      },\n      true,\n    ),\n    model.state.tag === 'open'\n      ? documentEvents.on('keydown', (e) => gotKeyDown(e.key))\n      : Sub.none(),\n  ]);\n}\n\nconst getWindowDimensions: Task<never, Dim> = Task.succeedLazy(() =>\n  dim(window.innerWidth, window.innerHeight),\n);\n\nfunction mapLastMenu<T>(\n  model: Model<T>,\n  f: (m: Model<T>) => [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>],\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  switch (model.child.type) {\n    case 'Nothing': {\n      // I'm the last model !\n      return f(model);\n    }\n    case 'Just': {\n      const mac = mapLastMenu(model.child.value, f);\n      return [{ ...model, child: just(mac[0]) }, mac[1].map(childMsg), mac[2]];\n    }\n  }\n}\n\nfunction collapseLastSubMenu<T>(model: Model<T>): [Model<T>, Cmd<Msg<T>>] {\n  switch (model.child.type) {\n    case 'Nothing':\n      return noCmd(model);\n    case 'Just': {\n      // I have a child : close it if he has no child !\n      const child = model.child.value;\n      if (child.child.isJust()) {\n        return Tuple.fromNative(collapseLastSubMenu(child))\n          .mapFirst((c) => ({ ...model, child: just(c) }))\n          .mapSecond((cmd) => cmd.map(childMsg))\n          .toNative();\n      } else {\n        return noCmd({\n          ...model,\n          child: nothing,\n        });\n      }\n    }\n  }\n}\n\nfunction expandLastSubMenu<T>(\n  model: Model<T>,\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  return mapLastMenu(model, (lastModel) => {\n    return lastModel.menu.selectedItem\n      .map((selectedItem) => {\n        return selectedItem.subMenu\n          .map(() => {\n            if (lastModel.uuid.type === 'Nothing') {\n              return withOut(noCmd<Model<T>, Msg<T>>(lastModel));\n            }\n            const uuid = lastModel.uuid.value;\n            const mac: [Model<T>, Cmd<Msg<T>>] = lastModel.menu\n              .indexOfItem(selectedItem)\n              .map((itemIndex) => {\n                return openSubMenu(\n                  lastModel,\n                  uuid,\n                  selectedItem,\n                  itemIndex,\n                  true,\n                );\n              })\n              .withDefaultSupply(() => noCmd(lastModel));\n            return withOut(mac);\n          })\n          .withDefaultSupply(() => {\n            return withOut(noCmd(lastModel));\n          });\n      })\n      .withDefaultSupply(() => {\n        return withOut(noCmd(lastModel));\n      });\n  });\n}\n\nfunction toggleOrSelectItem<T>(\n  model: Model<T>,\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg<T>>] {\n  return mapLastMenu(model, (lastModel) => {\n    return lastModel.menu.selectedItem\n      .map((selectedItem) => {\n        if (lastModel.uuid.type === 'Nothing') {\n          return withOut(noCmd<Model<T>, Msg<T>>(lastModel));\n        }\n        const uuid = lastModel.uuid.value;\n        // do we have a sub-menu ?\n        return selectedItem.subMenu\n          .map(() => {\n            // we have a sub-menu, expand it\n            const mac: [Model<T>, Cmd<Msg<T>>] = lastModel.menu\n              .indexOfItem(selectedItem)\n              .map((itemIndex) =>\n                openSubMenu(lastModel, uuid, selectedItem, itemIndex, true),\n              )\n              .withDefaultSupply(() => noCmd(lastModel));\n            return withOut(mac);\n          })\n          .withDefaultSupply(() => {\n            // no sub-menu, select the item\n            return withOut(noCmd(lastModel), outItemSelected(selectedItem));\n          });\n      })\n      .withDefaultSupply(() => withOut(noCmd(lastModel)));\n  });\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nexport function log(...data: any[]) {\n  // @ts-ignore\n  if (window['teaPopDebug']) {\n    console.log(...data);\n  }\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport * as React from 'react';\nimport { Menu, menuId, MenuItem, menuItemId } from './Menu';\nimport { childMsg, Msg } from './Msg';\nimport { Dispatcher, map } from 'tea-cup-core';\nimport { ItemRenderer } from './ItemRenderer';\nimport { Model } from './Model';\nimport { stopEvent } from 'tea-pop-core';\n\nexport interface ViewMenuProps<T> {\n  model: Model<T>;\n  dispatch: Dispatcher<Msg<T>>;\n  renderer: ItemRenderer<T>;\n}\n\nexport function ViewMenu<T>(props: ViewMenuProps<T>): React.ReactElement {\n  const { model, dispatch, renderer } = props;\n  const { menu, state, uuid, windowSize } = model;\n  if (uuid.type === 'Nothing') {\n    return <></>;\n  }\n  if (windowSize.type === 'Nothing') {\n    return <></>;\n  }\n\n  const renderItems = () =>\n    menu.elems.map((element, index) => {\n      switch (element.tag) {\n        case 'item': {\n          return (\n            <ViewMenuItem\n              key={`item-${index}`}\n              uuid={uuid.value}\n              itemIndex={index}\n              menu={menu}\n              item={element}\n              {...props}\n            />\n          );\n        }\n        case 'separator': {\n          return <div key={`sep-${index}`} className=\"tm-separator\" />;\n        }\n      }\n    });\n\n  switch (state.tag) {\n    case 'placing': {\n      const { refBox } = state;\n      return (\n        <div\n          className=\"tm-placer\"\n          style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            bottom: 0,\n            right: 0,\n            overflow: 'hidden',\n          }}\n          onContextMenu={stopEvent}\n        >\n          <div\n            className=\"tm\"\n            id={menuId(uuid.value)}\n            style={{\n              position: 'absolute',\n              top: refBox.p.y,\n              left: refBox.p.x,\n              visibility: 'hidden',\n            }}\n            onContextMenu={stopEvent}\n          >\n            {renderItems()}\n          </div>\n        </div>\n      );\n    }\n    case 'open': {\n      const { box } = state;\n      const { p, d } = box;\n      return (\n        <>\n          <div\n            className=\"tm\"\n            id={menuId(uuid.value)}\n            style={{\n              position: 'fixed',\n              top: p.y,\n              left: p.x,\n              width: d.w,\n              height: d.h,\n            }}\n            onContextMenu={stopEvent}\n          >\n            {renderItems()}\n          </div>\n          {model.child\n            .map((child) => (\n              <ViewMenu\n                model={child}\n                dispatch={map(dispatch, childMsg)}\n                renderer={renderer}\n              />\n            ))\n            .withDefaultSupply(() => (\n              <></>\n            ))}\n        </>\n      );\n    }\n  }\n}\n\nexport interface ViewMenuItemProps<T> {\n  uuid: string;\n  itemIndex: number;\n  menu: Menu<T>;\n  item: MenuItem<T>;\n  dispatch: Dispatcher<Msg<T>>;\n  renderer: ItemRenderer<T>;\n}\n\nexport function ViewMenuItem<T>(\n  props: ViewMenuItemProps<T>,\n): React.ReactElement {\n  const { menu, item, renderer, dispatch, uuid, itemIndex } = props;\n  const selected = menu.isSelected(item);\n  return (\n    <div\n      id={menuItemId(uuid, itemIndex)}\n      onMouseMove={() => dispatch({ tag: 'mouse-move', item, itemIndex })}\n      onMouseLeave={() => dispatch({ tag: 'mouse-leave', item, itemIndex })}\n      onClick={() => {\n        dispatch({ tag: 'item-clicked', item });\n      }}\n    >\n      {renderer({\n        data: item.userData,\n        active: selected,\n        hasSubMenu: item.subMenu.isJust(),\n      })}\n    </div>\n  );\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport * as React from 'react';\n\nexport interface RendererInput<T> {\n  readonly data: T;\n  readonly active: boolean;\n  readonly hasSubMenu: boolean;\n}\n\nexport type ItemRenderer<T> = (input: RendererInput<T>) => React.ReactNode;\n\nexport function defaultItemRenderer<T>(\n  contentRenderer: (t: T) => React.ReactNode,\n): ItemRenderer<T> {\n  return (input) => {\n    const { data, active, hasSubMenu } = input;\n    const activeClass = active ? ' tm-active' : '';\n    return (\n      <div className={`tm-item${activeClass}`}>\n        <div className=\"tm-item__content\">{contentRenderer(data)}</div>\n        {hasSubMenu ? <div className=\"tm-item__submenu\">›</div> : <></>}\n      </div>\n    );\n  };\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport * as React from 'react';\nimport { Box, Dim, placeCombo, windowDimensions } from 'tea-pop-core';\nimport {\n  Cmd,\n  just,\n  Maybe,\n  noCmd,\n  nothing,\n  Result,\n  Sub,\n  Task,\n  uuid,\n} from 'tea-cup-core';\nimport { DocumentEvents } from 'react-tea-cup';\n\nexport type Model =\n  | { tag: 'fresh' }\n  | {\n      tag: 'ready';\n      initData: InitData;\n      placed: Maybe<Box>;\n    }\n  | { tag: 'error'; e: Error };\n\nfunction errorModel(e: Error): Model {\n  return {\n    tag: 'error',\n    e,\n  };\n}\n\ninterface InitData {\n  readonly refBox: Box;\n  readonly windowDimensions: Dim;\n  readonly uuid: string;\n}\n\nexport type Msg =\n  | { tag: 'got-init-data'; r: Result<Error, InitData> }\n  | { tag: 'got-rendered-box'; r: Result<Error, Box> }\n  | { tag: 'request-close' }\n  | { tag: 'noop' };\n\nfunction gotRenderedBox(r: Result<Error, Box>): Msg {\n  return {\n    tag: 'got-rendered-box',\n    r,\n  };\n}\n\nfunction gotInitData(r: Result<Error, InitData>): Msg {\n  return {\n    tag: 'got-init-data',\n    r,\n  };\n}\n\nconst noop: Msg = {\n  tag: 'noop',\n};\n\nconst requestClose: Msg = {\n  tag: 'request-close',\n};\n\nexport type Renderer = () => React.ReactNode;\n\nexport function open(getRefBox: Task<Error, Box>): [Model, Cmd<Msg>] {\n  const model: Model = {\n    tag: 'fresh',\n  };\n  const getWindowDimensions: Task<never, Dim> = Task.succeedLazy(() =>\n    windowDimensions(),\n  );\n  const getInitData: Task<Error, InitData> = getRefBox.andThen((refBox) =>\n    getWindowDimensions.andThen((windowDimensions) =>\n      uuid().map((uuid) => ({ refBox, windowDimensions, uuid })),\n    ),\n  );\n\n  const cmd: Cmd<Msg> = Task.attempt(getInitData, gotInitData);\n  return [model, cmd];\n}\n\nexport interface ViewDropDownProps {\n  readonly renderer: Renderer;\n  readonly model: Model;\n}\n\nexport function ViewDropDown(props: ViewDropDownProps): React.ReactElement {\n  const { renderer, model } = props;\n  switch (model.tag) {\n    case 'fresh': {\n      return (\n        <div\n          className=\"tm-drop-down tm-placing\"\n          style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            visibility: 'hidden',\n          }}\n        >\n          {renderer()}\n        </div>\n      );\n    }\n    case 'error': {\n      return <></>; // TODO ?\n    }\n    case 'ready': {\n      return model.placed\n        .map((placedBox) => {\n          const { p, d } = placedBox;\n          return (\n            <div\n              id={model.initData.uuid}\n              className=\"tm-drop-down tm-placed\"\n              style={{\n                position: 'fixed',\n                top: p.y,\n                left: p.x,\n                width: d.w,\n                height: d.h,\n              }}\n            >\n              {renderer()}\n            </div>\n          );\n        })\n        .withDefaultSupply(() => {\n          return (\n            <div\n              id={model.initData.uuid}\n              className=\"tm-drop-down tm-placing\"\n              style={{\n                position: 'absolute',\n                top: 0,\n                left: 0,\n                visibility: 'hidden',\n              }}\n            >\n              {renderer()}\n            </div>\n          );\n        });\n    }\n  }\n}\n\nfunction handleError(error: Error): [Model, Cmd<Msg>, RequestClose] {\n  console.error(error);\n  return withOut(noCmd(errorModel(error)));\n}\n\nexport type RequestClose = boolean;\n\nfunction withOut(\n  mac: [Model, Cmd<Msg>],\n  requestClose: RequestClose = false,\n): [Model, Cmd<Msg>, RequestClose] {\n  return [mac[0], mac[1], requestClose];\n}\n\nexport function update(\n  msg: Msg,\n  model: Model,\n): [Model, Cmd<Msg>, RequestClose] {\n  switch (msg.tag) {\n    case 'got-init-data': {\n      if (model.tag !== 'fresh') {\n        return withOut(noCmd(model));\n      }\n      return msg.r.match((initData) => {\n        const newModel: Model = {\n          tag: 'ready',\n          initData,\n          placed: nothing,\n        };\n        const cmd: Cmd<Msg> = Task.attempt(\n          getRenderedBox(initData.uuid),\n          gotRenderedBox,\n        );\n        return [newModel, cmd, false];\n      }, handleError);\n    }\n    case 'got-rendered-box': {\n      return msg.r.match((renderedBox) => {\n        if (model.tag !== 'ready') {\n          return withOut(noCmd(model));\n        }\n        const { initData } = model;\n        const { windowDimensions, refBox } = initData;\n        const placedBox = placeCombo(windowDimensions, refBox, renderedBox.d);\n        return withOut(\n          noCmd({\n            ...model,\n            placed: just(placedBox),\n          }),\n        );\n      }, handleError);\n    }\n    case 'request-close': {\n      return withOut([model, Cmd.none()], true);\n    }\n    case 'noop': {\n      return withOut(noCmd(model));\n    }\n  }\n}\n\nfunction getRenderedBox(uuid: string): Task<Error, Box> {\n  return byId(uuid).map((elem) =>\n    Box.fromDomRect(elem.getBoundingClientRect()),\n  );\n}\n\nfunction byId(id: string): Task<Error, HTMLElement> {\n  return Task.fromLambda(() => {\n    const e = document.getElementById(id);\n    if (!e) {\n      throw new Error('element not found ' + id);\n    }\n    return e;\n  });\n}\n\nconst documentEvents = new DocumentEvents();\n\nexport function subscriptions(): Sub<Msg> {\n  return Sub.batch([\n    documentEvents.on('keydown', (e) =>\n      e.key === 'Escape' ? requestClose : noop,\n    ),\n    documentEvents.on('mousedown', (evt) => {\n      let t: HTMLElement | null = evt.target as HTMLElement;\n      while (t) {\n        // move up and try to find if we are inside a tea-pop DD !\n        if (t.classList.contains('tm-drop-down')) {\n          return noop;\n        }\n        t = t.parentElement;\n      }\n      return requestClose;\n    }),\n  ]);\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport {\n  Cmd,\n  just,\n  ListWithSelection,\n  Maybe,\n  noCmd,\n  nothing,\n  Sub,\n  Task,\n  Tuple,\n  updatePiped,\n  uuid,\n} from 'tea-cup-core';\nimport { Box } from 'tea-pop-core';\nimport { dropDownOpen, dropDownUpdate } from 'tea-pop-dropdown';\nimport { Provider } from './Provider';\nimport {\n  comboHtmlId,\n  comboItemHtmlId,\n  initialModel,\n  Model,\n  moveSelection,\n} from './Model';\nimport { dropDownMsg, gotItems, inputFocused, Msg, noOp } from './Msg';\nimport { OutMsg } from './OutMsg';\n\nexport function init<T>(): [Model<T>, Cmd<Msg<T>>] {\n  const uuidCmd: Cmd<Msg<T>> = Task.perform(uuid(), (uuid: string) => ({\n    tag: 'got-uuid',\n    uuid,\n  }));\n\n  const model = initialModel<T>();\n  return [model, uuidCmd];\n}\n\nfunction fetchFromProvider<T>(\n  model: Model<T>,\n  provider: Provider<T>,\n): [Model<T>, Cmd<Msg<T>>] {\n  const newFetchCount = model.fetchCount + 1;\n  const newModel: Model<T> = {\n    ...model,\n    fetchCount: newFetchCount,\n  };\n  return Tuple.t2n(\n    newModel,\n    Task.attempt(provider.fetchItems(model.value), (res) =>\n      gotItems(res, newFetchCount),\n    ),\n  );\n}\n\nfunction withOut<T>(\n  model: Model<T>,\n  mac: [Model<T>, Cmd<Msg<T>>],\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg>] {\n  return [\n    mac[0],\n    mac[1],\n    model.value === mac[0].value ? nothing : just(mac[0].value),\n  ];\n}\n\nexport function update<T>(\n  provider: Provider<T>,\n  msg: Msg<T>,\n  model: Model<T>,\n): [Model<T>, Cmd<Msg<T>>, Maybe<OutMsg>] {\n  switch (msg.tag) {\n    case 'got-uuid': {\n      return withOut(model, noCmd({ ...model, uuid: just(msg.uuid) }));\n    }\n    case 'input-value-changed': {\n      const newModel: Model<T> = {\n        ...model,\n        value: msg.value,\n      };\n      return withOut(model, fetchFromProvider(newModel, provider));\n    }\n    case 'trigger-clicked': {\n      return withOut(model, triggerClicked(model, provider));\n    }\n    case 'dd-msg': {\n      return withOut(\n        model,\n        model.ddModel\n          .map((ddModel) => {\n            const ddMac = dropDownUpdate(msg.child, ddModel);\n            if (ddMac[2]) {\n              return noCmd<Model<T>, Msg<T>>({\n                ...model,\n                ddModel: nothing,\n              });\n            }\n            const newModel: Model<T> = {\n              ...model,\n              ddModel: just(ddMac[0]),\n            };\n            return Tuple.t2n(\n              newModel,\n              ddMac[1].map((x) => dropDownMsg<T>(x)),\n            );\n          })\n          .withDefaultSupply(() => noCmd(model)),\n      );\n    }\n    case 'input-blurred': {\n      return withOut(model, closeCombo(model));\n    }\n    case 'input-focused': {\n      return withOut(model, noCmd(model));\n    }\n    case 'input-key-down': {\n      switch (msg.key) {\n        case 'Escape': {\n          return withOut(model, closeCombo(model));\n        }\n        case 'Enter': {\n          return withOut(\n            model,\n            model.items\n              .andThen((i) => i.toMaybe())\n              .andThen((items) => items.getSelected())\n              .map((item) => selectItem(model, provider, item))\n              .withDefaultSupply(() => noCmd(model)),\n          );\n        }\n        case 'ArrowUp': {\n          return withOut(model, handleArrowKey(model, provider, true));\n        }\n        case 'ArrowDown': {\n          return withOut(model, handleArrowKey(model, provider, false));\n        }\n        default: {\n          return withOut(model, noCmd(model));\n        }\n      }\n    }\n    case 'got-items-from-provider': {\n      // ignore if fetch count has changed\n      if (msg.fetchCount !== model.fetchCount) {\n        return withOut(model, noCmd(model));\n      }\n      const newModel: Model<T> = {\n        ...model,\n        items: just(msg.res.map(ListWithSelection.fromArray)),\n      };\n      // re-trigger if we are open\n      return withOut(\n        model,\n        model.ddModel\n          .map(() => triggerCombo(newModel))\n          .withDefaultSupply(() => noCmd(model)),\n      );\n    }\n    case 'item-clicked': {\n      return withOut(model, selectItem(model, provider, msg.item));\n    }\n    case 'noop': {\n      return withOut(model, noCmd(model));\n    }\n  }\n}\n\nexport function subscriptions<T>(\n  model: Model<T>, // eslint-disable-line\n): Sub<Msg<T>> {\n  return Sub.none();\n}\n\nfunction selectItem<T>(\n  model: Model<T>,\n  provider: Provider<T>,\n  item: T,\n): [Model<T>, Cmd<Msg<T>>] {\n  const newModel: Model<T> = {\n    ...model,\n    value: provider.itemToString(item),\n  };\n  return updatePiped(newModel, closeCombo, (model) =>\n    Tuple.t2n(model, focusInputCmd(model)),\n  );\n}\n\nfunction triggerCombo<T>(model: Model<T>): [Model<T>, Cmd<Msg<T>>] {\n  return model.uuid\n    .map((uuid) => {\n      const refBoxTask: Task<Error, Box> = Task.fromLambda(() => {\n        const e = document.getElementById(comboHtmlId(uuid));\n        if (!e) {\n          throw new Error('input element not found');\n        }\n        return Box.fromDomRect(e.getBoundingClientRect());\n      });\n\n      const ddMac = dropDownOpen(refBoxTask);\n      const newModel: Model<T> = {\n        ...model,\n        ddModel: just(ddMac[0]),\n      };\n      const ddCmd: Cmd<Msg<T>> = ddMac[1].map((x) => dropDownMsg<T>(x));\n\n      return Tuple.t2n(newModel, Cmd.batch([ddCmd, focusInputCmd(model)]));\n    })\n    .withDefaultSupply(() => noCmd(model));\n}\n\nfunction closeCombo<T>(model: Model<T>): [Model<T>, Cmd<Msg<T>>] {\n  const newModel: Model<T> = {\n    ...model,\n    ddModel: nothing,\n    fetchCount: model.fetchCount + 1,\n  };\n  return noCmd(newModel);\n}\n\nfunction focusInputCmd<T>(model: Model<T>): Cmd<Msg<T>> {\n  return model.uuid\n    .map((uuid) =>\n      Task.attempt(\n        inputByUuid(uuid).map((e) => {\n          e.focus();\n          return e;\n        }),\n        (r) => inputFocused<T>(r),\n      ),\n    )\n    .withDefaultSupply(() => Cmd.none());\n}\n\nfunction inputByUuid(uuid: string): Task<Error, HTMLElement> {\n  return byId(comboHtmlId(uuid));\n}\n\nfunction byId(id: string): Task<Error, HTMLElement> {\n  return Task.fromLambda(() => {\n    const e = document.getElementById(id);\n    if (!e) {\n      throw new Error('input element not found');\n    }\n    return e;\n  });\n}\n\nfunction triggerClicked<T>(\n  model: Model<T>,\n  provider: Provider<T>,\n): [Model<T>, Cmd<Msg<T>>] {\n  const newModel: Model<T> = {\n    ...model,\n    items: nothing,\n  };\n  return updatePiped(\n    newModel,\n    (model) => closeCombo(model),\n    (model) => fetchFromProvider(model, provider),\n    (model) => triggerCombo(model),\n  );\n}\n\nfunction handleArrowKey<T>(\n  model: Model<T>,\n  provider: Provider<T>,\n  isUp: boolean,\n): [Model<T>, Cmd<Msg<T>>] {\n  // trigger if closed\n  return model.ddModel\n    .andThen(() =>\n      // already open, just move selection\n      model.uuid.map((uuid) => {\n        const newModel: Model<T> = moveSelection(model, isUp);\n        const selectedIndex = newModel.items\n          .andThen((x) => x.toMaybe())\n          .andThen((items) => items.getSelectedIndex());\n\n        const scrollCmd: Cmd<Msg<T>> = selectedIndex\n          .map((selIndex) => {\n            const scrollIntoViewTask = byId(\n              comboItemHtmlId(uuid, selIndex),\n            ).map((e) => {\n              e.scrollIntoView(false);\n              return true;\n            });\n\n            return Task.attempt<Error, boolean, Msg<T>>(\n              scrollIntoViewTask,\n              () => noOp(),\n            );\n          })\n          .withDefaultSupply(() => Cmd.none());\n        return Tuple.t2n(newModel, scrollCmd);\n      }),\n    )\n    .withDefaultSupply(() => {\n      // not triggered, trigger and select first\n      return triggerClicked(model, provider);\n    });\n}\n","/*\n * MIT License\n *\n * Copyright (c) 2020 Rémi Van Keisbelck\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\n\nimport * as React from 'react';\nimport { Dispatcher } from 'tea-cup-core';\nimport { ViewDropDown } from 'tea-pop-dropdown';\nimport { Renderer } from './Renderer';\nimport { comboHtmlId, comboItemHtmlId, Model } from './Model';\nimport { Msg } from './Msg';\n\nexport interface ViewComboBoxProps<T> {\n  model: Model<T>;\n  dispatch: Dispatcher<Msg<T>>;\n  renderer: Renderer<T>;\n}\n\nexport function ViewComboBox<T>(\n  props: ViewComboBoxProps<T>,\n): React.ReactElement {\n  const { model, dispatch, renderer } = props;\n  const { value } = model;\n  return model.uuid\n    .map((uuid) => (\n      <div className=\"tp-combobox\">\n        {renderer.renderInput({\n          id: comboHtmlId(uuid),\n          value,\n          onChange: (value) =>\n            dispatch({\n              tag: 'input-value-changed',\n              value,\n            }),\n          onBlur: () =>\n            dispatch({\n              tag: 'input-blurred',\n            }),\n          onKeyDown: (key) =>\n            dispatch({\n              tag: 'input-key-down',\n              key,\n            }),\n          onTriggerClick: () =>\n            dispatch({\n              tag: 'trigger-clicked',\n            }),\n        })}\n        {model.ddModel\n          .map((ddModel) => (\n            <ViewDropDown\n              model={ddModel}\n              renderer={() => {\n                const renderItem = (item: T, index: number) => {\n                  const selected = model.items\n                    .andThen((r) => r.toMaybe())\n                    .andThen((l) => l.getSelectedIndex())\n                    .map((selIndex) => selIndex === index)\n                    .withDefault(false);\n                  const classes = ['tp-combobox-item'].concat(\n                    selected ? ['tp-selected'] : [],\n                  );\n                  return (\n                    <div\n                      id={comboItemHtmlId(uuid, index)}\n                      key={index}\n                      className={classes.join(' ')}\n                      onMouseDown={() =>\n                        dispatch({\n                          tag: 'item-clicked',\n                          item,\n                        })\n                      }\n                    >\n                      {renderer.renderItem({\n                        item,\n                        index,\n                        value,\n                      })}\n                    </div>\n                  );\n                };\n\n                return (\n                  <div className=\"tp-combobox-items\">\n                    {model.items\n                      .map((res) =>\n                        res.match(\n                          (items) =>\n                            items.length() === 0 ? (\n                              <div className=\"tp-combobox-no-matches\">\n                                {renderer.renderNoMatches()}\n                              </div>\n                            ) : (\n                              <>{items.toArray().map(renderItem)}</>\n                            ),\n                          (err) => {\n                            return (\n                              <div className=\"tp-combo-error\">\n                                {err.message}\n                              </div>\n                            );\n                          },\n                        ),\n                      )\n                      .withDefaultSupply(() => {\n                        // we are loading items...\n                        return (\n                          <div className=\"tp-combobox-loading\">\n                            {renderer.renderLoading()}\n                          </div>\n                        );\n                      })}\n                  </div>\n                );\n              }}\n            />\n          ))\n          .withDefault(<></>)}\n      </div>\n    ))\n    .withDefault(<></>);\n}\n","import {MenuPageMsg} from \"./menu-page/MenuPageMsg\";\nimport {DropDownPageMsg} from \"./dropdown-page/DropDownPageMsg\";\nimport {PlacementPageMsg} from \"./placement-page/PlacementPageMsg\";\nimport {Route} from \"./routes\";\nimport { ComboPageMsg } from \"./combo-page/ComboPageMsg\";\n\nexport type Msg =\n    | { tag: 'url-change'; l: Location }\n    | { tag: 'menu-page-msg'; msg: MenuPageMsg }\n    | { tag: 'dd-page-msg', msg: DropDownPageMsg }\n    | { tag: 'placement-page-msg', msg: PlacementPageMsg }\n    | { tag: 'combo-page-msg', msg: ComboPageMsg }\n    | { tag: 'navigate', route: Route }\n    | { tag: 'noop' }\n\nexport const noop: Msg = { tag: \"noop\" }\n\n\nexport function navigate(route: Route): Msg {\n  return {\n    tag: \"navigate\",\n    route\n  }\n}\n\nexport function menuPageMsg(msg: MenuPageMsg): Msg {\n  return {\n    tag: 'menu-page-msg',\n    msg\n  }\n}\n\nexport function dropDownPageMsg(msg: DropDownPageMsg): Msg {\n  return {\n    tag: \"dd-page-msg\",\n    msg\n  }\n}\n\nexport function placementPageMsg(msg: PlacementPageMsg): Msg {\n  return {\n    tag: \"placement-page-msg\",\n    msg\n  }\n}\n\nexport function comboPageMsg(msg: ComboPageMsg): Msg {\n  return {\n    tag: \"combo-page-msg\",\n    msg\n  }\n}\n\n","import {newUrl, route0, route1, Router, str} from \"react-tea-cup\";\nimport {Msg, noop} from \"./Msg\";\nimport {Cmd, Task} from \"tea-cup-core\";\n\nexport type Route = 'home' | 'menu' | 'dropdown' | 'placement' | \"combo\"\n\nexport const router: Router<Route> = new Router<Route>(\n    route0.map(() => 'home'),\n    route1(str(\"menu\")).map(() => 'menu'),\n    route1(str(\"dropdown\")).map(() => 'dropdown'),\n    route1(str(\"placement\")).map(() => 'placement'),\n    route1(str(\"combo\")).map(() => 'combo'),\n)\n\nexport function routeToUrl(route: Route): string {\n  switch (route) {\n    case \"home\": {\n      return \"/\";\n    }\n    default:\n      return \"/\" + route;\n  }\n}\n\nexport function navigateTo(route: Route): Cmd<Msg> {\n  return Task.perform(\n    newUrl(routeToUrl(route)),\n      () => noop\n  );\n}\n","import {Msg as MenuMsg} from \"tea-pop-menu\";\nimport {Pos} from \"tea-pop-core\";\n\nexport type MyMenuMsg = MenuMsg<string>\n\nexport type MenuPageMsg =\n    | { tag: 'menu-msg', msg: MyMenuMsg }\n    | { tag: 'mouse-move', pos: Pos }\n    | { tag: 'mouse-down', button: number }\n    | { tag: 'key-down', key: string }\n\nexport function menuMsg(msg: MyMenuMsg): MenuPageMsg {\n  return {\n    tag: \"menu-msg\",\n    msg\n  }\n}\n\nexport function onMouseMove(pos: Pos): MenuPageMsg {\n  return {\n    tag: \"mouse-move\", pos\n  }\n}\n\nexport function onKeyDown(key: string): MenuPageMsg {\n  return {\n    tag: \"key-down\", key\n  }\n}\n","import * as React from 'react';\nimport {Dispatcher, map} from \"tea-cup-core\";\nimport {MenuPage} from \"./MenuPage\";\nimport {stopEvent} from \"tea-pop-core\";\nimport {defaultItemRenderer, ViewMenu} from \"tea-pop-menu\";\nimport {menuMsg, MenuPageMsg} from \"./MenuPageMsg\";\n\nconst MyRenderer = defaultItemRenderer((s: string) => <span>{s}</span>);\n\nexport function viewMenuPage(dispatch: Dispatcher<MenuPageMsg>, page: MenuPage) {\n  return (\n      <div className=\"demo-menu\"\n           onContextMenu={stopEvent}\n           onMouseDown={e => dispatch({tag: 'mouse-down', button: e.button})}\n      >\n        <div className=\"demo-content\">\n          {page.menuModel\n              .map(() => <span>Menu is open</span>)\n              .withDefaultSupply(() =>\n                  page.lastClicked\n                      .map(lastClicked => <span>You selected <em>{lastClicked}</em></span>)\n                      .withDefaultSupply(() =>\n                          <>\n                            <div className=\"stuff\">Right-click anywhere, or use the <code>≣</code> key.</div>\n                          </>\n                      )\n              )\n          }\n          {page.menuModel\n              .map(menuModel =>\n                  <ViewMenu\n                      model={menuModel}\n                      dispatch={map(dispatch, menuMsg)}\n                      renderer={MyRenderer}\n                  />\n              )\n              .withDefault(<></>)\n          }\n        </div>\n      </div>\n  )\n}\n","// just to avoid too much typing\nimport {item, menu, Menu, Model as MenuModel, separator} from \"tea-pop-menu\";\nimport {Maybe} from \"tea-cup-core\";\nimport {Pos} from \"tea-pop-core\";\n\nexport type MyMenuModel = MenuModel<string>\n\nexport interface MenuPage {\n  tag: 'menu';\n  readonly mousePos: Pos;\n  // ref to the tea-pop model\n  readonly menuModel: Maybe<MyMenuModel>;\n  // keep last clicked item\n  readonly lastClicked: Maybe<string>;\n}\n\nexport const mySubMenu2: Menu<string> = menu([\n  item(\"Try\"),\n  item(\"Finally\")\n])\n\nexport const mySubMenu1: Menu<string> = menu([\n  item(\"Do this\"),\n  item(\"Do that\"),\n  separator,\n  item(\"Another sub menu...\", mySubMenu2)\n])\n\nexport const myMenu: Menu<string> = menu([\n  item(\"Yalla\", mySubMenu1),\n  separator,\n  item(\"Copy\"),\n  item(\"Cut\"),\n  item(\"Paste\"),\n  separator,\n  item(\"I am a bit longer\")\n]);\n","import {MenuPage, myMenu, MyMenuModel} from \"./MenuPage\";\nimport {menuMsg, MenuPageMsg, MyMenuMsg, onKeyDown, onMouseMove} from \"./MenuPageMsg\";\nimport {Cmd, just, Maybe, noCmd, nothing, Sub, Tuple} from \"tea-cup-core\";\nimport {\n  open as menuOpen,\n  OutMsg as MenuOutMsg,\n  subscriptions as menuSubscriptions,\n  update as menuUpdate\n} from \"tea-pop-menu\";\nimport {box, Dim, pos, Pos} from \"tea-pop-core\";\nimport {DocumentEvents} from \"react-tea-cup\";\n\n\nexport function menuPageInit(): [MenuPage, Cmd<MenuPageMsg>] {\n  return noCmd({\n    tag: \"menu\",\n    mousePos: Pos.origin,\n    lastClicked: nothing,\n    menuModel: nothing,\n  })\n}\n\nexport function menuPageUpdate(msg: MenuPageMsg, menuPage: MenuPage): [MenuPage, Cmd<MenuPageMsg>] {\n  switch (msg.tag) {\n    case \"menu-msg\": {\n      return menuPage.menuModel\n          .map(menuModel => {\n            const mco = menuUpdate(msg.msg, menuModel);\n            const newMenuPage: MenuPage = {\n              ...menuPage,\n              menuModel: just(mco[0])\n            };\n            const cmd: Cmd<MenuPageMsg> = mco[1].map(menuMsg);\n            const outMsg: Maybe<MenuOutMsg<string>> = mco[2];\n            return outMsg\n                // eslint-disable-next-line array-callback-return\n                .map(out => {\n                  switch (out.tag) {\n                    case \"request-close\": {\n                      const mac2 = closeMenu(newMenuPage);\n                      return Tuple.fromNative(mac2).mapSecond(c => Cmd.batch([cmd, c])).toNative();\n                    }\n                    case \"item-selected\": {\n                      const mac2 = closeMenu(newMenuPage, just(out.data));\n                      return Tuple.fromNative(mac2).mapSecond(c => Cmd.batch([cmd, c])).toNative();\n                    }\n                  }\n                })\n                .withDefaultSupply(() => Tuple.t2n(newMenuPage, cmd));\n          })\n          .withDefaultSupply(() => noCmd(menuPage));\n    }\n    case \"mouse-down\": {\n      // open menu on right click\n      if (msg.button === 2) {\n        return updateMenu(menuPage, menuOpen(myMenu, box(menuPage.mousePos, Dim.zero)));\n      }\n      return noCmd(menuPage);\n    }\n    case \"mouse-move\": {\n      return noCmd({...menuPage, mousePos: msg.pos });\n    }\n    case \"key-down\": {\n      // open menu on context menu key\n      if (msg.key === 'ContextMenu') {\n        return updateMenu(menuPage, menuOpen(myMenu, box(menuPage.mousePos, Dim.zero)));\n      }\n      return noCmd(menuPage);\n    }\n  }\n}\n\nconst documentEvents = new DocumentEvents();\n\nexport function menuPageSubs(page: MenuPage): Sub<MenuPageMsg> {\n  // the menu's subs\n  const menuSub: Sub<MenuPageMsg> = page.menuModel\n      .map(mm => menuSubscriptions(mm).map(menuMsg))\n      .withDefaultSupply(() => Sub.none());\n  // mouse & key subs\n  const mouseMove: Sub<MenuPageMsg> = documentEvents.on('mousemove', e => onMouseMove(pos(e.clientX, e.clientY)));\n  const keyDown: Sub<MenuPageMsg> = documentEvents.on('keydown', e => onKeyDown(e.key));\n\n  return Sub.batch([menuSub, mouseMove, keyDown]);\n}\n\nfunction updateMenu(page: MenuPage, mac: [MyMenuModel, Cmd<MyMenuMsg>]): [MenuPage, Cmd<MenuPageMsg>] {\n  return Tuple.fromNative(mac)\n      .mapFirst(mm => {\n        const newPage: MenuPage = {\n          ...page,\n          menuModel: just(mm)\n        }\n        return newPage;\n        // } ({...model, page: left({ ...mainPage, menuModel: just(mm)}})))\n      })\n      .mapSecond(mc => mc.map(menuMsg))\n      .toNative();\n}\n\nfunction closeMenu(menuPage: MenuPage, lastClicked: Maybe<string> = nothing): [MenuPage, Cmd<MenuPageMsg>] {\n  return noCmd({\n    ...menuPage,\n    menuModel: nothing,\n    lastClicked\n  })\n}\n\n","import {Box, Dim} from \"tea-pop-core\";\nimport {DropDownMsg} from \"tea-pop-dropdown\";\n\nexport type DropDownPageMsg =\n    | { tag: \"button-clicked\", index: number; b: Box }\n    | { tag: \"dd-msg\", msg: DropDownMsg }\n    | { tag: 'got-window-dimensions', d: Dim }\n\nexport function ddMsg(msg: DropDownMsg): DropDownPageMsg {\n  return {\n    tag: \"dd-msg\",\n    msg,\n  }\n}\n\nexport function gotWindowDimensions(d: Dim): DropDownPageMsg {\n  return {\n    tag: \"got-window-dimensions\",\n    d\n  }\n}\n\n","import {DropDownPage} from \"./DropDownPage\";\nimport {ddMsg, DropDownPageMsg, gotWindowDimensions} from \"./DropDownPageMsg\";\nimport {Cmd, just, noCmd, nothing, Sub, Task, Tuple} from \"tea-cup-core\";\nimport {\n  DropDownModel,\n  DropDownMsg,\n  dropDownOpen,\n  DropDownRequestClose,\n  dropDownSubscriptions,\n  dropDownUpdate\n} from \"tea-pop-dropdown\";\nimport {Dim, dim, windowDimensions} from \"tea-pop-core\";\nimport {WindowEvents} from \"react-tea-cup\";\n\nexport function dropDownPageInit(): [DropDownPage, Cmd<DropDownPageMsg>] {\n  const getWindowDimensions: Task<never, Dim> = Task.succeedLazy(() =>\n      windowDimensions(),\n  );\n  const page: DropDownPage = {\n    tag: \"drop-down-page\",\n    viewportDim: nothing,\n    indexAndModel: nothing,\n  }\n  return Tuple.t2n(page, Task.perform(getWindowDimensions, gotWindowDimensions));\n}\n\nexport function dropDownPageUpdate(msg: DropDownPageMsg, ddPage: DropDownPage): [DropDownPage, Cmd<DropDownPageMsg>] {\n  switch (msg.tag) {\n    case \"button-clicked\": {\n      const ddMac: [DropDownModel, Cmd<DropDownMsg>] = dropDownOpen(Task.succeed(msg.b));\n      const newPage: DropDownPage = {\n        ...ddPage,\n        indexAndModel: just(new Tuple(msg.index, ddMac[0]))\n      };\n      return Tuple.t2n(\n          newPage,\n          ddMac[1].map(ddMsg)\n      );\n    }\n    case \"dd-msg\": {\n      return ddPage.indexAndModel\n          .map(iam => {\n            const ddMac: [DropDownModel, Cmd<DropDownMsg>, DropDownRequestClose] = dropDownUpdate(msg.msg, iam.b);\n            if (ddMac[2]) {\n              // close requested\n              const newPage: DropDownPage = {\n                ...ddPage,\n                  indexAndModel: nothing,\n              };\n              return noCmd<DropDownPage, DropDownPageMsg>(newPage);\n            }\n            const res: [DropDownPage, Cmd<DropDownPageMsg>] = Tuple.fromNative([ddMac[0], ddMac[1]])\n                .mapFirst(ddModel => ({\n                    ...ddPage,\n                    indexAndModel: ddPage.indexAndModel.map(t => new Tuple(t.a, ddModel))\n                  }))\n                .mapSecond(c => c.map(ddMsg))\n                .toNative();\n            return res;\n          })\n          .withDefaultSupply(() => noCmd(ddPage));\n    }\n    case \"got-window-dimensions\": {\n      return noCmd({\n        ...ddPage,\n        viewportDim: just(msg.d)\n      });\n    }\n  }\n}\n\nconst windowEvents = new WindowEvents();\n\nexport function dropDownPageSubs(): Sub<DropDownPageMsg> {\n  return Sub.batch([\n    dropDownSubscriptions().map(ddMsg),\n    windowEvents.on('resize', () => gotWindowDimensions(dim(window.innerWidth, window.innerHeight)))\n  ]);\n}\n\n","import {Dim, Pos} from \"tea-pop-core\";\n\nexport type PlacementPageMsg =\n    | { tag: 'got-window-dimensions', d: Dim }\n    | { tag: 'mouse-move', pos: Pos }\n    | { tag: 'key-down', key: string }\n\nexport function gotWindowDimensions(d: Dim): PlacementPageMsg {\n  return {\n    tag: \"got-window-dimensions\",\n    d\n  }\n}\n\nexport function onMouseMove(pos: Pos): PlacementPageMsg {\n  return {\n    tag: \"mouse-move\", pos\n  }\n}\n\nexport function onKeyDown(key: string): PlacementPageMsg {\n  return {\n    tag: \"key-down\", key\n  }\n}\n","import {PlacementPage} from \"./PlacementPage\";\nimport {gotWindowDimensions, onKeyDown, onMouseMove, PlacementPageMsg} from \"./PlacementPageMsg\";\nimport {Cmd, just, noCmd, nothing, Sub, Task, Tuple} from \"tea-cup-core\";\nimport {dim, Pos, pos} from \"tea-pop-core\";\nimport {DocumentEvents, WindowEvents} from \"react-tea-cup\";\n\nexport function placementPageInit(): [PlacementPage, Cmd<PlacementPageMsg>] {\n  const pp: PlacementPage = {\n    tag: \"placement-page\",\n    viewportDim: nothing,\n    mode: \"menu\",\n    mousePos: Pos.origin\n  }\n  const cmd: Cmd<PlacementPageMsg> = Task.perform(\n      Task.succeedLazy(() => dim(window.innerWidth, window.innerHeight)),\n      gotWindowDimensions\n  );\n  return Tuple.t2n(pp, cmd);\n}\n\nexport function placementPageUpdate(msg: PlacementPageMsg, page: PlacementPage): [PlacementPage, Cmd<PlacementPageMsg>] {\n  switch (msg.tag) {\n    case \"got-window-dimensions\": {\n      return noCmd({\n        ...page,\n        viewportDim: just(msg.d)\n      });\n    }\n    case \"key-down\": {\n      return noCmd(\n          msg.key === \"m\"\n            ? { ...page, mode: page.mode === \"menu\" ? \"drop-down\" : \"menu\" }\n            : page\n      );\n    }\n    case \"mouse-move\": {\n      return noCmd({...page, mousePos: msg.pos})\n    }\n  }\n}\n\nconst documentEvents = new DocumentEvents();\nconst windowEvents = new WindowEvents();\n\nexport function placementPageSubs(): Sub<PlacementPageMsg> {\n  const mouseMove: Sub<PlacementPageMsg> = documentEvents.on('mousemove', e => onMouseMove(pos(e.pageX, e.pageY)));\n  const keyDown: Sub<PlacementPageMsg> = documentEvents.on('keydown', e => onKeyDown(e.key));\n  return Sub.batch([\n    mouseMove,\n    keyDown,\n    windowEvents.on('resize', e => gotWindowDimensions(dim(window.innerWidth, window.innerHeight)))\n  ])\n}\n","import { ComboBoxMsg } from \"tea-pop-combobox\";\n\nexport type ComboPageMsg = \n    | { tag: \"tea-pop-combobox-msg\", child: ComboBoxMsg<any> }\n\nexport function comboBoxMsg(child: ComboBoxMsg<any>): ComboPageMsg {\n    return {\n        tag: \"tea-pop-combobox-msg\",\n        child\n    }\n}    ","import { Cmd, Sub, Task } from \"tea-cup-core\";\nimport { comboBoxInit, ComboBoxProvider, comboBoxSubscriptions, comboBoxUpdate } from \"tea-pop-combobox\";\nimport { ComboPage } from \"./ComboPage\";\nimport { comboBoxMsg, ComboPageMsg } from \"./ComboPageMsg\";\n\nconst myItems: string[] = [];\nfor (let i = 0 ; i < 100 ; i++) {\n    myItems.push(\"i\" + i + \" is my item \" + i)\n}\n\nclass MyProvider implements ComboBoxProvider<string> {\n    itemToString(item: string): string {\n        return item;\n    }\n    fetchItems(value: string): Task<Error, ReadonlyArray<string>> {\n        return Task.succeedLazy(() => {\n            console.log(\"provider \" + value);\n            return value === \"\"\n                ? myItems\n                : myItems.filter(x => x.indexOf(value) !== -1)\n        })\n    }\n}\n\nconst myProvider = new MyProvider();\n\nexport function comboPageInit(): [ComboPage, Cmd<ComboPageMsg>] {\n    const mac = comboBoxInit<string>();\n    const page: ComboPage = {\n        tag: \"combo-page\",\n        comboModel: mac[0]\n    }\n    return [page, mac[1].map(comboBoxMsg)]\n}\n\nexport function comboPageUpdate(msg: ComboPageMsg, model: ComboPage): [ComboPage, Cmd<ComboPageMsg>] {\n    switch (msg.tag) {\n        case \"tea-pop-combobox-msg\": {\n            const maco = comboBoxUpdate(myProvider, msg.child, model.comboModel)\n            maco[2].forEach(out => {\n                console.log(\"out\", out)\n            })\n            // TODO handle out\n            const newModel: ComboPage = {\n                ...model,\n                comboModel: maco[0]\n            };\n            return [newModel, maco[1].map(comboBoxMsg)];\n        }\n    }\n}\n\nexport function comboPageSubs(model: ComboPage): Sub<ComboPageMsg> {\n    return comboBoxSubscriptions(model.comboModel).map(comboBoxMsg);\n}\n","import * as React from 'react';\nimport {Dispatcher, map} from \"tea-cup-core\";\nimport {ComboPage} from './ComboPage';\nimport {comboBoxMsg, ComboPageMsg} from './ComboPageMsg';\nimport {ComboBoxRenderer, ComboBoxRenderItemProps, ViewComboBox} from 'tea-pop-combobox';\nimport {ComboBoxRenderInputProps} from \"../../../combobox/src\";\n\nclass MyComboRenderer implements ComboBoxRenderer<string> {\n    renderItem(props: ComboBoxRenderItemProps<string>): React.ReactElement {\n        return (\n            <div className=\"my-item\">\n                {props.item}\n            </div>\n        )\n    }\n\n    renderLoading(): React.ReactElement {\n        return <div>Loading...</div>\n    }\n\n    renderNoMatches(): React.ReactElement {\n        return <div>No matches !</div>\n    }\n\n    renderInput(props: ComboBoxRenderInputProps<string>): React.ReactElement {\n        return (\n            <div className={\"my-cb-input\"}>\n                <input\n                    id={props.id}\n                    value={props.value}\n                    onChange={(e) => {\n                        const value = e.target.value;\n                        props.onChange(value);\n                    }}\n                    onBlur={() =>\n                        props.onBlur()\n                    }\n                    onKeyDown={(e) =>\n                        props.onKeyDown(e.key)\n                    }\n                />\n                <button\n                    onClick={() =>\n                        props.onTriggerClick()\n                    }\n                >\n                  ⌄\n                </button>\n            </div>\n        )\n    }\n\n}\n\nexport function viewComboPage(dispatch: Dispatcher<ComboPageMsg>, page: ComboPage) {\n    return (\n        <div className=\"combo-page\">\n            <h1>ComboBox sample</h1>\n            <ViewComboBox\n                dispatch={map(dispatch, comboBoxMsg)}\n                model={page.comboModel}\n                renderer={new MyComboRenderer()}\n            />\n        </div>\n    )\n}\n","import * as React from \"react\";\nimport {Cmd, Dispatcher, map, noCmd, Sub, Task, Tuple} from \"tea-cup-core\";\nimport {homeModel, Model, Page} from \"./Model\";\nimport {comboPageMsg, dropDownPageMsg, menuPageMsg, Msg, navigate, noop, placementPageMsg} from \"./Msg\";\nimport {Route, router, routeToUrl} from \"./routes\";\nimport {viewMenuPage} from \"./menu-page/ViewMenuPage\";\nimport {menuPageInit, menuPageSubs, menuPageUpdate} from \"./menu-page/Update\";\n\nimport './App.scss';\nimport {viewDropDownPage} from \"./dropdown-page/ViewDropDownPage\";\nimport {dropDownPageInit, dropDownPageSubs, dropDownPageUpdate} from \"./dropdown-page/Update\";\nimport {placementPageInit, placementPageSubs, placementPageUpdate} from \"./placement-page/Update\";\nimport {viewPlacementPage} from \"./placement-page/ViewPlacementPage\";\nimport {DevTools, newUrl, ProgramWithNav} from \"react-tea-cup\";\nimport { comboPageInit, comboPageSubs, comboPageUpdate } from \"./combo-page/Update\";\nimport { viewComboPage } from \"./combo-page/ViewComboPage\";\n\nfunction init(l: Location): [Model, Cmd<Msg>] {\n  return router.parseLocation(l)\n      // eslint-disable-next-line array-callback-return\n      .map(route => {\n        switch (route) {\n          case \"home\": {\n            return initHome();\n          }\n          case \"menu\": {\n            return Tuple.fromNative(menuPageInit())\n                .mapFirst(page => ({\n                  page\n                }))\n                .mapSecond(c => c.map(menuPageMsg))\n                .toNative();\n          }\n          case \"dropdown\": {\n            return Tuple.fromNative(dropDownPageInit())\n                .mapFirst(page => ({\n                  page\n                }))\n                .mapSecond(c => c.map(dropDownPageMsg))\n                .toNative();\n          }\n          case \"placement\": {\n            return Tuple.fromNative(placementPageInit())\n                .mapFirst(page => ({\n                  page\n                }))\n                .mapSecond(c => c.map(placementPageMsg))\n                .toNative();\n          }\n          case \"combo\": { \n            return Tuple.fromNative(comboPageInit())\n                .mapFirst(page => ({\n                  page\n                }))\n                .mapSecond(c => c.map(comboPageMsg))\n                .toNative();\n          }\n        }\n      })\n      .withDefaultSupply(() => initHome())\n}\n\nfunction initHome(): [Model, Cmd<Msg>] {\n  return noCmd(homeModel());\n}\n\nfunction link(dispatch: Dispatcher<Msg>, route: Route, text: string) {\n  // eslint-disable-next-line jsx-a11y/anchor-is-valid\n  return <a href={'#'} onClick={e => {\n    e.preventDefault();\n    dispatch(navigate(route));\n  }}>\n    {text}\n  </a>\n}\n\nfunction view(dispatch: Dispatcher<Msg>, model: Model): React.ReactNode {\n  const { page } = model;\n  switch (page.tag) {\n    case \"home\": {\n      return (\n          <>\n            <h1>tea-pop demo app</h1>\n            <ul>\n              <li>\n                {link(dispatch, 'menu', \"Context menu\")}\n              </li>\n              <li>\n                {link(dispatch, 'dropdown', \"Drop-down\")}\n              </li>\n              <li>\n                {link(dispatch, 'combo', \"Combobox\")}\n              </li>\n              <li>\n                {link(dispatch, 'placement', \"Live placement\")}\n              </li>\n            </ul>\n          </>\n      )\n    }\n    case \"menu\": {\n      return viewMenuPage(map(dispatch, menuPageMsg), page);\n    }\n    case \"drop-down-page\": {\n      return viewDropDownPage(map(dispatch, dropDownPageMsg), page);\n    }\n    case \"placement-page\": {\n      return viewPlacementPage(map(dispatch, placementPageMsg), page);\n    }\n    case \"combo-page\": {\n      return viewComboPage(map(dispatch, comboPageMsg), page);\n    }\n  }\n}\n\nfunction updatePage<P extends Page,M>(\n  msg: M, \n  page: P, \n  updateF: (m:M, p:P) => [P, Cmd<M>],\n  liftF: (m:M) => Msg\n): [Model, Cmd<Msg>] {\n  const mac: [P, Cmd<M>] = updateF(msg, page);\n  const newModel: Model = { page: mac[0] };\n  const cmd: Cmd<Msg> = mac[1].map(liftF);\n  return Tuple.t2n(newModel, cmd);\n}\n\n\nfunction update(msg: Msg, model: Model): [Model, Cmd<Msg>] {\n  switch (msg.tag) {\n    case \"url-change\": {\n      return init(msg.l);\n    }\n    case \"menu-page-msg\": {\n      const { page } = model;\n      if (page.tag !== \"menu\") {\n        return noCmd(model);\n      }\n      return updatePage(msg.msg, page, menuPageUpdate, menuPageMsg);\n    }\n    case \"dd-page-msg\": {\n      const { page } = model;\n      if (page.tag !== \"drop-down-page\") {\n        return noCmd(model);\n      }\n      return updatePage(msg.msg, page, dropDownPageUpdate, dropDownPageMsg);\n    }\n    case \"placement-page-msg\": {\n      const { page } = model;\n      if (page.tag !== \"placement-page\") {\n        return noCmd(model);\n      }\n      return updatePage(msg.msg, page, placementPageUpdate, placementPageMsg);\n    }\n    case \"combo-page-msg\": {\n      const { page } = model;\n      if (page.tag !== \"combo-page\") {\n        return noCmd(model);\n      }\n      return updatePage(msg.msg, page, comboPageUpdate, comboPageMsg);\n    }\n    case \"navigate\": {\n      return Tuple.t2n(model, Task.perform(newUrl(routeToUrl(msg.route)), () => noop));\n    }\n    case \"noop\": {\n      return noCmd(model);\n    }\n  }\n}\n\nfunction subscriptions(model: Model): Sub<Msg> {\n  const { page } = model;\n  switch (page.tag) {\n    case \"menu\": {\n      return menuPageSubs(page).map(menuPageMsg);\n    }\n    case \"drop-down-page\": {\n      return dropDownPageSubs().map(dropDownPageMsg);\n    }\n    case \"placement-page\": {\n      return placementPageSubs().map(placementPageMsg);\n    }\n    case \"combo-page\": {\n      return comboPageSubs(page).map(comboPageMsg);\n    }\n    default: {\n      return Sub.none();\n    }\n    \n  }\n}\n\nexport function onUrlChange(l: Location): Msg {\n  return {\n    tag: \"url-change\",\n    l\n  }\n}\n\nexport const DemoApp = () => (\n    <ProgramWithNav\n        onUrlChange={onUrlChange}\n        init={init}\n        view={view}\n        update={update}\n        subscriptions={subscriptions}\n        devTools={DevTools.init<Model, Msg>(window)}\n    />\n)\n","import {MenuPage} from \"./menu-page/MenuPage\";\nimport {DropDownPage} from \"./dropdown-page/DropDownPage\";\nimport {PlacementPage} from \"./placement-page/PlacementPage\";\nimport { ComboPage } from \"./combo-page/ComboPage\";\n\nexport type Page =\n  | { tag: \"home\" }\n  | MenuPage\n  | DropDownPage\n  | PlacementPage\n  | ComboPage\n\nexport interface Model {\n  readonly page: Page;\n}\n\nexport function homeModel(): Model {\n  return {\n    page: { tag: \"home\" }\n  }\n}\n","import * as React from 'react';\nimport {Dispatcher} from \"tea-cup-core\";\nimport {DropDownPageMsg} from \"./DropDownPageMsg\";\nimport {DropDownPage} from \"./DropDownPage\";\nimport {Box} from \"tea-pop-core\";\nimport {ViewDropDown} from \"tea-pop-dropdown\";\n\nexport function viewDropDownPage(dispatch: Dispatcher<DropDownPageMsg>, page: DropDownPage) {\n  const steps = 10;\n  const padding = 4;\n  return page.viewportDim\n      .map(viewportDim => {\n        const xStep = Math.floor(viewportDim.w / steps);\n        const yStep = Math.floor(viewportDim.h / steps);\n        const buttons = [];\n        let btnIndex = 1;\n        const height = yStep - (padding * 2);\n        const width = xStep - (padding * 2);\n        for (let x = 0; (x + padding + width) < viewportDim.w; x += xStep) {\n          for (let y = 0; (y + padding + height) < viewportDim.h; y += yStep) {\n            const curBtnIndex = btnIndex;\n            const top = y + padding;\n            const left = x + padding;\n            const backgroundColor = page.indexAndModel\n                .map(iam => iam.a)\n                .filter(i => i === curBtnIndex).map(() => \"lightblue\").withDefault(\"lightgray\");\n            buttons.push(\n                <button\n                    key={\"btn\" + btnIndex}\n                    style={{\n                      position: \"absolute\",\n                      top,\n                      left,\n                      height,\n                      width,\n                      border: \"none\",\n                      backgroundColor,\n                    }}\n                    onClick={(evt) => dispatch({\n                      tag: \"button-clicked\",\n                      index: curBtnIndex,\n                      b: Box.fromDomRect((evt.target as HTMLElement).getBoundingClientRect())\n                    })}\n                >\n                  {btnIndex}\n                </button>\n            )\n            btnIndex++;\n          }\n        }\n        return (\n            <>\n              <div className=\"drop-down-page\">\n                {buttons}\n              </div>\n              {page.indexAndModel\n                  .map(ddModel =>\n                      <ViewDropDown renderer={() => <div className=\"my-drop-down\">HELLO</div>} model={ddModel.b}/>\n                  )\n                  .withDefaultSupply(() => <></>)\n              }\n            </>\n        )\n      })\n      .withDefaultSupply(() => <></>)\n}\n","import * as React from 'react';\nimport {Dispatcher} from \"tea-cup-core\";\nimport {PlacementPageMsg} from \"./PlacementPageMsg\";\nimport {PlacementPage} from \"./PlacementPage\";\nimport {box, Box, Dim, dim, place, placeCombo, Pos, pos} from \"tea-pop-core\";\n\nexport function viewPlacementPage(dispatch: Dispatcher<PlacementPageMsg>, page: PlacementPage) {\n  const {viewportDim} = page;\n  return viewportDim.map(vd => {\n    let placeFct = page.mode === \"menu\" ? place : placeCombo\n    const {mousePos} = page;\n    const elemDim = dim(600, 400);\n    const refDim = dim(100, 50);\n    const placedBox: Box = placeFct(vd, box(pos(mousePos.x, mousePos.y), refDim), elemDim);\n    const viewDim = (d: Dim) => <span>{d.w}*{d.h}</span>\n    const viewPos = (p: Pos) => <span>{p.x}:{p.y}</span>\n    return (\n        <div className=\"demo\">\n          <div className=\"dimensions\">\n            <ul>\n              <li>mode: {page.mode} (toggle with <code>M</code>)</li>\n              <li>elem: {viewDim(elemDim)}</li>\n              <li>viewport: {viewDim(vd)}</li>\n              <li>ref: {viewDim(refDim)}</li>\n              <li>mousePos: {viewPos(mousePos)}</li>\n              <li>placed: {viewPos(placedBox.p)}, {viewDim(placedBox.d)}</li>\n            </ul>\n          </div>\n          <div className=\"ref-elem\" style={{\n            height: refDim.h,\n            width: refDim.w,\n            left: page.mousePos.x,\n            top: page.mousePos.y,\n          }}>\n          </div>\n          <div className=\"menu-elem\" style={{\n            height: placedBox.d.h,\n            width: placedBox.d.w,\n            left: placedBox.p.x,\n            top: placedBox.p.y,\n          }}>\n          </div>\n        </div>\n    )\n  }).withDefaultSupply(() => <></>);\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport {DemoApp} from \"./DemoApp\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <DemoApp />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}